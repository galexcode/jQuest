/**
 * @license
 * GrapeFruit Game Engine - v0.1.1
 * Copyright Â© 2012-2014, Chad Engler
 * https://github.com/grapefruitjs/grapefruit
 *
 * Compiled: 2013-12-15
 *
 * GrapeFruit Game Engine is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(t,e){var i=!("function"!=typeof define||!define.amd),s="object"==typeof exports,n=function(){var t,i,s;return function(e){function r(t,e){return x.call(t,e)}function n(t,e){var i,r,s,n,o,a,h,l,u,c,p=e&&e.split("/"),d=g.map,f=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),l=0;l<t.length;l+=1)if(c=t[l],"."===c)t.splice(l,1),l-=1;else if(".."===c){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||f)&&d){for(i=t.split("/"),l=i.length;l>0;l-=1){if(r=i.slice(0,l).join("/"),p)for(u=p.length;u>0;u-=1)if(s=d[p.slice(0,u).join("/")],s&&(s=s[r])){n=s,o=l;break}if(n)break;!a&&f&&f[r]&&(a=f[r],h=l)}!n&&a&&(n=a,o=h),n&&(i.splice(0,o,n),t=i.join("/"))}return t}function o(t,i){return function(){return d.apply(e,_.call(arguments,0).concat([t,i]))}}function a(t){return function(e){return n(e,t)}}function h(t){return function(e){v[t]=e}}function l(t){if(r(y,t)){var i=y[t];delete y[t],b[t]=!0,p.apply(e,i)}if(!r(v,t)&&!r(b,t))throw new Error("No "+t);return v[t]}function u(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return g&&g.config&&g.config[t]||{}}}var p,d,f,m,v={},y={},g={},b={},x=Object.prototype.hasOwnProperty,_=[].slice;f=function(t,e){var i,r=u(t),s=r[0];return t=r[1],s&&(s=n(s,e),i=l(s)),s?t=i&&i.normalize?i.normalize(t,a(e)):n(t,e):(t=n(t,e),r=u(t),s=r[0],t=r[1],s&&(i=l(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:i}},m={require:function(t){return o(t)},exports:function(t){var e=v[t];return"undefined"!=typeof e?e:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:c(t)}}},p=function(t,i,s,n){var a,u,c,p,d,g,x=[],_=typeof s;if(n=n||t,"undefined"===_||"function"===_){for(i=!i.length&&s.length?["require","exports","module"]:i,d=0;d<i.length;d+=1)if(p=f(i[d],n),u=p.f,"require"===u)x[d]=m.require(t);else if("exports"===u)x[d]=m.exports(t),g=!0;else if("module"===u)a=x[d]=m.module(t);else if(r(v,u)||r(y,u)||r(b,u))x[d]=l(u);else{if(!p.p)throw new Error(t+" missing "+u);p.p.load(p.n,o(n,!0),h(u),{}),x[d]=v[u]}c=s?s.apply(v[t],x):void 0,t&&(a&&a.exports!==e&&a.exports!==v[t]?v[t]=a.exports:c===e&&g||(v[t]=c))}else t&&(v[t]=s)},t=i=d=function(t,i,r,s,n){return"string"==typeof t?m[t]?m[t](i):l(f(t,i).f):(t.splice||(g=t,i.splice?(t=i,i=r,r=null):t=e),i=i||function(){},"function"==typeof r&&(r=s,s=n),s?p(e,t,i,r):setTimeout(function(){p(e,t,i,r)},4),d)},d.config=function(t){return g=t,g.deps&&d(g.deps,g.callback),d},t._defined=v,s=function(t,e,i){e.splice||(i=e,e=[]),r(v,t)||r(y,t)||(y[t]=[t,e,i])},s.amd={jQuery:!0}}(),s("almond",function(){}),s("constants",["require","exports","module"],function(t,e,i){var r={RENDERER:{AUTO:"auto",CANVAS:"canvas",WEBGL:"webgl"},FILE_FORMAT:{JSON:"json",XML:"xml",CSV:"csv"},ATLAS_FORMAT:{JSON_ARRAY:"json_array",JSON_HASH:"json_hash",XML_STARLING:"xml_starling"},CAMERA_FOLLOW:{PLATFORMER:0,TOPDOWN:1,TOPDOWN_TIGHT:2,LOCKON:3},AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},DIRECTION:{NONE:0,LEFT:1,RIGHT:2,TOP:4,BOTTOM:8,ALL:15},SHAPE:{CIRCLE:1,POLYGON:2,RECTANGLE:3}};return i.exports=r,r.pkg={name:"gf",version:"0.1.1",longName:"GrapeFruit Game Engine",description:"A fun and easy WebGL-enabled JavaScript Game Engine",author:"Chad Engler <chad@pantherdev.com>",contributors:[],homepage:"https://github.com/grapefruitjs/grapefruit",bugs:"https://github.com/grapefruitjs/grapefruit/issues",license:"MIT",licenseUrl:"http://www.opensource.org/licenses/mit-license.php",repository:{type:"git",url:"https://github.com/grapefruitjs/grapefruit.git"},main:"build/gf.js",dependencies:{},devDependencies:{grunt:"~0.4.1","grunt-contrib-jshint":"git+https://github.com/englercj/grunt-contrib-jshint.git","grunt-contrib-connect":"~0.5","grunt-contrib-yuidoc":"~0.5","grunt-contrib-watch":"~0.5","grunt-contrib-concat":"~0.3","grunt-mocha":"git+https://github.com/englercj/grunt-mocha.git","grunt-urequire":"~0.6",glob:"~3.2",should:"~2.1"},scripts:{build:"grunt build",test:"grunt test"},"private":!0},i.exports}),s("utils/EventEmitter",["require","exports","module"],function(t,e,i){var r=function(){this._events=this._events||{},this.addEventListener=this.on=function(t,e){if("function"!=typeof e)throw new TypeError("listener must be a function");return this._events||(this._events={}),this._events[t]?"object"==typeof this._events[t]?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,this},this.dispatchEvent=this.emit=function(t){var e,i,r,s,n;if(this._events||(this._events={}),e=this._events[t],"undefined"==typeof e)return!1;if("function"==typeof e)switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,r=new Array(i-1),s=1;i>s;s++)r[s-1]=arguments[s];e.apply(this,r)}else if("object"==typeof e){for(i=arguments.length,r=new Array(i-1),s=1;i>s;s++)r[s-1]=arguments[s];for(n=e.slice(),i=n.length,s=0;i>s;s++)n[s].apply(this,r)}return this},this.removeEventListener=this.off=function(t,e){var i,r,s,n;if("function"!=typeof e)throw new TypeError("listener must be a function");if(!this._events[t])return this;if(i=this._events[t],s=i.length,r=-1,i===e||"function"==typeof i.listener&&i.listener===e)this._events[t]=void 0;else if("object"==typeof i){for(n=s;n-->0;)if(i[n]===e||i[n].listener&&i[n].listener===e){r=n;break}if(0>r)return this;1===i.length?(i.length=0,this._events[t]=void 0):i.splice(r,1)}return this},this.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}if("function"!=typeof e)throw new TypeError("listener must be a function");return i.listener=e,this.on(t,i),this}};return i.exports=r,i.exports}),s("utils/inherit",["require","exports","module"],function(t,e,i){var r=function(t,e,i){i=i||{};var r={};[t.prototype,i].forEach(function(t){Object.getOwnPropertyNames(t).forEach(function(e){r[e]=Object.getOwnPropertyDescriptor(t,e)})}),r.constructor={value:t,enumerable:!1,writable:!0,configurable:!0},t.prototype=Object.create(e.prototype,r)};return i.exports=r,i.exports}),s("math/Vector",["require","exports","module","../utils/inherit"],function(t,e,i){var r=t("../utils/inherit"),s=function(t,e){this.x=t||0,this.y=e||0};return r(s,Object,{set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new RangeError("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new RangeError("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},add:function(t){return this.x+=t.x,this.y+=t.y,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t):this.set(0,0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},negate:function(){return this.multiplyScalar(-1)},project:function(t){var e=this.dot(t)/t.lengthSq();return this.x=e*t.x,this.y=e*t.y,this},projectN:function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},reflect:function(t){var e=this.x,i=this.y;return this.project(t).multiplyScalar(2),this.x-=e,this.y-=i,this},reflectN:function(t){var e=this.x,i=this.y;return this.projectN(t).multiplyScalar(2),this.x-=e,this.y-=i,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},perp:function(){var t=this.x;return this.x=this.y,this.y=-t,this},rotate:function(t,e){var i=e.distanceTo(this);return this.set(e.x+i*Math.cos(t),e.y+i*Math.sin(t))},equals:function(t){return t.x===this.x&&t.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new s(this.x,this.y)}}),s.ZERO=new s,i.exports=s,i.exports}),s("geom/Circle",["require","exports","module","../utils/inherit","../math/Vector","../constants"],function(t,e,i){var r=t("../utils/inherit"),s=t("../math/Vector"),n=t("../constants"),o=function(t,e,i,r){this.position=new s,this._radius=i||0,this.radius=i||0,this.scale=r||new s(1,1),this.x=t||0,this.y=e||0,this._shapetype=n.SHAPE.CIRCLE,this.recalc()};return r(o,Object,{clone:function(){return new o(this.x,this.y,this.radius)},copy:function(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this},contains:function(t,e){if(this.radius<=0)return!1;var i=t-this.x,r=e-this.y,s=this.radius*this.radius;return i*=i,r*=r,s>=i+r},overlaps:function(t){var e=this.position.clone().sub(t.position),i=this.radius+t.radius,r=i*i,s=e.lengthSq();return!(s>r)},equals:function(t){return this.position.equals(t.position)&&this.radius===t.radius},recalc:function(){return this.radius=this._radius*this.scale.x,this}}),Object.defineProperty(o.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(o.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),Object.defineProperty(o.prototype,"radius",{get:function(){return this._radius*this.scale.x},set:function(t){this._radius=t}}),Object.defineProperty(o.prototype,"circumference",{get:function(){return 2*Math.PI*this.radius}}),Object.defineProperty(o.prototype,"area",{get:function(){return Math.PI*this.radius*this.radius}}),i.exports=o,i.exports}),s("geom/Polygon",["require","exports","module","../utils/inherit","../math/Vector","../constants"],function(t,e,i){var r=t("../utils/inherit"),s=t("../math/Vector"),n=t("../constants"),o=function(t,e,i,r){if(this.position=new s,this._points=null,this.scale=r||new s(1,1),this.points=[],this.edges=[],this.normals=[],"number"==typeof i[0]){for(var o=[],a=0,h=i.length;h>a;a+=2)o.push(new s(i[a],i[a+1]));i=o}this._points=i,this.x=t||0,this.y=e||0,this.recalc(),this._shapetype=n.SHAPE.POLYGON};return r(o,Object,{clone:function(){for(var t=[],e=0;e<this._points.length;e++)t.push(this._points[e].clone());return new o(t,this.scale)},copy:function(t){this.position.copy(t.position),this._points.length=this.points.length=0;for(var e=0;e<t._points.length;++e)this._points.push(t._points[e].clone());return this.scale.copy(t.scale),this.recalc(),this},contains:function(t,e){for(var i=!1,r=0,s=this.points.length-1;r<this.points.length;s=r++){var n=this.points[r].x,o=this.points[r].y,a=this.points[s].x,h=this.points[s].y,l=o>e!=h>e&&(a-n)*(e-o)/(h-o)+n>t;l&&(i=!i)}return i},equals:function(t){if(!this.position.equals(t.position)||this.points.length!==t.points.length)return!1;for(var e=0;e<t.points.length;++e)if(!this.points[e].equals(t.points[e]))return!1;return!0},recalc:function(){var t,e,i,r,n=this._points,o=n.length,a=0;for(a=0;o>a;a++)this.points[a]||(this.points[a]=new s),this.points[a].set(this._points[a].x*this.scale.x,this._points[a].y*this.scale.y);for(this.edges.length=this.normals.length=0,a=0;o>a;++a)t=n[a],e=o-1>a?n[a+1]:n[0],i=e.clone().sub(t),r=i.clone().perp().normalize(),this.edges.push(i),this.normals.push(r);return this}}),Object.defineProperty(o.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(o.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),i.exports=o,i.exports}),s("utils/support",["require","exports","module"],function(t,i,r){var s={ua:e.navigator?e.navigator.userAgent.toLowerCase():"nodejs",canvas:function(){try{return!!e.CanvasRenderingContext2D&&!!document.createElement("canvas").getContext("2d")}catch(t){return!1}}(),webgl:function(){try{var t=document.createElement("canvas");return!!e.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(i){return!1}}(),crypto:!!e.crypto&&!!e.crypto.getRandomValues,workers:!!e.Worker,blobUrls:!!e.Blob&&!!e.URL&&!!e.URL.createObjectURL,typedArrays:!!e.ArrayBuffer,fileapi:!!(e.File&&e.FileReader&&e.FileList&&e.Blob),webAudio:!!e.AudioContext||!!e.webkitAudioContext||!!e.mozAudioContext,htmlAudio:!!document.createElement("audio").canPlayType&&!!e.Audio,localStorage:!!e.localStorage,touch:"createTouch"in document||"ontouchstart"in e||navigator.isCocoonJS,gamepad:!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")};if(s.htmlAudio){var n=new Audio;s.codec={mp3:!!n.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),webm:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}return r.exports=s,r.exports}),s("vendor/pixi",["require","exports","module"],function(t,i,s){function n(){return l.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,l.Matrix}function o(t){return[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}function o(t){return[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}var h=this,l=l||{};l.Point=function(t,e){this.x=t||0,this.y=e||0},l.Point.prototype.clone=function(){return new l.Point(this.x,this.y)},l.Point.prototype.constructor=l.Point,l.Rectangle=function(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0},l.Rectangle.prototype.clone=function(){return new l.Rectangle(this.x,this.y,this.width,this.height)},l.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1},l.Rectangle.prototype.constructor=l.Rectangle,l.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),"number"==typeof t[0]){for(var e=[],i=0,r=t.length;r>i;i+=2)e.push(new l.Point(t[i],t[i+1]));t=e}this.points=t},l.Polygon.prototype.clone=function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].clone());return new l.Polygon(t)},l.Polygon.prototype.contains=function(t,e){for(var i=!1,r=0,s=this.points.length-1;r<this.points.length;s=r++){var n=this.points[r].x,o=this.points[r].y,a=this.points[s].x,h=this.points[s].y,l=o>e!=h>e&&(a-n)*(e-o)/(h-o)+n>t;l&&(i=!i)}return i},l.Polygon.prototype.constructor=l.Polygon,l.Circle=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0},l.Circle.prototype.clone=function(){return new l.Circle(this.x,this.y,this.radius)},l.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,r=this.y-e,s=this.radius*this.radius;return i*=i,r*=r,s>=i+r},l.Circle.prototype.constructor=l.Circle,l.Ellipse=function(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0},l.Ellipse.prototype.clone=function(){return new l.Ellipse(this.x,this.y,this.width,this.height)},l.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width-.5,r=(e-this.y)/this.height-.5;return i*=i,r*=r,.25>i+r},l.Ellipse.getBounds=function(){return new l.Rectangle(this.x,this.y,this.width,this.height)},l.Ellipse.prototype.constructor=l.Ellipse,n(),l.mat3={},l.mat3.create=function(){var t=new l.Matrix(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.mat4={},l.mat4.create=function(){var t=new l.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.mat3.multiply=function(t,e,i){i||(i=t);var r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],h=t[5],l=t[6],u=t[7],c=t[8],p=e[0],d=e[1],f=e[2],m=e[3],v=e[4],y=e[5],g=e[6],b=e[7],x=e[8];return i[0]=p*r+d*o+f*l,i[1]=p*s+d*a+f*u,i[2]=p*n+d*h+f*c,i[3]=m*r+v*o+y*l,i[4]=m*s+v*a+y*u,i[5]=m*n+v*h+y*c,i[6]=g*r+b*o+x*l,i[7]=g*s+b*a+x*u,i[8]=g*n+b*h+x*c,i},l.mat3.clone=function(t){var e=new l.Matrix(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=s,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},l.mat3.toMat4=function(t,e){return e||(e=l.mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},l.mat4.create=function(){var t=new l.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=n,t[11]=t[14],t[12]=s,t[13]=o,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},l.mat4.multiply=function(t,e,i){i||(i=t);var r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],h=t[5],l=t[6],u=t[7],c=t[8],p=t[9],d=t[10],f=t[11],m=t[12],v=t[13],y=t[14],g=t[15],b=e[0],x=e[1],_=e[2],T=e[3];return i[0]=b*r+x*a+_*c+T*m,i[1]=b*s+x*h+_*p+T*v,i[2]=b*n+x*l+_*d+T*y,i[3]=b*o+x*u+_*f+T*g,b=e[4],x=e[5],_=e[6],T=e[7],i[4]=b*r+x*a+_*c+T*m,i[5]=b*s+x*h+_*p+T*v,i[6]=b*n+x*l+_*d+T*y,i[7]=b*o+x*u+_*f+T*g,b=e[8],x=e[9],_=e[10],T=e[11],i[8]=b*r+x*a+_*c+T*m,i[9]=b*s+x*h+_*p+T*v,i[10]=b*n+x*l+_*d+T*y,i[11]=b*o+x*u+_*f+T*g,b=e[12],x=e[13],_=e[14],T=e[15],i[12]=b*r+x*a+_*c+T*m,i[13]=b*s+x*h+_*p+T*v,i[14]=b*n+x*l+_*d+T*y,i[15]=b*o+x*u+_*f+T*g,i},l.DisplayObject=function(){this.last=this,this.first=this,this.position=new l.Point,this.scale=new l.Point(1,1),this.pivot=new l.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=l.mat3.create(),this.localTransform=l.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},l.DisplayObject.prototype.constructor=l.DisplayObject,l.DisplayObject.prototype.setInteractive=function(t){this.interactive=t},Object.defineProperty(l.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(l.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){t?this._mask?(t.start=this._mask.start,t.end=this._mask.end):(this.addFilter(t),t.renderable=!1):(this.removeFilter(this._mask),this._mask.renderable=!0),this._mask=t}}),Object.defineProperty(l.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){t?(this._filters&&this.removeFilter(this._filters),this.addFilter(t)):this._filters&&this.removeFilter(this._filters),this._filters=t}}),l.DisplayObject.prototype.addFilter=function(t){var e=new l.FilterBlock,i=new l.FilterBlock;t.start=e,t.end=i,e.data=t,i.data=t,e.first=e.last=this,i.first=i.last=this,e.open=!0;var r,s,n=e,o=e;s=this.first._iPrev,s?(r=s._iNext,n._iPrev=s,s._iNext=n):r=this,r&&(r._iPrev=o,o._iNext=r);var n=i,o=i,r=null,s=null;s=this.last,r=s._iNext,r&&(r._iPrev=o,o._iNext=r),n._iPrev=s,s._iNext=n;for(var a=this,h=this.last;a;)a.last==h&&(a.last=i),a=a.parent;this.first=e,this.__renderGroup&&this.__renderGroup.addFilterBlocks(e,i)},l.DisplayObject.prototype.removeFilter=function(t){console.log("YUOIO");var e=t.start,i=e._iNext,r=e._iPrev;i&&(i._iPrev=r),r&&(r._iNext=i),this.first=e._iNext;var s=t.end,i=s._iNext,r=s._iPrev;i&&(i._iPrev=r),r._iNext=i;for(var n=s._iPrev,o=this;o.last==s&&(o.last=n,o=o.parent););this.__renderGroup&&this.__renderGroup.removeFilterBlocks(e,s)},l.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var t=this.localTransform,e=this.parent.worldTransform,i=this.worldTransform;t[0]=this._cr*this.scale.x,t[1]=-this._sr*this.scale.y,t[3]=this._sr*this.scale.x,t[4]=this._cr*this.scale.y;var r=this.pivot.x,s=this.pivot.y,n=t[0],o=t[1],a=this.position.x-t[0]*r-s*t[1],h=t[3],u=t[4],c=this.position.y-t[4]*s-r*t[3],p=e[0],d=e[1],f=e[2],m=e[3],v=e[4],y=e[5];t[2]=a,t[5]=c,i[0]=p*n+d*h,i[1]=p*o+d*u,i[2]=p*a+d*c+f,i[3]=m*n+v*h,i[4]=m*o+v*u,i[5]=m*a+v*c+y,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=l.visibleCount},l.visibleCount=0,l.DisplayObjectContainer=function(){l.DisplayObject.call(this),this.children=[]},l.DisplayObjectContainer.prototype=Object.create(l.DisplayObject.prototype),l.DisplayObjectContainer.prototype.constructor=l.DisplayObjectContainer,l.DisplayObjectContainer.prototype.addChild=function(t){if(void 0!=t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.stage){var e=t;do e.interactive&&(this.stage.dirty=!0),e.stage=this.stage,e=e._iNext;while(e)}var i,r,s=t.first,n=t.last;r=this._filters||this._mask?this.last._iPrev:this.last,i=r._iNext;for(var o=this,a=r;o;)o.last==a&&(o.last=t.last),o=o.parent;i&&(i._iPrev=n,n._iNext=i),s._iPrev=r,r._iNext=s,this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},l.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(!(e>=0&&e<=this.children.length))throw new Error(t+" The index "+e+" supplied is out of bounds "+this.children.length);if(void 0!=t.parent&&t.parent.removeChild(t),t.parent=this,this.stage){var i=t;do i.interactive&&(this.stage.dirty=!0),i.stage=this.stage,i=i._iNext;while(i)}var r,s,n=t.first,o=t.last;if(e==this.children.length){s=this.last;for(var a=this,h=this.last;a;)a.last==h&&(a.last=t.last),a=a.parent}else s=0==e?this:this.children[e-1].last;r=s._iNext,r&&(r._iPrev=o,o._iNext=r),n._iPrev=s,s._iNext=n,this.children.splice(e,0,t),this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},l.DisplayObjectContainer.prototype.swapChildren=function(){},l.DisplayObjectContainer.prototype.getChildAt=function(t){if(t>=0&&t<this.children.length)return this.children[t];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},l.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error(t+" The supplied DisplayObject must be a child of the caller "+this);var i=t.first,r=t.last,s=r._iNext,n=i._iPrev;if(s&&(s._iPrev=n),n._iNext=s,this.last==r)for(var o=i._iPrev,a=this;a.last==r.last&&(a.last=o,a=a.parent););if(r._iNext=null,i._iPrev=null,this.stage){var h=t;do h.interactive&&(this.stage.dirty=!0),h.stage=null,h=h._iNext;while(h)}t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),t.parent=void 0,this.children.splice(e,1)},l.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){l.DisplayObject.prototype.updateTransform.call(this);for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform()}},l.blendModes={},l.blendModes.NORMAL=0,l.blendModes.SCREEN=1,l.Sprite=function(t){l.DisplayObjectContainer.call(this),this.anchor=new l.Point,this.texture=t,this.blendMode=l.blendModes.NORMAL,this._width=0,this._height=0,t.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},l.Sprite.prototype=Object.create(l.DisplayObjectContainer.prototype),l.Sprite.prototype.constructor=l.Sprite,Object.defineProperty(l.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(l.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),l.Sprite.prototype.setTexture=function(t){this.texture.baseTexture!=t.baseTexture?(this.textureChange=!0,this.texture=t,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=t,this.updateFrame=!0},l.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},l.Sprite.fromFrame=function(t){var e=l.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache"+this);return new l.Sprite(e)},l.Sprite.fromImage=function(t){var e=l.Texture.fromImage(t);return new l.Sprite(e)},l.MovieClip=function(t){l.Sprite.call(this,t[0]),this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},l.MovieClip.prototype=Object.create(l.Sprite.prototype),l.MovieClip.prototype.constructor=l.MovieClip,Object.defineProperty(l.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),l.MovieClip.prototype.stop=function(){this.playing=!1},l.MovieClip.prototype.play=function(){this.playing=!0},l.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=0|this.currentFrame+.5;this.setTexture(this.textures[e%this.textures.length])},l.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},l.MovieClip.prototype.updateTransform=function(){if(l.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var t=0|this.currentFrame+.5;this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},l.FilterBlock=function(){this.visible=!0,this.renderable=!0},l.ColorMatrixFilter=function(){this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","gl_FragColor = gl_FragColor * vColor;","}"]},Object.defineProperty(l.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}}),l.GreyFilter=function(){this.uniforms={grey:{type:"f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float grey;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord);","gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), grey);","gl_FragColor = gl_FragColor * vColor;","}"],this.primitiveFragmentSrc=["precision mediump float;","varying vec4 vColor;","uniform float grey;","void main(void) {","gl_FragColor = vColor;","gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), grey);","gl_FragColor = gl_FragColor * vColor;","}"]},Object.defineProperty(l.GreyFilter.prototype,"grey",{get:function(){return this.uniforms.grey.value},set:function(t){this.uniforms.grey.value=t}}),l.DisplacementFilter=function(t){this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"f2",value:{x:30,y:30}},mapDimensions:{type:"f2",value:{x:t.width,y:t.height}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 mapDimensions;","const vec2 textureDimensions = vec2(245.0, 263.0);","void main(void) {","vec2 matSample = texture2D(displacementMap, vTextureCoord * (textureDimensions/mapDimensions)).xy;","matSample -= 0.5;","matSample *= scale;","matSample /= textureDimensions;","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","gl_FragColor = gl_FragColor * vColor;","}"]},Object.defineProperty(l.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(l.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),l.Text=function(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),l.Sprite.call(this,l.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},l.Text.prototype=Object.create(l.Sprite.prototype),l.Text.prototype.constructor=l.Text,l.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,this.style=t,this.dirty=!0},l.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},l.Text.prototype.updateText=function(){this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],r=0,s=0;s<e.length;s++){var n=this.context.measureText(e[s]).width;i[s]=n,r=Math.max(r,n)}this.canvas.width=r+this.style.strokeThickness;var o=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=o*e.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",s=0;s<e.length;s++){var a=new l.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+s*o);"right"==this.style.align?a.x+=r-i[s]:"center"==this.style.align&&(a.x+=(r-i[s])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[s],a.x,a.y),this.style.fill&&this.context.fillText(e[s],a.x,a.y)}this.updateTexture()},l.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,l.texturesToUpdate.push(this.texture.baseTexture)},l.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),l.Sprite.prototype.updateTransform.call(this)},l.Text.prototype.determineFontHeight=function(t){var e=l.Text.heightCache[t];if(!e){var i=document.getElementsByTagName("body")[0],r=document.createElement("div"),s=document.createTextNode("M");r.appendChild(s),r.setAttribute("style",t+";position:absolute;top:0;left:0"),i.appendChild(r),e=r.offsetHeight,l.Text.heightCache[t]=e,i.removeChild(r)
}return e},l.Text.prototype.wordWrap=function(t){for(var e=function(t,e,i,r,s){var n=Math.floor((r-i)/2)+i;return n==i?1:t.measureText(e.substring(0,n)).width<=s?t.measureText(e.substring(0,n+1)).width>s?n:arguments.callee(t,e,n,r,s):arguments.callee(t,e,i,n,s)},i=function(t,i,r){if(t.measureText(i).width<=r||i.length<1)return i;var s=e(t,i,0,i.length,r);return i.substring(0,s)+"\n"+arguments.callee(t,i.substring(s),r)},r="",s=t.split("\n"),n=0;n<s.length;n++)r+=i(this.context,s[n],this.style.wordWrapWidth)+"\n";return r},l.Text.prototype.destroy=function(t){t&&this.texture.destroy()},l.Text.heightCache={},l.BitmapText=function(t,e){l.DisplayObjectContainer.call(this),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},l.BitmapText.prototype=Object.create(l.DisplayObjectContainer.prototype),l.BitmapText.prototype.constructor=l.BitmapText,l.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},l.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var e=t.font.split(" ");this.fontName=e[e.length-1],this.fontSize=e.length>=2?parseInt(e[e.length-2],10):l.BitmapText.fonts[this.fontName].size,this.dirty=!0},l.BitmapText.prototype.updateText=function(){for(var t=l.BitmapText.fonts[this.fontName],e=new l.Point,i=null,r=[],s=0,n=[],o=0,a=this.fontSize/t.size,h=0;h<this.text.length;h++){var u=this.text.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(h)))n.push(e.x),s=Math.max(s,e.x),o++,e.x=0,e.y+=t.lineHeight,i=null;else{var c=t.chars[u];c&&(i&&c[i]&&(e.x+=c.kerning[i]),r.push({texture:c.texture,line:o,charCode:u,position:new l.Point(e.x+c.xOffset,e.y+c.yOffset)}),e.x+=c.xAdvance,i=u)}}n.push(e.x),s=Math.max(s,e.x);var p=[];for(h=0;o>=h;h++){var d=0;"right"==this.style.align?d=s-n[h]:"center"==this.style.align&&(d=(s-n[h])/2),p.push(d)}for(h=0;h<r.length;h++){var f=new l.Sprite(r[h].texture);f.position.x=(r[h].position.x+p[r[h].line])*a,f.position.y=r[h].position.y*a,f.scale.x=f.scale.y=a,this.addChild(f)}this.width=e.x*a,this.height=(e.y+t.lineHeight)*a},l.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}l.DisplayObjectContainer.prototype.updateTransform.call(this)},l.BitmapText.fonts={},l.InteractionManager=function(t){this.stage=t,this.mouse=new l.InteractionData,this.touchs={},this.tempPoint=new l.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0},l.InteractionManager.prototype.constructor=l.InteractionManager,l.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,r=i.length,s=r-1;s>=0;s--){var n=i[s];n.interactive?(e.interactiveChildren=!0,this.interactiveItems.push(n),n.children.length>0&&this.collectInteractiveSprite(n,n)):(n.__iParent=null,n.children.length>0&&this.collectInteractiveSprite(n,e))}},l.InteractionManager.prototype.setTarget=function(t){this.target=t,null===this.interactionDOMElement&&this.setTargetDomElement(t.view),document.body.addEventListener("mouseup",this.onMouseUp,!0)},l.InteractionManager.prototype.setTargetDomElement=function(t){null!==this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0)),e.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none"),this.interactionDOMElement=t,t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseout",this.onMouseOut,!0),t.addEventListener("touchstart",this.onTouchStart,!0),t.addEventListener("touchend",this.onTouchEnd,!0),t.addEventListener("touchmove",this.onTouchMove,!0)},l.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),e=t-this.last;if(e=30*e/1e3,!(1>e)){if(this.last=t,this.dirty){this.dirty=!1;for(var i=this.interactiveItems.length,r=0;i>r;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var s=this.interactiveItems.length;this.interactionDOMElement.style.cursor="default";for(var r=0;s>r;r++){var n=this.interactiveItems[r];(n.mouseover||n.mouseout||n.buttonMode)&&(n.__hit=this.hitTest(n,this.mouse),this.mouse.target=n,n.__hit?(n.buttonMode&&(this.interactionDOMElement.style.cursor="pointer"),n.__isOver||(n.mouseover&&n.mouseover(this.mouse),n.__isOver=!0)):n.__isOver&&(n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1))}}}},l.InteractionManager.prototype.onMouseMove=function(t){this.mouse.originalEvent=t||e.event;var i=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-i.left)*(this.target.width/i.width),this.mouse.global.y=(t.clientY-i.top)*(this.target.height/i.height);var r=this.interactiveItems.length;this.mouse.global;for(var s=0;r>s;s++){var n=this.interactiveItems[s];n.mousemove&&n.mousemove(this.mouse)}},l.InteractionManager.prototype.onMouseDown=function(t){this.mouse.originalEvent=t||e.event;var i=this.interactiveItems.length;this.mouse.global,this.stage;for(var r=0;i>r;r++){var s=this.interactiveItems[r];if((s.mousedown||s.click)&&(s.__mouseIsDown=!0,s.__hit=this.hitTest(s,this.mouse),s.__hit&&(s.mousedown&&s.mousedown(this.mouse),s.__isDown=!0,!s.interactiveChildren)))break}},l.InteractionManager.prototype.onMouseOut=function(){var t=this.interactiveItems.length;this.interactionDOMElement.style.cursor="default";for(var e=0;t>e;e++){var i=this.interactiveItems[e];i.__isOver&&(this.mouse.target=i,i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1)}},l.InteractionManager.prototype.onMouseUp=function(t){this.mouse.originalEvent=t||e.event,this.mouse.global;for(var i=this.interactiveItems.length,r=!1,s=0;i>s;s++){var n=this.interactiveItems[s];(n.mouseup||n.mouseupoutside||n.click)&&(n.__hit=this.hitTest(n,this.mouse),n.__hit&&!r?(n.mouseup&&n.mouseup(this.mouse),n.__isDown&&n.click&&n.click(this.mouse),n.interactiveChildren||(r=!0)):n.__isDown&&n.mouseupoutside&&n.mouseupoutside(this.mouse),n.__isDown=!1)}},l.InteractionManager.prototype.hitTest=function(t,e){var i=e.global;if(t.vcount!==l.visibleCount)return!1;var r=t instanceof l.Sprite,s=t.worldTransform,n=s[0],o=s[1],a=s[2],h=s[3],u=s[4],c=s[5],p=1/(n*u+o*-h),d=u*p*i.x+-o*p*i.y+(c*o-a*u)*p,f=n*p*i.y+-h*p*i.x+(-c*n+a*h)*p;if(e.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(d,f)?(e.target=t,!0):!1;if(r){var m,v=t.texture.frame.width,y=t.texture.frame.height,g=-v*t.anchor.x;if(d>g&&g+v>d&&(m=-y*t.anchor.y,f>m&&m+y>f))return e.target=t,!0}for(var b=t.children.length,x=0;b>x;x++){var _=t.children[x],T=this.hitTest(_,e);if(T)return e.target=t,!0}return!1},l.InteractionManager.prototype.onTouchMove=function(t){for(var i=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,s=0;s<r.length;s++){var n=r[s],o=this.touchs[n.identifier];o.originalEvent=t||e.event,o.global.x=(n.clientX-i.left)*(this.target.width/i.width),o.global.y=(n.clientY-i.top)*(this.target.height/i.height)}for(var a=this.interactiveItems.length,s=0;a>s;s++){var h=this.interactiveItems[s];h.touchmove&&h.touchmove(o)}},l.InteractionManager.prototype.onTouchStart=function(t){for(var i=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,s=0;s<r.length;s++){var n=r[s],o=this.pool.pop();o||(o=new l.InteractionData),o.originalEvent=t||e.event,this.touchs[n.identifier]=o,o.global.x=(n.clientX-i.left)*(this.target.width/i.width),o.global.y=(n.clientY-i.top)*(this.target.height/i.height);for(var a=this.interactiveItems.length,h=0;a>h;h++){var u=this.interactiveItems[h];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,o),u.__hit&&(u.touchstart&&u.touchstart(o),u.__isDown=!0,u.__touchData=o,!u.interactiveChildren)))break}}},l.InteractionManager.prototype.onTouchEnd=function(t){for(var i=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,s=0;s<r.length;s++){var n=r[s],o=this.touchs[n.identifier],a=!1;o.global.x=(n.clientX-i.left)*(this.target.width/i.width),o.global.y=(n.clientY-i.top)*(this.target.height/i.height);for(var h=this.interactiveItems.length,l=0;h>l;l++){var u=this.interactiveItems[l],c=u.__touchData;u.__hit=this.hitTest(u,o),c==o&&(o.originalEvent=t||e.event,(u.touchend||u.tap)&&(u.__hit&&!a?(u.touchend&&u.touchend(o),u.__isDown&&u.tap&&u.tap(o),u.interactiveChildren||(a=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(o),u.__isDown=!1),u.__touchData=null)}this.pool.push(o),this.touchs[n.identifier]=null}},l.InteractionData=function(){this.global=new l.Point,this.local=new l.Point,this.target,this.originalEvent},l.InteractionData.prototype.getLocalPosition=function(t){var e=t.worldTransform,i=this.global,r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],h=e[5],u=1/(r*a+s*-o);return new l.Point(a*u*i.x+-s*u*i.y+(h*s-n*a)*u,r*u*i.y+-o*u*i.x+(-h*r+n*o)*u)},l.InteractionData.prototype.constructor=l.InteractionData,l.Stage=function(t){l.DisplayObjectContainer.call(this),this.worldTransform=l.mat3.create(),this.interactive=!0,this.interactionManager=new l.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new l.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t),this.worldVisible=!0},l.Stage.prototype=Object.create(l.DisplayObjectContainer.prototype),l.Stage.prototype.constructor=l.Stage,l.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},l.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=l.visibleCount;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},l.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=o(this.backgroundColor);var e=this.backgroundColor.toString(16);e="000000".substr(0,6-e.length)+e,this.backgroundColorString="#"+e},l.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var u=0,c=["ms","moz","webkit","o"],p=0;p<c.length&&!e.requestAnimationFrame;++p)e.requestAnimationFrame=e[c[p]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[c[p]+"CancelAnimationFrame"]||e[c[p]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(t){var i=(new Date).getTime(),r=Math.max(0,16-(i-u)),s=e.setTimeout(function(){t(i+r)},r);return u=i+r,s}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(t){clearTimeout(t)}),e.requestAnimFrame=e.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function i(){var n=s.concat(t.call(arguments));r.apply(this instanceof i?this:e,n)}var r=this,s=t.call(arguments,1);if("function"!=typeof r)throw new TypeError;return i.prototype=function n(t){return t&&(n.prototype=t),this instanceof n?void 0:new n}(r.prototype),i}}());var d=l.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!e.ActiveXObject)return e.XMLHttpRequest?new XMLHttpRequest:!1;for(var i=0;i<t.length;i++)try{return new ActiveXObject(t[i])}catch(r){}};l.runList=function(t){console.log(">>>>>>>>>"),console.log("_");var e=0,i=t.first;for(console.log(i);i._iNext;)if(e++,i=i._iNext,console.log(i),e>100){console.log("BREAK");break}},l.EventTarget=function(){var t={};this.addEventListener=this.on=function(e,i){void 0===t[e]&&(t[e]=[]),-1===t[e].indexOf(i)&&t[e].push(i)},this.dispatchEvent=this.emit=function(e){if(t[e.type]&&t[e.type].length)for(var i=0,r=t[e.type].length;r>i;i++)t[e.type][i](e)},this.removeEventListener=this.off=function(e,i){var r=t[e].indexOf(i);-1!==r&&t[e].splice(r,1)}},l.autoDetectRenderer=function(t,i,r,s,n){t||(t=800),i||(i=600);var o=function(){try{var t=document.createElement("canvas");return!!e.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(i){return!1}}();if(o){var a=-1!=navigator.userAgent.toLowerCase().indexOf("msie");o=!a}return o?new l.WebGLRenderer(t,i,r,s,n):new l.CanvasRenderer(t,i,r,s)},l.PolyK={},l.PolyK.Triangulate=function(t){var e=!0,i=t.length>>1;if(3>i)return[];for(var r=[],s=[],n=0;i>n;n++)s.push(n);for(var n=0,o=i;o>3;){var a=s[(n+0)%o],h=s[(n+1)%o],u=s[(n+2)%o],c=t[2*a],p=t[2*a+1],d=t[2*h],f=t[2*h+1],m=t[2*u],v=t[2*u+1],y=!1;if(l.PolyK._convex(c,p,d,f,m,v,e)){y=!0;for(var g=0;o>g;g++){var b=s[g];if(b!=a&&b!=h&&b!=u&&l.PolyK._PointInTriangle(t[2*b],t[2*b+1],c,p,d,f,m,v)){y=!1;break}}}if(y)r.push(a,h,u),s.splice((n+1)%o,1),o--,n=0;else if(n++>3*o){if(!e)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];s=[];for(var n=0;i>n;n++)s.push(n);n=0,o=i,e=!1}}return r.push(s[0],s[1],s[2]),r},l.PolyK._PointInTriangle=function(t,e,i,r,s,n,o,a){var h=o-i,l=a-r,u=s-i,c=n-r,p=t-i,d=e-r,f=h*h+l*l,m=h*u+l*c,v=h*p+l*d,y=u*u+c*c,g=u*p+c*d,b=1/(f*y-m*m),x=(y*v-m*g)*b,_=(f*g-m*v)*b;return x>=0&&_>=0&&1>x+_},l.PolyK._convex=function(t,e,i,r,s,n,o){return(e-r)*(s-i)+(i-t)*(n-r)>=0==o},l.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],l.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],l.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],l.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],l.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],l.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],l.shaderStack=[],l.initPrimitiveShader=function(){var t=l.gl,e=l.compileProgram(l.primitiveShaderVertexSrc,l.primitiveShaderFragmentSrc);t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.colorAttribute=t.getAttribLocation(e,"aColor"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.translationMatrix=t.getUniformLocation(e,"translationMatrix"),e.alpha=t.getUniformLocation(e,"alpha"),l.primitiveProgram=e},l.initDefaultShader=function(){l.defaultShader=new l.PixiShader,l.defaultShader.init(),l.pushShader(l.defaultShader)},l.initDefaultStripShader=function(){var t=this.gl,e=l.compileProgram(l.stripShaderVertexSrc,l.stripShaderFragmentSrc);t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.textureCoordAttribute=t.getAttribLocation(e,"aTextureCoord"),e.translationMatrix=t.getUniformLocation(e,"translationMatrix"),e.alpha=t.getUniformLocation(e,"alpha"),e.colorAttribute=t.getAttribLocation(e,"aColor"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.samplerUniform=t.getUniformLocation(e,"uSampler"),l.stripShaderProgram=e},l.CompileVertexShader=function(t,e){return l._CompileShader(t,e,t.VERTEX_SHADER)},l.CompileFragmentShader=function(t,e){return l._CompileShader(t,e,t.FRAGMENT_SHADER)},l._CompileShader=function(t,e,i){var r=e.join("\n"),s=t.createShader(i);return t.shaderSource(s,r),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(alert(t.getShaderInfoLog(s)),null)},l.compileProgram=function(t,e){var i=l.gl,r=l.CompileFragmentShader(i,e),s=l.CompileVertexShader(i,t),n=i.createProgram();return i.attachShader(n,s),i.attachShader(n,r),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||alert("Could not initialise shaders"),n},l.pushShader=function(t){l.shaderStack.push(t);var e=l.gl,i=t.program;e.useProgram(i),e.enableVertexAttribArray(i.vertexPositionAttribute),e.enableVertexAttribArray(i.colorAttribute),e.enableVertexAttribArray(i.textureCoordAttribute),t.syncUniforms(),l.currentShader=i},l.popShader=function(){var t=l.gl;l.shaderStack.pop();var e=l.shaderStack[l.shaderStack.length-1].program;t.useProgram(e),l.currentShader=e},l.activatePrimitiveShader=function(){var t=l.gl;t.useProgram(l.primitiveProgram),t.disableVertexAttribArray(l.currentShader.textureCoordAttribute)},l.deactivatePrimitiveShader=function(){var t=l.gl;t.useProgram(l.currentShader),t.enableVertexAttribArray(l.currentShader.textureCoordAttribute)},l.PixiShader=function(){this.program,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]},l.PixiShader.prototype.init=function(){var t=l.compileProgram(this.vertexSrc||l.shaderVertexSrc,this.fragmentSrc),e=l.gl;e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler");for(var i in this.uniforms)t[i]=e.getUniformLocation(t,i);this.program=t},l.PixiShader.prototype.syncUniforms=function(){var t=l.gl;for(var e in this.uniforms){var i=this.uniforms[e].type;if("f"==i&&t.uniform1f(this.program[e],this.uniforms[e].value),"f2"==i)t.uniform2f(this.program[e],this.uniforms[e].value.x,this.uniforms[e].value.y);else if("mat4"==i)t.uniformMatrix4fv(this.program[e],!1,this.uniforms[e].value);else if("sampler2D"==i){var r=this.uniforms[e].value;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,r.baseTexture._glTexture),t.uniform1i(this.program[e],1)}}},l.WebGLGraphics=function(){},l.WebGLGraphics.renderGraphics=function(t,e){var i=l.gl;t._webGL||(t._webGL={points:[],indices:[],lastIndex:0,buffer:i.createBuffer(),indexBuffer:i.createBuffer()}),t.dirty&&(t.dirty=!1,t.clearDirty&&(t.clearDirty=!1,t._webGL.lastIndex=0,t._webGL.points=[],t._webGL.indices=[]),l.WebGLGraphics.updateGraphics(t)),l.activatePrimitiveShader();var r=l.mat3.clone(t.worldTransform);l.mat3.transpose(r),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.uniformMatrix3fv(l.primitiveProgram.translationMatrix,!1,r),i.uniform2f(l.primitiveProgram.projectionVector,e.x,e.y),i.uniform1f(l.primitiveProgram.alpha,t.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,t._webGL.buffer),i.vertexAttribPointer(l.primitiveProgram.vertexPositionAttribute,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(l.primitiveProgram.colorAttribute,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._webGL.indexBuffer),i.drawElements(i.TRIANGLE_STRIP,t._webGL.indices.length,i.UNSIGNED_SHORT,0),l.deactivatePrimitiveShader()},l.WebGLGraphics.updateGraphics=function(t){for(var e=t._webGL.lastIndex;e<t.graphicsData.length;e++){var i=t.graphicsData[e];i.type==l.Graphics.POLY?(i.fill&&i.points.length>3&&l.WebGLGraphics.buildPoly(i,t._webGL),i.lineWidth>0&&l.WebGLGraphics.buildLine(i,t._webGL)):i.type==l.Graphics.RECT?l.WebGLGraphics.buildRectangle(i,t._webGL):(i.type==l.Graphics.CIRC||i.type==l.Graphics.ELIP)&&l.WebGLGraphics.buildCircle(i,t._webGL)}t._webGL.lastIndex=t.graphicsData.length;var r=l.gl;t._webGL.glPoints=new Float32Array(t._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,t._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,t._webGL.glPoints,r.STATIC_DRAW),t._webGL.glIndicies=new Uint16Array(t._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t._webGL.glIndicies,r.STATIC_DRAW)},l.WebGLGraphics.buildRectangle=function(t,e){var i=t.points,r=i[0],s=i[1],n=i[2],a=i[3];if(t.fill){var h=o(t.fillColor),u=t.fillAlpha,c=h[0]*u,p=h[1]*u,d=h[2]*u,f=e.points,m=e.indices,v=f.length/6;f.push(r,s),f.push(c,p,d,u),f.push(r+n,s),f.push(c,p,d,u),f.push(r,s+a),f.push(c,p,d,u),f.push(r+n,s+a),f.push(c,p,d,u),m.push(v,v,v+1,v+2,v+3,v+3)}t.lineWidth&&(t.points=[r,s,r+n,s,r+n,s+a,r,s+a,r,s],l.WebGLGraphics.buildLine(t,e))},l.WebGLGraphics.buildCircle=function(t,e){var i=t.points,r=i[0],s=i[1],n=i[2],a=i[3],h=40,u=2*Math.PI/h;if(t.fill){var c=o(t.fillColor),p=t.fillAlpha,d=c[0]*p,f=c[1]*p,m=c[2]*p,v=e.points,y=e.indices,g=v.length/6;y.push(g);for(var b=0;h+1>b;b++)v.push(r,s,d,f,m,p),v.push(r+Math.sin(u*b)*n,s+Math.cos(u*b)*a,d,f,m,p),y.push(g++,g++);y.push(g-1)}if(t.lineWidth){t.points=[];for(var b=0;h+1>b;b++)t.points.push(r+Math.sin(u*b)*n,s+Math.cos(u*b)*a);l.WebGLGraphics.buildLine(t,e)}},l.WebGLGraphics.buildLine=function(t,e){var i=t.points;if(0!=i.length){var r=new l.Point(i[0],i[1]),s=new l.Point(i[i.length-2],i[i.length-1]);if(r.x==s.x&&r.y==s.y){i.pop(),i.pop(),s=new l.Point(i[i.length-2],i[i.length-1]);var n=s.x+.5*(r.x-s.x),a=s.y+.5*(r.y-s.y);i.unshift(n,a),i.push(n,a)}var h,u,c,p,d,f,m,v,y,g,b,x,_,T,w,S,A,E,C,R,L,P=e.points,M=e.indices,O=i.length/2,I=i.length,B=P.length/6,F=t.lineWidth/2,j=o(t.lineColor),k=t.lineAlpha,D=j[0]*k,G=j[1]*k,N=j[2]*k;h=i[0],u=i[1],c=i[2],p=i[3],m=-(u-p),v=h-c,L=Math.sqrt(m*m+v*v),m/=L,v/=L,m*=F,v*=F,P.push(h-m,u-v,D,G,N,k),P.push(h+m,u+v,D,G,N,k);for(var U=1;O-1>U;U++)h=i[2*(U-1)],u=i[2*(U-1)+1],c=i[2*U],p=i[2*U+1],d=i[2*(U+1)],f=i[2*(U+1)+1],m=-(u-p),v=h-c,L=Math.sqrt(m*m+v*v),m/=L,v/=L,m*=F,v*=F,y=-(p-f),g=c-d,L=Math.sqrt(y*y+g*g),y/=L,g/=L,y*=F,g*=F,_=-v+u-(-v+p),T=-m+c-(-m+h),w=(-m+h)*(-v+p)-(-m+c)*(-v+u),S=-g+f-(-g+p),A=-y+c-(-y+d),E=(-y+d)*(-g+p)-(-y+c)*(-g+f),C=_*A-S*T,0==C&&(C+=1),px=(T*E-A*w)/C,py=(S*w-_*E)/C,R=(px-c)*(px-c)+(py-p)+(py-p),R>19600?(b=m-y,x=v-g,L=Math.sqrt(b*b+x*x),b/=L,x/=L,b*=F,x*=F,P.push(c-b,p-x),P.push(D,G,N,k),P.push(c+b,p+x),P.push(D,G,N,k),P.push(c-b,p-x),P.push(D,G,N,k),I++):(P.push(px,py),P.push(D,G,N,k),P.push(c-(px-c),p-(py-p)),P.push(D,G,N,k));h=i[2*(O-2)],u=i[2*(O-2)+1],c=i[2*(O-1)],p=i[2*(O-1)+1],m=-(u-p),v=h-c,L=Math.sqrt(m*m+v*v),m/=L,v/=L,m*=F,v*=F,P.push(c-m,p-v),P.push(D,G,N,k),P.push(c+m,p+v),P.push(D,G,N,k),M.push(B);for(var U=0;I>U;U++)M.push(B++);M.push(B-1)}},l.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){for(var r=e.points,s=e.indices,n=i.length/2,a=o(t.fillColor),h=t.fillAlpha,u=a[0]*h,c=a[1]*h,p=a[2]*h,d=l.PolyK.Triangulate(i),f=r.length/6,m=0;m<d.length;m+=3)s.push(d[m]+f),s.push(d[m]+f),s.push(d[m+1]+f),s.push(d[m+2]+f),s.push(d[m+2]+f);for(var m=0;n>m;m++)r.push(i[2*m],i[2*m+1],u,c,p,h)}},l._defaultFrame=new l.Rectangle(0,0,1,1),l.gl,l.WebGLRenderer=function(t,e,i,r,s){this.transparent=!!r,this.width=t||800,this.height=e||600,this.view=i||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var n=this;this.view.addEventListener("webglcontextlost",function(t){n.handleContextLost(t)},!1),this.view.addEventListener("webglcontextrestored",function(t){n.handleContextRestored(t)},!1),this.batchs=[];var o={alpha:this.transparent,antialias:!!s,premultipliedAlpha:!1,stencil:!0};try{l.gl=this.gl=this.view.getContext("experimental-webgl",o)}catch(a){try{l.gl=this.gl=this.view.getContext("webgl",o)}catch(a){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}l.initDefaultShader(),l.initPrimitiveShader(),l.initDefaultStripShader();var h=this.gl;l.WebGLRenderer.gl=h,this.batch=new l.WebGLBatch(h),h.disable(h.DEPTH_TEST),h.disable(h.CULL_FACE),h.enable(h.BLEND),h.colorMask(!0,!0,!0,this.transparent),l.projection=new l.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,l.pushShader(l.defaultShader),this.stageRenderGroup=new l.WebGLRenderGroup(this.gl)},l.WebGLRenderer.prototype.constructor=l.WebGLRenderer,l.WebGLRenderer.getBatch=function(){return 0==l._batchs.length?new l.WebGLBatch(l.WebGLRenderer.gl):l._batchs.pop()},l.WebGLRenderer.returnBatch=function(t){t.clean(),l._batchs.push(t)},l.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t,this.stageRenderGroup.setRenderable(t)),l.WebGLRenderer.updateTextures(),l.visibleCount++,t.updateTransform();var e=this.gl;if(e.colorMask(!0,!0,!0,this.transparent),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],!this.transparent),e.clear(e.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=t.backgroundColorSplit,this.stageRenderGroup.render(l.projection),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),l.Texture.frameUpdates.length>0){for(var i=0;i<l.Texture.frameUpdates.length;i++)l.Texture.frameUpdates[i].updateFrame=!1;l.Texture.frameUpdates=[]}}},l.WebGLRenderer.updateTextures=function(){for(var t=0;t<l.texturesToUpdate.length;t++)l.WebGLRenderer.updateTexture(l.texturesToUpdate[t]);for(var t=0;t<l.texturesToDestroy.length;t++)l.WebGLRenderer.destroyTexture(l.texturesToDestroy[t]);l.texturesToUpdate=[],l.texturesToDestroy=[]},l.WebGLRenderer.updateTexture=function(t){var e=l.gl;t._glTexture||(t._glTexture=e.createTexture()),t.hasLoaded&&(e.bindTexture(e.TEXTURE_2D,t._glTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===l.BaseTexture.SCALE_MODE.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===l.BaseTexture.SCALE_MODE.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.bindTexture(e.TEXTURE_2D,null))},l.WebGLRenderer.destroyTexture=function(t){var e=l.gl;t._glTexture&&(t._glTexture=e.createTexture(),e.deleteTexture(e.TEXTURE_2D,t._glTexture))},l.WebGLRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e,this.gl.viewport(0,0,this.width,this.height),l.projection.x=this.width/2,l.projection.y=this.height/2},l.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},l.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in l.TextureCache){var e=l.TextureCache[t].baseTexture;e._glTexture=null,l.WebGLRenderer.updateTexture(e)}for(var i=0;i<this.batchs.length;i++)this.batchs[i].restoreLostContext(this.gl),this.batchs[i].dirty=!0;l._restoreBatchs(this.gl),this.contextLost=!1},l._batchs=[],l._getBatch=function(t){return 0==l._batchs.length?new l.WebGLBatch(t):l._batchs.pop()},l._returnBatch=function(t){t.clean(),l._batchs.push(t)},l._restoreBatchs=function(t){for(var e=0;e<l._batchs.length;e++)l._batchs[e].restoreLostContext(t)},l.WebGLBatch=function(t){this.gl=t,this.size=0,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.blendMode=l.blendModes.NORMAL,this.dynamicSize=1},l.WebGLBatch.prototype.constructor=l.WebGLBatch,l.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},l.WebGLBatch.prototype.restoreLostContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer()},l.WebGLBatch.prototype.init=function(t){t.batch=this,this.dirty=!0,this.blendMode=t.blendMode,this.texture=t.texture.baseTexture,this.head=t,this.tail=t,this.size=1,this.growBatch()},l.WebGLBatch.prototype.insertBefore=function(t,e){this.size++,t.batch=this,this.dirty=!0;var i=e.__prev;e.__prev=t,t.__next=e,i?(t.__prev=i,i.__next=t):this.head=t},l.WebGLBatch.prototype.insertAfter=function(t,e){this.size++,t.batch=this,this.dirty=!0;var i=e.__next;e.__next=t,t.__prev=e,i?(t.__next=i,i.__prev=t):this.tail=t},l.WebGLBatch.prototype.remove=function(t){return this.size--,0==this.size?(t.batch=null,t.__prev=null,t.__next=null,void 0):(t.__prev?t.__prev.__next=t.__next:(this.head=t.__next,this.head.__prev=null),t.__next?t.__next.__prev=t.__prev:(this.tail=t.__prev,this.tail.__next=null),t.batch=null,t.__next=null,t.__prev=null,this.dirty=!0,void 0)},l.WebGLBatch.prototype.split=function(t){this.dirty=!0;var e=new l.WebGLBatch(this.gl);e.init(t),e.texture=this.texture,e.tail=this.tail,this.tail=t.__prev,this.tail.__next=null,t.__prev=null;for(var i=0;t;)i++,t.batch=e,t=t.__next;return e.size=i,this.size-=i,e},l.WebGLBatch.prototype.merge=function(t){this.dirty=!0,this.tail.__next=t.head,t.head.__prev=this.tail,this.size+=t.size,this.tail=t.tail;for(var e=t.head;e;)e.batch=this,e=e.__next},l.WebGLBatch.prototype.growBatch=function(){var t=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var e=this.indices.length/6,i=0;e>i;i++){var r=6*i,s=4*i;this.indices[r+0]=s+0,this.indices[r+1]=s+1,this.indices[r+2]=s+2,this.indices[r+3]=s+0,this.indices[r+4]=s+2,this.indices[r+5]=s+3}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},l.WebGLBatch.prototype.refresh=function(){this.gl,this.dynamicSize<this.size&&this.growBatch();for(var t,e=0,i=this.head;i;){t=8*e;var r=i.texture,s=r.frame,n=r.baseTexture.width,o=r.baseTexture.height;this.uvs[t+0]=s.x/n,this.uvs[t+1]=s.y/o,this.uvs[t+2]=(s.x+s.width)/n,this.uvs[t+3]=s.y/o,this.uvs[t+4]=(s.x+s.width)/n,this.uvs[t+5]=(s.y+s.height)/o,this.uvs[t+6]=s.x/n,this.uvs[t+7]=(s.y+s.height)/o,i.updateFrame=!1,colorIndex=4*e,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=i.worldAlpha,i=i.__next,e++
}this.dirtyUVS=!0,this.dirtyColors=!0},l.WebGLBatch.prototype.update=function(){this.gl;for(var t,e,i,r,s,n,o,a,h,u,c,p,d,f,m,v,y=0,g=this.head,b=this.verticies,x=this.uvs,_=this.colors;g;){if(g.vcount===l.visibleCount){if(e=g.texture.frame.width,i=g.texture.frame.height,r=g.anchor.x,s=g.anchor.y,n=e*(1-r),o=e*-r,a=i*(1-s),h=i*-s,u=8*y,t=g.worldTransform,c=t[0],p=t[3],d=t[1],f=t[4],m=t[2],v=t[5],b[u+0]=c*o+d*h+m,b[u+1]=f*h+p*o+v,b[u+2]=c*n+d*h+m,b[u+3]=f*h+p*n+v,b[u+4]=c*n+d*a+m,b[u+5]=f*a+p*n+v,b[u+6]=c*o+d*a+m,b[u+7]=f*a+p*o+v,g.updateFrame||g.texture.updateFrame){this.dirtyUVS=!0;var T=g.texture,w=T.frame,S=T.baseTexture.width,A=T.baseTexture.height;x[u+0]=w.x/S,x[u+1]=w.y/A,x[u+2]=(w.x+w.width)/S,x[u+3]=w.y/A,x[u+4]=(w.x+w.width)/S,x[u+5]=(w.y+w.height)/A,x[u+6]=w.x/S,x[u+7]=(w.y+w.height)/A,g.updateFrame=!1}if(g.cacheAlpha!=g.worldAlpha){g.cacheAlpha=g.worldAlpha;var E=4*y;_[E]=_[E+1]=_[E+2]=_[E+3]=g.worldAlpha,this.dirtyColors=!0}}else u=8*y,b[u+0]=b[u+1]=b[u+2]=b[u+3]=b[u+4]=b[u+5]=b[u+6]=b[u+7]=0;y++,g=g.__next}},l.WebGLBatch.prototype.render=function(t,e){if(t=t||0,void 0==e&&(e=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var i=this.gl,r=l.currentShader;i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.verticies),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,i.bufferSubData(i.ARRAY_BUFFER,0,this.uvs)),i.vertexAttribPointer(r.textureCoordAttribute,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture._glTexture),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,i.bufferSubData(i.ARRAY_BUFFER,0,this.colors)),i.vertexAttribPointer(r.colorAttribute,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var s=e-t;i.drawElements(i.TRIANGLES,6*s,i.UNSIGNED_SHORT,6*2*t)}},l.WebGLRenderGroup=function(t){this.gl=t,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},l.WebGLRenderGroup.prototype.constructor=l.WebGLRenderGroup,l.WebGLRenderGroup.prototype.setRenderable=function(t){this.root&&this.removeDisplayObjectAndChildren(this.root),t.worldVisible=t.visible,this.root=t,this.addDisplayObjectAndChildren(t)},l.WebGLRenderGroup.prototype.render=function(t){l.WebGLRenderer.updateTextures();var e=this.gl;e.uniform2f(l.currentShader.projectionVector,t.x,t.y),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);for(var i,r=0;r<this.batchs.length;r++)if(i=this.batchs[r],i instanceof l.WebGLBatch)this.batchs[r].render();else{var s=i.vcount===l.visibleCount;i instanceof l.TilingSprite?s&&this.renderTilingSprite(i,t):i instanceof l.Strip?s&&this.renderStrip(i,t):i instanceof l.Graphics?s&&i.renderable&&l.WebGLGraphics.renderGraphics(i,t):i instanceof l.FilterBlock&&this.handleFilterBlock(i,t)}},l.WebGLRenderGroup.prototype.renderSpecific=function(t,e){l.WebGLRenderer.updateTextures();var i=this.gl;i.uniform2f(l.currentShader.projectionVector,e.x,e.y);for(var r,s,n,o,a=t.first;a._iNext&&(a=a._iNext,!a.renderable||!a.__renderGroup););var h=a.batch;if(a instanceof l.Sprite){h=a.batch;var u=h.head;if(u==a)r=0;else for(r=1;u.__next!=a;)r++,u=u.__next}else h=a;for(var c,p=t,d=t;d.children.length>0;)d=d.children[d.children.length-1],d.renderable&&(p=d.last);if(p instanceof l.Sprite){c=p.batch;var u=c.head;if(u==p)n=0;else for(n=1;u.__next!=p;)n++,u=u.__next}else c=p;if(h==c)return h instanceof l.WebGLBatch?h.render(r,n+1):this.renderSpecial(h,e),void 0;s=this.batchs.indexOf(h),o=this.batchs.indexOf(c),h instanceof l.WebGLBatch?h.render(r):this.renderSpecial(h,e);for(var f=s+1;o>f;f++)renderable=this.batchs[f],renderable instanceof l.WebGLBatch?this.batchs[f].render():this.renderSpecial(renderable,e);c instanceof l.WebGLBatch?c.render(0,n+1):this.renderSpecial(c,e)},l.WebGLRenderGroup.prototype.renderSpecial=function(t,e){l.shaderStack.length;var i=t.vcount===l.visibleCount;t instanceof l.TilingSprite?i&&this.renderTilingSprite(t,e):t instanceof l.Strip?i&&this.renderStrip(t,e):t instanceof l.CustomRenderable?i&&t.renderWebGL(this,e):t instanceof l.Graphics?i&&t.renderable&&l.WebGLGraphics.renderGraphics(t,e):t instanceof l.FilterBlock&&this.handleFilterBlock(t,e)},l.WebGLRenderGroup.prototype.handleFilterBlock=function(t,e){var i=l.gl;if(t.open)if(t.data instanceof Array){var r=t.data[0];if(!r.shader){var s=new l.PixiShader;s.fragmentSrc=r.fragmentSrc,s.uniforms=r.uniforms,s.init(),r.shader=s}l.pushShader(r.shader),i.uniform2f(l.currentShader.projectionVector,e.x,e.y)}else i.enable(i.STENCIL_TEST),i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,1,255),i.stencilOp(i.KEEP,i.KEEP,i.REPLACE),l.WebGLGraphics.renderGraphics(t.data,e),i.colorMask(!0,!0,!0,!0),i.stencilFunc(i.NOTEQUAL,0,255),i.stencilOp(i.KEEP,i.KEEP,i.KEEP);else t.data instanceof Array?(l.popShader(),i.uniform2f(l.currentShader.projectionVector,e.x,e.y)):i.disable(i.STENCIL_TEST)},l.WebGLRenderGroup.prototype.updateTexture=function(t){this.removeObject(t);for(var e=t.first;e!=this.root&&(e=e._iPrev,!e.renderable||!e.__renderGroup););for(var i=t.last;i._iNext&&(i=i._iNext,!i.renderable||!i.__renderGroup););this.insertObject(t,e,i)},l.WebGLRenderGroup.prototype.addFilterBlocks=function(t,e){t.__renderGroup=this,e.__renderGroup=this;for(var i=t;i!=this.root.first&&(i=i._iPrev,!i.renderable||!i.__renderGroup););this.insertAfter(t,i);for(var r=e;r!=this.root.first&&(r=r._iPrev,!r.renderable||!r.__renderGroup););this.insertAfter(e,r)},l.WebGLRenderGroup.prototype.removeFilterBlocks=function(t,e){this.removeObject(t),this.removeObject(e)},l.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(t){t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t);for(var e=t.first;e!=this.root.first&&(e=e._iPrev,!e.renderable||!e.__renderGroup););for(var i=t.last;i._iNext&&(i=i._iNext,!i.renderable||!i.__renderGroup););var r=t.first,s=t.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,e,i),e=r),r=r._iNext;while(r!=s)},l.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(t){if(t.__renderGroup==this){t.last;do t.__renderGroup=null,t.renderable&&this.removeObject(t),t=t._iNext;while(t)}},l.WebGLRenderGroup.prototype.insertObject=function(t,e,i){var r=e,s=i;if(t instanceof l.Sprite){var n,o;if(r instanceof l.Sprite){if(n=r.batch,n&&n.texture==t.texture.baseTexture&&n.blendMode==t.blendMode)return n.insertAfter(t,r),void 0}else n=r;if(s)if(s instanceof l.Sprite){if(o=s.batch){if(o.texture==t.texture.baseTexture&&o.blendMode==t.blendMode)return o.insertBefore(t,s),void 0;if(o==n){var a=n.split(s),h=l.WebGLRenderer.getBatch(),u=this.batchs.indexOf(n);return h.init(t),this.batchs.splice(u+1,0,h,a),void 0}}}else o=s;var h=l.WebGLRenderer.getBatch();if(h.init(t),n){var u=this.batchs.indexOf(n);this.batchs.splice(u+1,0,h)}else this.batchs.push(h)}else t instanceof l.TilingSprite?this.initTilingSprite(t):t instanceof l.Strip&&this.initStrip(t),this.insertAfter(t,r)},l.WebGLRenderGroup.prototype.insertAfter=function(t,e){if(e instanceof l.Sprite){var i=e.batch;if(i)if(i.tail==e){var r=this.batchs.indexOf(i);this.batchs.splice(r+1,0,t)}else{var s=i.split(e.__next),r=this.batchs.indexOf(i);this.batchs.splice(r+1,0,t,s)}else this.batchs.push(t)}else{var r=this.batchs.indexOf(e);this.batchs.splice(r+1,0,t)}},l.WebGLRenderGroup.prototype.removeObject=function(t){var e;if(t instanceof l.Sprite){var i=t.batch;if(!i)return;i.remove(t),0==i.size&&(e=i)}else e=t;if(e){var r=this.batchs.indexOf(e);if(-1==r)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),e instanceof l.WebGLBatch&&l.WebGLRenderer.returnBatch(e),void 0;if(this.batchs[r-1]instanceof l.WebGLBatch&&this.batchs[r+1]instanceof l.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),e instanceof l.WebGLBatch&&l.WebGLRenderer.returnBatch(e),l.WebGLRenderer.returnBatch(this.batchs[r+1]),this.batchs.splice(r,2),void 0;this.batchs.splice(r,1),e instanceof l.WebGLBatch&&l.WebGLRenderer.returnBatch(e)}},l.WebGLRenderGroup.prototype.initTilingSprite=function(t){var e=this.gl;t.verticies=new Float32Array([0,0,t.width,0,t.width,t.height,0,t.height]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.colors=new Float32Array([1,1,1,1]),t.indices=new Uint16Array([0,1,3,2]),t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW),t.texture.baseTexture._glTexture?(e.bindTexture(e.TEXTURE_2D,t.texture.baseTexture._glTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),t.texture.baseTexture._powerOf2=!0):t.texture.baseTexture._powerOf2=!0},l.WebGLRenderGroup.prototype.renderStrip=function(t,e){var i=this.gl,r=l.stripShaderProgram;i.useProgram(r);var s=l.mat3.clone(t.worldTransform);l.mat3.transpose(s),i.uniformMatrix3fv(r.translationMatrix,!1,s),i.uniform2f(r.projectionVector,e.x,e.y),i.uniform1f(r.alpha,t.worldAlpha),t.dirty?(t.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,t._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,t.verticies,i.STATIC_DRAW),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.bufferData(i.ARRAY_BUFFER,t.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.textureCoordAttribute,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texture.baseTexture._glTexture),i.bindBuffer(i.ARRAY_BUFFER,t._colorBuffer),i.bufferData(i.ARRAY_BUFFER,t.colors,i.STATIC_DRAW),i.vertexAttribPointer(r.colorAttribute,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,t._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,t.verticies),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.vertexAttribPointer(r.textureCoordAttribute,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texture.baseTexture._glTexture),i.bindBuffer(i.ARRAY_BUFFER,t._colorBuffer),i.vertexAttribPointer(r.colorAttribute,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._indexBuffer)),i.drawElements(i.TRIANGLE_STRIP,t.indices.length,i.UNSIGNED_SHORT,0),i.useProgram(l.currentProgram)},l.WebGLRenderGroup.prototype.renderTilingSprite=function(t,e){var i=this.gl;l.shaderProgram;var r=t.tilePosition,s=t.tileScale,n=r.x/t.texture.baseTexture.width,o=r.y/t.texture.baseTexture.height,a=t.width/t.texture.baseTexture.width/s.x,h=t.height/t.texture.baseTexture.height/s.y;t.uvs[0]=0-n,t.uvs[1]=0-o,t.uvs[2]=1*a-n,t.uvs[3]=0-o,t.uvs[4]=1*a-n,t.uvs[5]=1*h-o,t.uvs[6]=0-n,t.uvs[7]=1*h-o,i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,t.uvs),this.renderStrip(t,e)},l.WebGLRenderGroup.prototype.initStrip=function(t){var e=this.gl;this.shaderProgram,t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW)},l.CanvasRenderer=function(t,e,i,r){this.transparent=r,this.width=t||800,this.height=e||600,this.view=i||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.smoothProperty=null,"imageSmoothingEnabled"in this.context?this.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.smoothProperty="oImageSmoothingEnabled"),this.scaleMode=null,this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},l.CanvasRenderer.prototype.constructor=l.CanvasRenderer,l.CanvasRenderer.prototype.render=function(t){l.texturesToUpdate=[],l.texturesToDestroy=[],l.visibleCount++,t.updateTransform(),this.view.style.backgroundColor==t.backgroundColorString||this.transparent||(this.view.style.backgroundColor=t.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),l.Texture.frameUpdates.length>0&&(l.Texture.frameUpdates=[])},l.CanvasRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e},l.CanvasRenderer.prototype.renderDisplayObject=function(t){var e,i=this.context;i.globalCompositeOperation="source-over";var r=t.last._iNext;t=t.first;do if(e=t.worldTransform,t.visible)if(t.renderable){if(t instanceof l.Sprite){var s=t.texture.frame;s&&s.width&&s.height&&(i.globalAlpha=t.worldAlpha,i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.smoothProperty&&this.scaleMode!==t.texture.baseTexture.scaleMode&&(this.scaleMode=t.texture.baseTexture.scaleMode,i[this.smoothProperty]=this.scaleMode===l.BaseTexture.SCALE_MODE.LINEAR),i.drawImage(t.texture.baseTexture.source,s.x,s.y,s.width,s.height,t.anchor.x*-s.width,t.anchor.y*-s.height,s.width,s.height))}else if(t instanceof l.Strip)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderStrip(t);else if(t instanceof l.TilingSprite)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderTilingSprite(t);else if(t instanceof l.CustomRenderable)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),t.renderCanvas(this);else if(t instanceof l.Graphics)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),l.CanvasGraphics.renderGraphics(t,i);else if(t instanceof l.FilterBlock&&t.data instanceof l.Graphics){var n=t.data;if(t.open){i.save();var o=n.alpha,a=n.worldTransform;i.setTransform(a[0],a[3],a[1],a[4],a[2],a[5]),n.worldAlpha=.5,i.worldAlpha=0,l.CanvasGraphics.renderGraphicsMask(n,i),i.clip(),n.worldAlpha=o}else i.restore()}t=t._iNext}else t=t._iNext;else t=t.last._iNext;while(t!=r)},l.CanvasRenderer.prototype.renderStripFlat=function(t){var e=this.context,i=t.verticies;t.uvs;var r=i.length/2;this.count++,e.beginPath();for(var s=1;r-2>s;s++){var n=2*s,o=i[n],a=i[n+2],h=i[n+4],l=i[n+1],u=i[n+3],c=i[n+5];e.moveTo(o,l),e.lineTo(a,u),e.lineTo(h,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},l.CanvasRenderer.prototype.renderTilingSprite=function(t){var e=this.context;e.globalAlpha=t.worldAlpha,t.__tilePattern||(t.__tilePattern=e.createPattern(t.texture.baseTexture.source,"repeat")),e.beginPath();var i=t.tilePosition,r=t.tileScale;e.scale(r.x,r.y),e.translate(i.x,i.y),e.fillStyle=t.__tilePattern,e.fillRect(-i.x,-i.y,t.width/r.x,t.height/r.y),e.scale(1/r.x,1/r.y),e.translate(-i.x,-i.y),e.closePath()},l.CanvasRenderer.prototype.renderStrip=function(t){var e=this.context,i=t.verticies,r=t.uvs,s=i.length/2;this.count++;for(var n=1;s-2>n;n++){var o=2*n,a=i[o],h=i[o+2],l=i[o+4],u=i[o+1],c=i[o+3],p=i[o+5],d=r[o]*t.texture.width,f=r[o+2]*t.texture.width,m=r[o+4]*t.texture.width,v=r[o+1]*t.texture.height,y=r[o+3]*t.texture.height,g=r[o+5]*t.texture.height;e.save(),e.beginPath(),e.moveTo(a,u),e.lineTo(h,c),e.lineTo(l,p),e.closePath(),e.clip();var b=d*y+v*m+f*g-y*m-v*f-d*g,x=a*y+v*l+h*g-y*l-v*h-a*g,_=d*h+a*m+f*l-h*m-a*f-d*l,T=d*y*l+v*h*m+a*f*g-a*y*m-v*f*l-d*h*g,w=u*y+v*p+c*g-y*p-v*c-u*g,S=d*c+u*m+f*p-c*m-u*f-d*p,A=d*y*p+v*c*m+u*f*g-u*y*m-v*f*p-d*c*g;e.transform(x/b,w/b,_/b,S/b,T/b,A/b),e.drawImage(t.texture.baseTexture.source,0,0),e.restore()}},l.CanvasGraphics=function(){},l.CanvasGraphics.renderGraphics=function(t,e){for(var i=t.worldAlpha,r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],n=s.points;if(e.strokeStyle=color="#"+("00000"+(0|s.lineColor).toString(16)).substr(-6),e.lineWidth=s.lineWidth,s.type==l.Graphics.POLY){e.beginPath(),e.moveTo(n[0],n[1]);for(var o=1;o<n.length/2;o++)e.lineTo(n[2*o],n[2*o+1]);n[0]==n[n.length-2]&&n[1]==n[n.length-1]&&e.closePath(),s.fill&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|s.fillColor).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.stroke())}else if(s.type==l.Graphics.RECT)(s.fillColor||0===s.fillColor)&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|s.fillColor).toString(16)).substr(-6),e.fillRect(n[0],n[1],n[2],n[3])),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.strokeRect(n[0],n[1],n[2],n[3]));else if(s.type==l.Graphics.CIRC)e.beginPath(),e.arc(n[0],n[1],n[2],0,2*Math.PI),e.closePath(),s.fill&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|s.fillColor).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.stroke());else if(s.type==l.Graphics.ELIP){var a=s.points,h=2*a[2],u=2*a[3],c=a[0]-h/2,p=a[1]-u/2;e.beginPath();var d=.5522848,f=h/2*d,m=u/2*d,v=c+h,y=p+u,g=c+h/2,b=p+u/2;e.moveTo(c,b),e.bezierCurveTo(c,b-m,g-f,p,g,p),e.bezierCurveTo(g+f,p,v,b-m,v,b),e.bezierCurveTo(v,b+m,g+f,y,g,y),e.bezierCurveTo(g-f,y,c,b+m,c,b),e.closePath(),s.fill&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|s.fillColor).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.stroke())}}},l.CanvasGraphics.renderGraphicsMask=function(t,e){t.worldAlpha;var i=t.graphicsData.length;i>1&&(i=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;1>r;r++){var s=t.graphicsData[r],n=s.points;if(s.type==l.Graphics.POLY){e.beginPath(),e.moveTo(n[0],n[1]);for(var o=1;o<n.length/2;o++)e.lineTo(n[2*o],n[2*o+1]);n[0]==n[n.length-2]&&n[1]==n[n.length-1]&&e.closePath()}else if(s.type==l.Graphics.RECT)e.beginPath(),e.rect(n[0],n[1],n[2],n[3]),e.closePath();else if(s.type==l.Graphics.CIRC)e.beginPath(),e.arc(n[0],n[1],n[2],0,2*Math.PI),e.closePath();else if(s.type==l.Graphics.ELIP){var a=s.points,h=2*a[2],u=2*a[3],c=a[0]-h/2,p=a[1]-u/2;e.beginPath();var d=.5522848,f=h/2*d,m=u/2*d,v=c+h,y=p+u,g=c+h/2,b=p+u/2;e.moveTo(c,b),e.bezierCurveTo(c,b-m,g-f,p,g,p),e.bezierCurveTo(g+f,p,v,b-m,v,b),e.bezierCurveTo(v,b+m,g+f,y,g,y),e.bezierCurveTo(g-f,y,c,b+m,c,b),e.closePath()}}},l.Graphics=function(){l.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},l.Graphics.prototype=Object.create(l.DisplayObjectContainer.prototype),l.Graphics.prototype.constructor=l.Graphics,l.Graphics.prototype.lineStyle=function(t,e,i){0==this.currentPath.points.length&&this.graphicsData.pop(),this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0==i?1:i,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:l.Graphics.POLY},this.graphicsData.push(this.currentPath)},l.Graphics.prototype.moveTo=function(t,e){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:l.Graphics.POLY},this.currentPath.points.push(t,e),this.graphicsData.push(this.currentPath)},l.Graphics.prototype.lineTo=function(t,e){this.currentPath.points.push(t,e),this.dirty=!0},l.Graphics.prototype.beginFill=function(t,e){this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0==e?1:e},l.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},l.Graphics.prototype.drawRect=function(t,e,i,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,e,i,r],type:l.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},l.Graphics.prototype.drawCircle=function(t,e,i){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,e,i,i],type:l.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},l.Graphics.prototype.drawElipse=function(t,e,i,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,e,i,r],type:l.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},l.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},l.Graphics.POLY=0,l.Graphics.RECT=1,l.Graphics.CIRC=2,l.Graphics.ELIP=3,l.Strip=function(t,e,i){l.DisplayObjectContainer.call(this),this.texture=t,this.blendMode=l.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=e,this.height=i,t.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},l.Strip.prototype=Object.create(l.DisplayObjectContainer.prototype),l.Strip.prototype.constructor=l.Strip,l.Strip.prototype.setTexture=function(t){this.texture=t,this.width=t.frame.width,this.height=t.frame.height,this.updateFrame=!0},l.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},l.Rope=function(t,e){l.Strip.call(this,t),this.points=e;try{this.verticies=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length)}catch(i){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},l.Rope.prototype=Object.create(l.Strip.prototype),l.Rope.prototype.constructor=l.Rope,l.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=this.indices,r=this.colors,s=t[0],n=t[0];this.count-=.2,e[0]=0,e[1]=1,e[2]=0,e[3]=1,r[0]=1,r[1]=1,i[0]=0,i[1]=1;for(var o=t.length,a=1;o>a;a++){var n=t[a],h=4*a,l=a/(o-1);a%2?(e[h]=l,e[h+1]=0,e[h+2]=l,e[h+3]=1):(e[h]=l,e[h+1]=0,e[h+2]=l,e[h+3]=1),h=2*a,r[h]=1,r[h+1]=1,h=2*a,i[h]=h,i[h+1]=h+1,s=n}}},l.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e,i=this.verticies,r=t[0],s={x:0,y:0},n=t[0];this.count-=.2,i[0]=n.x+s.x,i[1]=n.y+s.y,i[2]=n.x-s.x,i[3]=n.y-s.y;for(var o=t.length,a=1;o>a;a++){var n=t[a],h=4*a;e=a<t.length-1?t[a+1]:n,s.y=-(e.x-r.x),s.x=e.y-r.y;var u=10*(1-a/(o-1));u>1&&(u=1);var c=Math.sqrt(s.x*s.x+s.y*s.y),p=this.texture.height/2;s.x/=c,s.y/=c,s.x*=p,s.y*=p,i[h]=n.x+s.x,i[h+1]=n.y+s.y,i[h+2]=n.x-s.x,i[h+3]=n.y-s.y,r=n}l.DisplayObjectContainer.prototype.updateTransform.call(this)}},l.Rope.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},l.TilingSprite=function(t,e,i){l.DisplayObjectContainer.call(this),this.texture=t,this.width=e,this.height=i,this.tileScale=new l.Point(1,1),this.tilePosition=new l.Point(0,0),this.renderable=!0,this.blendMode=l.blendModes.NORMAL},l.TilingSprite.prototype=Object.create(l.DisplayObjectContainer.prototype),l.TilingSprite.prototype.constructor=l.TilingSprite,l.TilingSprite.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},l.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},l.Spine=function(t){if(l.DisplayObjectContainer.call(this),this.spineData=l.AnimCache[t],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.skeleton=new f.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new f.AnimationStateData(this.spineData),this.state=new f.AnimationState(this.stateData),this.slotContainers=[];for(var e=0,i=this.skeleton.drawOrder.length;i>e;e++){var r=this.skeleton.drawOrder[e],s=r.attachment,n=new l.DisplayObjectContainer;if(this.slotContainers.push(n),this.addChild(n),s instanceof f.RegionAttachment){var o=s.rendererObject.name,a=this.createSprite(r,s.rendererObject);r.currentSprite=a,r.currentSpriteName=o,n.addChild(a)}}},l.Spine.prototype=Object.create(l.DisplayObjectContainer.prototype),l.Spine.prototype.constructor=l.Spine,l.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var e=this.skeleton.drawOrder,i=0,r=e.length;r>i;i++){var s=e[i],n=s.attachment,o=this.slotContainers[i];if(n instanceof f.RegionAttachment){if(n.rendererObject&&(!s.currentSpriteName||s.currentSpriteName!=n.name)){var a=n.rendererObject.name;if(void 0!==s.currentSprite&&(s.currentSprite.visible=!1),s.sprites=s.sprites||{},void 0!==s.sprites[a])s.sprites[a].visible=!0;else{var h=this.createSprite(s,n.rendererObject);o.addChild(h)}s.currentSprite=s.sprites[a],s.currentSpriteName=a}o.visible=!0;var u=s.bone;o.position.x=u.worldX+n.x*u.m00+n.y*u.m01,o.position.y=u.worldY+n.x*u.m10+n.y*u.m11,o.scale.x=u.worldScaleX,o.scale.y=u.worldScaleY,o.rotation=-(s.bone.worldRotation*Math.PI/180)}else o.visible=!1}l.DisplayObjectContainer.prototype.updateTransform.call(this)},l.Spine.prototype.createSprite=function(t,e){var i=l.TextureCache[e.name]?e.name:e.name+".png",r=new l.Sprite(l.Texture.fromFrame(i));return r.scale=e.scale,r.rotation=e.rotation,r.anchor.x=r.anchor.y=.5,t.sprites=t.sprites||{},t.sprites[e.name]=r,r};var f={};return f.BoneData=function(t,e){this.name=t,this.parent=e},f.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},f.SlotData=function(t,e){this.name=t,this.boneData=e},f.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},f.Bone=function(t,e){this.data=t,this.parent=e,this.setToSetupPose()},f.Bone.yDown=!1,f.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(t,e){var i=this.parent;null!=i?(this.worldX=this.x*i.m00+this.y*i.m01+i.worldX,this.worldY=this.x*i.m10+this.y*i.m11+i.worldY,this.worldScaleX=i.worldScaleX*this.scaleX,this.worldScaleY=i.worldScaleY*this.scaleY,this.worldRotation=i.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,s=Math.cos(r),n=Math.sin(r);this.m00=s*this.worldScaleX,this.m10=n*this.worldScaleX,this.m01=-n*this.worldScaleY,this.m11=s*this.worldScaleY,t&&(this.m00=-this.m00,this.m01=-this.m01),e&&(this.m10=-this.m10,this.m11=-this.m11),f.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY}},f.Slot=function(t,e,i){this.data=t,this.skeleton=e,this.bone=i,this.setToSetupPose()},f.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(t){this.attachment=t,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(t){this._attachmentTime=this.skeleton.time-t},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.skeleton.data.slots,i=0,r=e.length;r>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},f.Skin=function(t){this.name=t,this.attachments={}},f.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var r=i.indexOf(":"),s=parseInt(i.substring(0,r)),n=i.substring(r+1),o=t.slots[s];if(o.attachment&&o.attachment.name==n){var a=this.getAttachment(s,n);a&&o.setAttachment(a)}}}},f.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},f.Animation.prototype={apply:function(t,e,i){i&&0!=this.duration&&(e%=this.duration);for(var r=this.timelines,s=0,n=r.length;n>s;s++)r[s].apply(t,e,1)},mix:function(t,e,i,r){i&&0!=this.duration&&(e%=this.duration);for(var s=this.timelines,n=0,o=s.length;o>n;n++)s[n].apply(t,e,r)}},f.binarySearch=function(t,e,i){var r=0,s=Math.floor(t.length/i)-2;if(0==s)return i;for(var n=s>>>1;;){if(t[(n+1)*i]<=e?r=n+1:s=n,r==s)return(r+1)*i;n=r+s>>>1}},f.linearSearch=function(t,e,i){for(var r=0,s=t.length-i;s>=r;r+=i)if(t[r]>e)return r;return-1},f.Curves=function(t){this.curves=[],this.curves.length=6*(t-1)},f.Curves.prototype={setLinear:function(t){this.curves[6*t]=0},setStepped:function(t){this.curves[6*t]=-1},setCurve:function(t,e,i,r,s){var n=.1,o=n*n,a=o*n,h=3*n,l=3*o,u=6*o,c=6*a,p=2*-e+r,d=2*-i+s,f=3*(e-r)+1,m=3*(i-s)+1,v=6*t,y=this.curves;y[v]=e*h+p*l+f*a,y[v+1]=i*h+d*l+m*a,y[v+2]=p*u+f*c,y[v+3]=d*u+m*c,y[v+4]=f*c,y[v+5]=m*c},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=6*t,r=this.curves,s=r[i];if(!s)return e;if(-1==s)return 0;for(var n=r[i+1],o=r[i+2],a=r[i+3],h=r[i+4],l=r[i+5],u=s,c=n,p=8;;){if(u>=e){var d=u-s,f=c-n;return f+(c-f)*(e-d)/(u-d)}if(0==p)break;p--,s+=o,n+=a,o+=h,a+=l,u+=s,c+=n}return c+(1-c)*(e-u)/(1-u)}},f.RotateTimeline=function(t){this.curves=new f.Curves(t),this.frames=[],this.frames.length=2*t},f.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var s=t.bones[this.boneIndex];if(e>=r[r.length-2]){for(var n=s.data.rotation+r[r.length-1]-s.rotation;n>180;)n-=360;for(;-180>n;)n+=360;return s.rotation+=n*i,void 0}var o=f.binarySearch(r,e,2),a=r[o-1],h=r[o],l=1-(e-h)/(r[o-2]-h);l=this.curves.getCurvePercent(o/2-1,l);for(var n=r[o+1]-a;n>180;)n-=360;for(;-180>n;)n+=360;for(n=s.data.rotation+(a+n*l)-s.rotation;n>180;)n-=360;for(;-180>n;)n+=360;s.rotation+=n*i}}},f.TranslateTimeline=function(t){this.curves=new f.Curves(t),this.frames=[],this.frames.length=3*t},f.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var s=t.bones[this.boneIndex];if(e>=r[r.length-3])return s.x+=(s.data.x+r[r.length-2]-s.x)*i,s.y+=(s.data.y+r[r.length-1]-s.y)*i,void 0;var n=f.binarySearch(r,e,3),o=r[n-2],a=r[n-1],h=r[n],l=1-(e-h)/(r[n+-3]-h);l=this.curves.getCurvePercent(n/3-1,l),s.x+=(s.data.x+o+(r[n+1]-o)*l-s.x)*i,s.y+=(s.data.y+a+(r[n+2]-a)*l-s.y)*i}}},f.ScaleTimeline=function(t){this.curves=new f.Curves(t),this.frames=[],this.frames.length=3*t},f.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var s=t.bones[this.boneIndex];
if(e>=r[r.length-3])return s.scaleX+=(s.data.scaleX-1+r[r.length-2]-s.scaleX)*i,s.scaleY+=(s.data.scaleY-1+r[r.length-1]-s.scaleY)*i,void 0;var n=f.binarySearch(r,e,3),o=r[n-2],a=r[n-1],h=r[n],l=1-(e-h)/(r[n+-3]-h);l=this.curves.getCurvePercent(n/3-1,l),s.scaleX+=(s.data.scaleX-1+o+(r[n+1]-o)*l-s.scaleX)*i,s.scaleY+=(s.data.scaleY-1+a+(r[n+2]-a)*l-s.scaleY)*i}}},f.ColorTimeline=function(t){this.curves=new f.Curves(t),this.frames=[],this.frames.length=5*t},f.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e){t*=5,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=g,this.frames[t+3]=b,this.frames[t+4]=a},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var s=t.slots[this.slotIndex];if(e>=r[r.length-5]){var n=r.length-1;return s.r=r[n-3],s.g=r[n-2],s.b=r[n-1],s.a=r[n],void 0}var o=f.binarySearch(r,e,5),a=r[o-4],h=r[o-3],l=r[o-2],u=r[o-1],c=r[o],p=1-(e-c)/(r[o-5]-c);p=this.curves.getCurvePercent(o/5-1,p);var d=a+(r[o+1]-a)*p,m=h+(r[o+2]-h)*p,v=l+(r[o+3]-l)*p,y=u+(r[o+4]-u)*p;1>i?(s.r+=(d-s.r)*i,s.g+=(m-s.g)*i,s.b+=(v-s.b)*i,s.a+=(y-s.a)*i):(s.r=d,s.g=m,s.b=v,s.a=y)}}},f.AttachmentTimeline=function(t){this.curves=new f.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},f.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e){var i=this.frames;if(!(e<i[0])){var r;r=e>=i[i.length-1]?i.length-1:f.binarySearch(i,e,1)-1;var s=this.attachmentNames[r];t.slots[this.slotIndex].setAttachment(s?t.getAttachmentBySlotIndex(this.slotIndex,s):null)}}},f.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},f.SkeletonData.prototype={defaultSkin:null,findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null}},f.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;i>e;e++){var r=t.bones[e],s=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new f.Bone(r,s))}this.slots=[],this.drawOrder=[];for(var e=0,i=t.slots.length;i>e;e++){var n=t.slots[e],o=this.bones[t.bones.indexOf(n.boneData)],a=new f.Slot(n,this,o);this.slots.push(a),this.drawOrder.push(a)}},f.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var t=this.flipX,e=this.flipY,i=this.bones,r=0,s=i.length;s>r;r++)i[r].updateWorldTransform(t,e)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose()},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,i=t.length;i>e;e++)t[e].setToSetupPose(e)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){this.skin&&t&&t._attachAll(this,this.skin),this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,r=0,s=i.size;s>r;r++){var n=i[r];if(n.data.name==t){var o=null;if(e&&(o=this.getAttachment(r,e),null==o))throw"Attachment not found: "+e+", for slot: "+t;return n.setAttachment(o),void 0}}throw"Slot not found: "+t},update:function(t){time+=t}},f.AttachmentType={region:0},f.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},f.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,r,s){var n=this.uvs;s?(n[2]=t,n[3]=r,n[4]=t,n[5]=e,n[6]=i,n[7]=e,n[0]=i,n[1]=r):(n[0]=t,n[1]=r,n[2]=t,n[3]=e,n[4]=i,n[5]=e,n[6]=i,n[7]=r)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*e,s=i+this.regionWidth*t,n=r+this.regionHeight*e,o=this.rotation*Math.PI/180,a=Math.cos(o),h=Math.sin(o),l=i*a+this.x,u=i*h,c=r*a+this.y,p=r*h,d=s*a+this.x,f=s*h,m=n*a+this.y,v=n*h,y=this.offset;y[0]=l-p,y[1]=c+u,y[2]=l-v,y[3]=m+u,y[4]=d-v,y[5]=m+f,y[6]=d-p,y[7]=c+f},computeVertices:function(t,e,i,r){t+=i.worldX,e+=i.worldY;var s=i.m00,n=i.m01,o=i.m10,a=i.m11,h=this.offset;r[0]=h[0]*s+h[1]*n+t,r[1]=h[0]*o+h[1]*a+e,r[2]=h[2]*s+h[3]*n+t,r[3]=h[2]*o+h[3]*a+e,r[4]=h[4]*s+h[5]*n+t,r[5]=h[4]*o+h[5]*a+e,r[6]=h[6]*s+h[7]*n+t,r[7]=h[6]*o+h[7]*a+e}},f.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},f.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var r=this.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;var s=this.skeletonData.findAnimation(e);if(!s)throw"Animation not found: "+e;this.setMix(r,s,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=this.animationToMixTime[t.name+":"+e.name];return i?i:this.defaultMix}},f.AnimationState=function(t){this.data=t,this.queue=[]},f.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(t){if(this.currentTime+=t,this.previousTime+=t,this.mixTime+=t,this.queue.length>0){var e=this.queue[0];this.currentTime>=e.delay&&(this._setAnimation(e.animation,e.loop),this.queue.shift())}},apply:function(t){if(this.current)if(this.previous){this.previous.apply(t,this.previousTime,this.previousLoop);var e=this.mixTime/this.mixDuration;e>=1&&(e=1,this.previous=null),this.current.mix(t,this.currentTime,this.currentLoop,e)}else this.current.apply(t,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(t,e){this.previous=null,t&&this.current&&(this.mixDuration=this.data.getMix(this.current,t),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=t,this.currentLoop=e,this.currentTime=0},setAnimationByName:function(t,e){var i=this.data.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setAnimation(i,e)},setAnimation:function(t,e){this.queue.length=0,this._setAnimation(t,e)},addAnimationByName:function(t,e,i){var r=this.data.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;this.addAnimation(r,e,i)},addAnimation:function(t,e,i){var r={};if(r.animation=t,r.loop=e,!i||0>=i){var s=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;i=null!=s?s.duration-this.data.getMix(s,t)+(i||0):0}r.delay=i,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},f.SkeletonJson=function(t){this.attachmentLoader=t},f.SkeletonJson.prototype={scale:1,readSkeletonData:function(t){for(var e=new f.SkeletonData,i=t.bones,r=0,s=i.length;s>r;r++){var n=i[r],o=null;if(n.parent&&(o=e.findBone(n.parent),!o))throw"Parent bone not found: "+n.parent;var a=new f.BoneData(n.name,o);a.length=(n.length||0)*this.scale,a.x=(n.x||0)*this.scale,a.y=(n.y||0)*this.scale,a.rotation=n.rotation||0,a.scaleX=n.scaleX||1,a.scaleY=n.scaleY||1,e.bones.push(a)}for(var h=t.slots,r=0,s=h.length;s>r;r++){var l=h[r],a=e.findBone(l.bone);if(!a)throw"Slot bone not found: "+l.bone;var u=new f.SlotData(l.name,a),c=l.color;c&&(u.r=f.SkeletonJson.toColor(c,0),u.g=f.SkeletonJson.toColor(c,1),u.b=f.SkeletonJson.toColor(c,2),u.a=f.SkeletonJson.toColor(c,3)),u.attachmentName=l.attachment,e.slots.push(u)}var p=t.skins;for(var d in p)if(p.hasOwnProperty(d)){var m=p[d],v=new f.Skin(d);for(var y in m)if(m.hasOwnProperty(y)){var g=e.findSlotIndex(y),b=m[y];for(var x in b)if(b.hasOwnProperty(x)){var _=this.readAttachment(v,x,b[x]);null!=_&&v.addAttachment(g,x,_)}}e.skins.push(v),"default"==v.name&&(e.defaultSkin=v)}var T=t.animations;for(var w in T)T.hasOwnProperty(w)&&this.readAnimation(w,T[w],e);return e},readAttachment:function(t,e,i){e=i.name||e;var r=f.AttachmentType[i.type||"region"];if(r==f.AttachmentType.region){var s=new f.RegionAttachment;return s.x=(i.x||0)*this.scale,s.y=(i.y||0)*this.scale,s.scaleX=i.scaleX||1,s.scaleY=i.scaleY||1,s.rotation=i.rotation||0,s.width=(i.width||32)*this.scale,s.height=(i.height||32)*this.scale,s.updateOffset(),s.rendererObject={},s.rendererObject.name=e,s.rendererObject.scale={},s.rendererObject.scale.x=s.scaleX,s.rendererObject.scale.y=s.scaleY,s.rendererObject.rotation=-s.rotation*Math.PI/180,s}throw"Unknown attachment type: "+r},readAnimation:function(t,e,i){var r=[],s=0,n=e.bones;for(var o in n)if(n.hasOwnProperty(o)){var a=i.findBoneIndex(o);if(-1==a)throw"Bone not found: "+o;var h=n[o];for(var l in h)if(h.hasOwnProperty(l)){var u=h[l];if("rotate"==l){var c=new f.RotateTimeline(u.length);c.boneIndex=a;for(var p=0,d=0,m=u.length;m>d;d++){var v=u[d];c.setFrame(p,v.time,v.angle),f.SkeletonJson.readCurve(c,p,v),p++}r.push(c),s=Math.max(s,c.frames[2*c.getFrameCount()-2])}else{if("translate"!=l&&"scale"!=l)throw"Invalid timeline type for a bone: "+l+" ("+o+")";var c,y=1;"scale"==l?c=new f.ScaleTimeline(u.length):(c=new f.TranslateTimeline(u.length),y=this.scale),c.boneIndex=a;for(var p=0,d=0,m=u.length;m>d;d++){var v=u[d],g=(v.x||0)*y,b=(v.y||0)*y;c.setFrame(p,v.time,g,b),f.SkeletonJson.readCurve(c,p,v),p++}r.push(c),s=Math.max(s,c.frames[3*c.getFrameCount()-3])}}}var x=e.slots;for(var _ in x)if(x.hasOwnProperty(_)){var T=x[_],w=i.findSlotIndex(_);for(var l in T)if(T.hasOwnProperty(l)){var u=T[l];if("color"==l){var c=new f.ColorTimeline(u.length);c.slotIndex=w;for(var p=0,d=0,m=u.length;m>d;d++){var v=u[d],S=v.color,A=f.SkeletonJson.toColor(S,0),E=f.SkeletonJson.toColor(S,1),C=f.SkeletonJson.toColor(S,2),R=f.SkeletonJson.toColor(S,3);c.setFrame(p,v.time,A,E,C,R),f.SkeletonJson.readCurve(c,p,v),p++}r.push(c),s=Math.max(s,c.frames[5*c.getFrameCount()-5])}else{if("attachment"!=l)throw"Invalid timeline type for a slot: "+l+" ("+_+")";var c=new f.AttachmentTimeline(u.length);c.slotIndex=w;for(var p=0,d=0,m=u.length;m>d;d++){var v=u[d];c.setFrame(p++,v.time,v.name)}r.push(c),s=Math.max(s,c.frames[c.getFrameCount()-1])}}}i.animations.push(new f.Animation(t,r,s))}},f.SkeletonJson.readCurve=function(t,e,i){var r=i.curve;r&&("stepped"==r?t.curves.setStepped(e):r instanceof Array&&t.curves.setCurve(e,r[0],r[1],r[2],r[3]))},f.SkeletonJson.toColor=function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2),16)/255},f.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new f.AtlasReader(t),r=[];r.length=4;for(var s=null;;){var n=i.readLine();if(null==n)break;if(n=i.trim(n),0==n.length)s=null;else if(s){var o=new f.AtlasRegion;o.name=n,o.page=s,o.rotate="true"==i.readValue(),i.readTuple(r);var a=parseInt(r[0]),h=parseInt(r[1]);i.readTuple(r);var l=parseInt(r[0]),u=parseInt(r[1]);o.u=a/s.width,o.v=h/s.height,o.rotate?(o.u2=(a+u)/s.width,o.v2=(h+l)/s.height):(o.u2=(a+l)/s.width,o.v2=(h+u)/s.height),o.x=a,o.y=h,o.width=Math.abs(l),o.height=Math.abs(u),4==i.readTuple(r)&&(o.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==i.readTuple(r)&&(o.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],i.readTuple(r))),o.originalWidth=parseInt(r[0]),o.originalHeight=parseInt(r[1]),i.readTuple(r),o.offsetX=parseInt(r[0]),o.offsetY=parseInt(r[1]),o.index=parseInt(i.readValue()),this.regions.push(o)}else{s=new f.AtlasPage,s.name=n,s.format=f.Atlas.Format[i.readValue()],i.readTuple(r),s.minFilter=f.Atlas.TextureFilter[r[0]],s.magFilter=f.Atlas.TextureFilter[r[1]];var c=i.readValue();s.uWrap=f.Atlas.TextureWrap.clampToEdge,s.vWrap=f.Atlas.TextureWrap.clampToEdge,"x"==c?s.uWrap=f.Atlas.TextureWrap.repeat:"y"==c?s.vWrap=f.Atlas.TextureWrap.repeat:"xy"==c&&(s.uWrap=s.vWrap=f.Atlas.TextureWrap.repeat),e.load(s,n),this.pages.push(s)}}},f.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++){var s=e[i];s.page==t&&(s.u=s.x/t.width,s.v=s.y/t.height,s.rotate?(s.u2=(s.x+s.height)/t.width,s.v2=(s.y+s.width)/t.height):(s.u2=(s.x+s.width)/t.width,s.v2=(s.y+s.height)/t.height))}}},f.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},f.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},f.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},f.AtlasPage=function(){},f.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},f.AtlasRegion=function(){},f.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},f.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},f.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var r=0,s=i+1;3>r;r++){var n=e.indexOf(",",s);if(-1==n){if(0==r)throw"Invalid line: "+e;break}t[r]=this.trim(e.substr(s,n-s)),s=n+1}return t[r]=this.trim(e.substring(s)),r+1}},f.AtlasAttachmentLoader=function(t){this.atlas=t},f.AtlasAttachmentLoader.prototype={newAttachment:function(t,e,i){switch(e){case f.AttachmentType.region:var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" ("+e+")";var s=new f.RegionAttachment(i);return s.rendererObject=r,s.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s}throw"Unknown attachment type: "+e}},l.AnimCache={},f.Bone.yDown=!0,l.CustomRenderable=function(){l.DisplayObject.call(this),this.renderable=!0},l.CustomRenderable.prototype=Object.create(l.DisplayObject.prototype),l.CustomRenderable.prototype.constructor=l.CustomRenderable,l.CustomRenderable.prototype.renderCanvas=function(){},l.CustomRenderable.prototype.initWebGL=function(){},l.CustomRenderable.prototype.renderWebGL=function(){},l.BaseTextureCache={},l.texturesToUpdate=[],l.texturesToDestroy=[],l.BaseTexture=function(t,e){if(l.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=e||l.BaseTexture.SCALE_MODE.DEFAULT,this.hasLoaded=!1,this.source=t,t){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,l.texturesToUpdate.push(this);else{var i=this;this.source.onload=function(){i.hasLoaded=!0,i.width=i.source.width,i.height=i.source.height,l.texturesToUpdate.push(i),i.dispatchEvent({type:"loaded",content:i})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,l.texturesToUpdate.push(this);this._powerOf2=!1}},l.BaseTexture.prototype.constructor=l.BaseTexture,l.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,l.texturesToDestroy.push(this)},l.BaseTexture.fromImage=function(t,e,i){var r=l.BaseTextureCache[t];if(!r){var s=new Image;e&&(s.crossOrigin=""),s.src=t,r=new l.BaseTexture(s,i),l.BaseTextureCache[t]=r}return r},l.BaseTexture.SCALE_MODE={DEFAULT:0,LINEAR:0,NEAREST:1},l.TextureCache={},l.FrameCache={},l.Texture=function(t,e){if(l.EventTarget.call(this),e||(this.noFrame=!0,e=new l.Rectangle(0,0,1,1)),t instanceof l.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.trim=new l.Point,this.scope=this,t.hasLoaded)this.noFrame&&(e=new l.Rectangle(0,0,t.width,t.height)),this.setFrame(e);else{var i=this;t.addEventListener("loaded",function(){i.onBaseTextureLoaded()})}},l.Texture.prototype.constructor=l.Texture,l.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new l.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},l.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy()},l.Texture.prototype.setFrame=function(t){if(this.frame=t,this.width=t.width,this.height=t.height,t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,l.Texture.frameUpdates.push(this)},l.Texture.fromImage=function(t,e,i){var r=l.TextureCache[t];return r||(r=new l.Texture(l.BaseTexture.fromImage(t,e,i)),l.TextureCache[t]=r),r},l.Texture.fromFrame=function(t){var e=l.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache "+this);return e},l.Texture.fromCanvas=function(t,e){var i=new l.BaseTexture(t,e);return new l.Texture(i)},l.Texture.addTextureToCache=function(t,e){l.TextureCache[e]=t},l.Texture.removeTextureFromCache=function(t){var e=l.TextureCache[t];return l.TextureCache[t]=null,e},l.Texture.frameUpdates=[],l.Texture.SCALE_MODE=l.BaseTexture.SCALE_MODE,l.RenderTexture=function(t,e){l.EventTarget.call(this),this.width=t||100,this.height=e||100,this.indetityMatrix=l.mat3.create(),this.frame=new l.Rectangle(0,0,this.width,this.height),l.gl?this.initWebGL():this.initCanvas()},l.RenderTexture.prototype=Object.create(l.Texture.prototype),l.RenderTexture.prototype.constructor=l.RenderTexture,l.RenderTexture.prototype.initWebGL=function(){var t=l.gl;this.glFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new l.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.baseTexture._glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new l.Point(this.width/2,this.height/2),this.render=this.renderWebGL},l.RenderTexture.prototype.resize=function(t,e){if(this.width=t,this.height=e,l.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var i=l.gl;i.bindTexture(i.TEXTURE_2D,this.baseTexture._glTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},l.RenderTexture.prototype.initCanvas=function(){this.renderer=new l.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new l.BaseTexture(this.renderer.view),this.frame=new l.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},l.RenderTexture.prototype.renderWebGL=function(t,e,i){var r=l.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),i&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var s=t.children,n=t.worldTransform;t.worldTransform=l.mat3.create(),t.worldTransform[4]=-1,t.worldTransform[5]=2*this.projection.y,e&&(t.worldTransform[2]=e.x,t.worldTransform[5]-=e.y),l.visibleCount++,t.vcount=l.visibleCount;for(var o=0,a=s.length;a>o;o++)s[o].updateTransform();var h=t.__renderGroup;h?t==h.root?h.render(this.projection):h.renderSpecific(t,this.projection):(this.renderGroup||(this.renderGroup=new l.WebGLRenderGroup(r)),this.renderGroup.setRenderable(t),this.renderGroup.render(this.projection)),t.worldTransform=n},l.RenderTexture.prototype.renderCanvas=function(t,e,i){var r=t.children;t.worldTransform=l.mat3.create(),e&&(t.worldTransform[2]=e.x,t.worldTransform[5]=e.y);for(var s=0,n=r.length;n>s;s++)r[s].updateTransform();i&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(t),this.renderer.context.setTransform(1,0,0,1,0,0)},l.AssetLoader=function(t,e){l.EventTarget.call(this),this.assetURLs=t,this.crossorigin=e,this.loadersByType={jpg:l.ImageLoader,jpeg:l.ImageLoader,png:l.ImageLoader,gif:l.ImageLoader,json:l.JsonLoader,anim:l.SpineLoader,xml:l.BitmapFontLoader,fnt:l.BitmapFontLoader}},l.AssetLoader.prototype.constructor=l.AssetLoader,l.AssetLoader.prototype.load=function(){var t=this;this.loadCount=this.assetURLs.length;for(var e=0;e<this.assetURLs.length;e++){var i=this.assetURLs[e],r=i.split(".").pop().toLowerCase(),s=this.loadersByType[r];if(!s)throw new Error(r+" is an unsupported file type");var n=new s(i,this.crossorigin);n.addEventListener("loaded",function(){t.onAssetLoaded()}),n.load()}},l.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},l.JsonLoader=function(t,e){l.EventTarget.call(this),this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},l.JsonLoader.prototype.constructor=l.JsonLoader,l.JsonLoader.prototype.load=function(){this.ajaxRequest=new d;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},l.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||-1==e.location.href.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var t=this,i=this.baseUrl+this.json.meta.image,r=new l.ImageLoader(i,this.crossorigin),s=this.json.frames;this.texture=r.texture.baseTexture,r.addEventListener("loaded",function(){t.onLoaded()});for(var n in s){var o=s[n].frame;o&&(l.TextureCache[n]=new l.Texture(this.texture,{x:o.x,y:o.y,width:o.w,height:o.h}),s[n].trimmed&&(l.TextureCache[n].realSize=s[n].spriteSourceSize,l.TextureCache[n].trim.x=0))}r.load()}else if(this.json.bones){var a=new f.SkeletonJson,h=a.readSkeletonData(this.json);l.AnimCache[this.url]=h,this.onLoaded()}else this.onLoaded();else this.onError()},l.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},l.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},l.SpriteSheetLoader=function(t,e){l.EventTarget.call(this),this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},l.SpriteSheetLoader.prototype.constructor=l.SpriteSheetLoader,l.SpriteSheetLoader.prototype.load=function(){var t=this,e=new l.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},l.SpriteSheetLoader.prototype.onJSONLoaded=function(){var t=this,e=this.baseUrl+this.json.meta.image,i=new l.ImageLoader(e,this.crossorigin),r=this.json.frames;this.texture=i.texture.baseTexture,i.addEventListener("loaded",function(){t.onLoaded()});for(var s in r){var n=r[s].frame;n&&(l.TextureCache[s]=new l.Texture(this.texture,{x:n.x,y:n.y,width:n.w,height:n.h}),r[s].trimmed&&(l.TextureCache[s].realSize=r[s].spriteSourceSize,l.TextureCache[s].trim.x=0))}i.load()},l.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},l.ImageLoader=function(t,e){l.EventTarget.call(this),this.texture=l.Texture.fromImage(t,e),this.frames=[]},l.ImageLoader.prototype.constructor=l.ImageLoader,l.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var t=this;this.texture.baseTexture.addEventListener("loaded",function(){t.onLoaded()})}},l.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},l.ImageLoader.prototype.loadFramedSpriteSheet=function(t,e,i){this.frames=[];for(var r=Math.floor(this.texture.width/t),s=Math.floor(this.texture.height/e),n=0,o=0;s>o;o++)for(var a=0;r>a;a++,n++){var h=new l.Texture(this.texture,{x:a*t,y:o*e,width:t,height:e});this.frames.push(h),i&&(l.TextureCache[i+"-"+n]=h)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var u=this;this.texture.baseTexture.addEventListener("loaded",function(){u.onLoaded()})}},l.BitmapFontLoader=function(t,e){l.EventTarget.call(this),this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},l.BitmapFontLoader.prototype.constructor=l.BitmapFontLoader,l.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},l.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==e.location.href.indexOf("http"))){var t=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,i=new l.ImageLoader(t,this.crossorigin);this.texture=i.texture.baseTexture;var r={},s=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],n=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];r.font=s.attributes.getNamedItem("face").nodeValue,r.size=parseInt(s.attributes.getNamedItem("size").nodeValue,10),r.lineHeight=parseInt(n.attributes.getNamedItem("lineHeight").nodeValue,10),r.chars={};for(var o=this.ajaxRequest.responseXML.getElementsByTagName("char"),a=0;a<o.length;a++){var h=parseInt(o[a].attributes.getNamedItem("id").nodeValue,10),u=new l.Rectangle(parseInt(o[a].attributes.getNamedItem("x").nodeValue,10),parseInt(o[a].attributes.getNamedItem("y").nodeValue,10),parseInt(o[a].attributes.getNamedItem("width").nodeValue,10),parseInt(o[a].attributes.getNamedItem("height").nodeValue,10));r.chars[h]={xOffset:parseInt(o[a].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(o[a].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(o[a].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:l.TextureCache[h]=new l.Texture(this.texture,u)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(a=0;a<c.length;a++){var p=parseInt(c[a].attributes.getNamedItem("first").nodeValue,10),d=parseInt(c[a].attributes.getNamedItem("second").nodeValue,10),f=parseInt(c[a].attributes.getNamedItem("amount").nodeValue,10);r.chars[d].kerning[p]=f}l.BitmapText.fonts[r.font]=r;var m=this;i.addEventListener("loaded",function(){m.onLoaded()}),i.load()}},l.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},l.SpineLoader=function(t,e){l.EventTarget.call(this),this.url=t,this.crossorigin=e,this.loaded=!1},l.SpineLoader.prototype.constructor=l.SpineLoader,l.SpineLoader.prototype.load=function(){var t=this,e=new l.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},l.SpineLoader.prototype.onJSONLoaded=function(){var t=new f.SkeletonJson,e=t.readSkeletonData(this.json);l.AnimCache[this.url]=e,this.onLoaded()},l.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof i?("undefined"!=typeof s&&s.exports&&(i=s.exports=l),i.PIXI=l):h.PIXI=l,s.exports}),s("math/math",["require","exports","module","../utils/support","../vendor/pixi"],function(t,i,r){var s=t("../utils/support"),n=t("../vendor/pixi"),o={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,SEED:Math.random(),Matrix:n.Matrix,mat3:n.mat3,mat4:n.mat4,floor:Math.floor,ceil:Math.ceil,random:Math.random,abs:Math.abs,sqrt:Math.sqrt,min:Math.min,max:Math.max,round:function(t){return~~(t+(t>0?.5:-.5))},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},truncate:function(t){return t>0?Math.floor(t):Math.ceil(t)},snap:function(t,e,i){return 0===e?t:(i=i||0,t-=i,t=e*Math.round(t/e),i+t)},snapFloor:function(t,e,i){return 0===e?t:(i=i||0,t-=i,t=e*Math.floor(t/e),i+t)},snapCeil:function(t,e,i){return 0===e?t:(i=i||0,t-=i,t=e*Math.ceil(t/e),i+t)},radiansToDegrees:function(t){return t*o.RAD_TO_DEG},degreesToRadians:function(t){return t*o.DEG_TO_RAD},angleBetween:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},randomBool:function(t){return void 0===t&&(t=50),0>=t?!1:t>=100?!0:100*Math.random()<t},randomInt:function(t,e){return void 0!==t&&t===e?t:(t=t||0,e=e||100,Math.floor(Math.random()*(e-t+1)+t))},randomReal:function(t,e){return void 0!==t&&t===e?t:(t=t||0,e=e||1,o.random()*(e-t)+t)},randomSign:function(t){return o.randomBool(t)?1:-1},randomString:function(){return Math.floor(Date.now()*Math.random()).toString()},randomUuid:function(){var t=o.randomBytes(o.__uuidBytes);t[6]=64|15&t[6],t[8]=128|63&t[8];var e=0,i=o.__byteToHex;return i[t[e++]]+i[t[e++]]+i[t[e++]]+i[t[e++]]+"-"+i[t[e++]]+i[t[e++]]+"-"+i[t[e++]]+i[t[e++]]+"-"+i[t[e++]]+i[t[e++]]+"-"+i[t[e++]]+i[t[e++]]+i[t[e++]]+i[t[e++]]+i[t[e++]]+i[t[e++]]},__uuidBytes:new Uint8Array(16),__byteToHex:function(){for(var t=[],e={},i=0;256>i;i++)t[i]=(i+256).toString(16).substr(1),e[t[i]]=i;return t}(),randomBytes:function(t){return t=t||new Uint8Array(16),e.crypto.getRandomValues(t),t},randomElement:function(t,e,i){return t&&t.length?1===t.length?t[0]:((!e||0>e)&&(e=e||0),(!i||0>i)&&(i=t.length-1),t[o.randomInt(e,i)]):null}};return o._getRandomValuesTyped=function(t){for(var e,i=t.buffer,r=i.byteLength,s=new Uint8Array(i),n=0;r>n;++n)0===(3&n)&&(e=4294967296*o.random()),s[n]=255&e>>>((3&n)<<3);return t},o._getRandomValuesArray=function(t){for(var e=0;e<t.length;++e)t[e]=4294967296*o.random();return t},s.crypto||(e.crypto=e.crypto||{},e.crypto.getRandomValues=s.typedArrays?o._getRandomValuesTyped:o._getRandomValuesArray),r.exports=o,r.exports
}),s("geom/Rectangle",["require","exports","module","../utils/inherit","./Polygon","../math/Vector","../math/math","../constants"],function(t,e,i){var r=t("../utils/inherit"),s=t("./Polygon"),n=t("../math/Vector"),o=t("../math/math"),a=t("../constants"),h=function(t,e,i,r){this.position=new n,this.x=t||0,this.y=e||0,this._width=i||0,this._height=r||0,this.halfWidth=this._width/2,this.halfHeight=this._height/2,this._shapetype=a.SHAPE.RECTANGLE};return r(h,Object,{clone:function(){return new h(this.x,this.y,this._width,this._height)},copy:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},contains:function(t,e){if(this._width<=0||this._height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this._width){var r=this.y;if(e>=r&&e<=r+this._height)return!0}return!1},overlaps:function(t){return this.right>t.x&&this.x<t.right&&this.bottom>t.y&&this.y<t.bottom},toPolygon:function(t){return t=t||this.position,new s(this.x-t.x,this.y-t.y,[new n(t.x,t.y),new n(this.width,t.y),new n(this.width,this.height),new n(t.x,this.height)])},equals:function(t){return this.position.equals(t.position)&&this._width===t._width&&this._height===t._height},union:function(t,e){return e=e||new h,e.x=o.min(this.x,t.x),e.y=o.min(this.y,t.y),e.width=o.max(this.right,t.right),e.height=o.max(this.bottom,t.bottom),e}}),Object.defineProperty(h.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(h.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),Object.defineProperty(h.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t||0,this.halfWidth=this._width/2}}),Object.defineProperty(h.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t||0,this.halfHeight=this._height/2}}),Object.defineProperty(h.prototype,"right",{get:function(){return this.x+this._width}}),Object.defineProperty(h.prototype,"left",{get:function(){return this.x}}),Object.defineProperty(h.prototype,"top",{get:function(){return this.y}}),Object.defineProperty(h.prototype,"bottom",{get:function(){return this.y+this._height}}),Object.defineProperty(h.prototype,"perimeter",{get:function(){return 2*(this._width+this._height)}}),Object.defineProperty(h.prototype,"area",{get:function(){return this._width*this._height}}),i.exports=h,i.exports}),s("utils/utils",["require","exports","module","../math/Vector","../geom/Circle","../geom/Rectangle","../geom/Polygon"],function(t,i,r){var s=t("../math/Vector"),n=t("../geom/Circle"),o=t("../geom/Rectangle"),a=t("../geom/Polygon"),h={_arrayDelim:/[|,]/,noop:function(){},getAbsoluteUrl:function(t){var e=document.createElement("a");return e.href=t,e.href},ajax:function(t){if(t=t||{},t.method=t.method||"GET",t.dataType=t.dataType||"text",!t.url)throw new TypeError("Undefined URL passed to ajax");t.progress=t.progress||h.noop,t.load=t.load||h.noop,t.error=t.error||h.noop,t.abort=t.abort||h.noop,t.complete=t.complete||h.noop;var e=h.createAjaxRequest(),i=h.getAbsoluteUrl(t.url).split("/")[0];return e.onreadystatechange=function(){if(4===e.readyState){var r=e.response||e.responseText,s=null;if("file:"!==i&&200!==e.status&&(s="Non-200 status code returned: "+e.status),!s&&"string"==typeof r)if("json"===t.dataType)try{r=JSON.parse(r)}catch(n){s=n}else if("xml"===t.dataType)try{r=h.parseXML(r)}catch(n){s=n}s?t.error&&t.error.call(e,s):t.load&&t.load.call(e,r)}},e.responseType="json"!==t.dataType&&"xml"!==t.dataType?t.dataType:"text",e.open(t.method,t.url,!0),e.send(),e},createAjaxRequest:function(){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!e.ActiveXObject)return e.XMLHttpRequest?new XMLHttpRequest:!1;for(var i=0;i<t.length;i++)try{return new e.ActiveXObject(t[i])}catch(r){}},setValues:function(t,e){if(e){for(var i in e){var r=e[i];if(void 0!==r&&i in t){var n=t[i];if("number"==typeof n&&"string"==typeof r){var o;o=0===r.indexOf("0x")?parseInt(r,16):parseInt(r,10),isNaN(o)||(t[i]=o)}else if(n instanceof s&&r instanceof Array)n.set(parseFloat(r[0],10)||0,parseFloat(r[1],10)||parseFloat(r[0],10)||0);else if(n instanceof s&&"string"==typeof r){var a=r.split(h._arrayDelim,2);n.set(parseFloat(a[0],10)||0,parseFloat(a[1],10)||parseFloat(a[0],10)||0)}else if(n instanceof s&&"number"==typeof r)n.set(r,r);else if(n instanceof Array&&"string"==typeof r){t[i]=r.split(h._arrayDelim);for(var l=0,u=t[i].length;u>l;++l){var c=t[i][l];isNaN(c)||(t[i][l]=parseFloat(c,10))}}else t[i]=r}}return t}},extend:function(){var t,e,i,r,s,n,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[1]||{},a=2),"object"!=typeof o&&"function"!=typeof o&&(o={});l>a;a++)if(s=arguments[a],null!==s&&void 0!==s)for(r in s)t=o[r],i=s[r],o!==i&&(u&&i&&(h.isPlainObject(i)||(e=Array.isArray(i)))?(e?(e=!1,n=t&&Array.isArray(t)?t:[]):n=t&&h.isPlainObject(t)?t:{},o[r]=h.extend(u,n,i)):void 0!==i&&(o[r]=i));return o},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!Object.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},getOffset:function(t){var i=t.getBoundingClientRect(),r=t.clientTop||document.body.clientTop||0,n=t.clientLeft||document.body.clientLeft||0,o=e.pageYOffset||t.scrollTop||document.body.scrollTop,a=e.pageXOffset||t.scrollLeft||document.body.scrollLeft;return new s(i.left+a-n,i.top+o-r)},parseHitArea:function(t){var e;if(0!==t.length%2&&3!==t.length)throw new RangeError("Strange number of values for hitArea! Should be a flat array of values, like: [x,y,r] for a circle, [x,y,w,h] for a rectangle, or [x,y,x,y,...] for other polygons.");return e=3===t.length?new n(t[0],t[1],t[2]):4===t.length?new o(t[0],t[1],t[2],t[3]):new a(0,0,t)},parseTiledProperties:function(t){if(!t||t.__tiledparsed)return t;for(var e in t){var i=t[e],r=parseFloat(i,10);if(0===r||r)t[e]=r;else if("true"===i)t[e]=!0;else if("false"===i)t[e]=!1;else try{i=JSON.parse(i),t[e]=i}catch(s){}}return t.hitArea&&(t.hitArea=h.parseHitArea(t.hitArea)),("static"===t.body||t.sensor)&&(t.mass=1/0,t.inertia=1/0),t.__tiledparsed=!0,t},_logger:e.console||{},log:function(){h._logger.log&&h._logger.log.apply(h._logger,arguments)},warn:function(){h._logger.warn&&h._logger.warn.apply(h._logger,arguments)},error:function(){h._logger.error&&h._logger.error.apply(h._logger,arguments)}};return"undefined"!=typeof e.DOMParser?h.parseXML=function(t){return(new e.DOMParser).parseFromString(t,"text/xml")}:"undefined"!=typeof e.ActiveXObject&&new e.ActiveXObject("Microsoft.XMLDOM")?h.parseXML=function(t){var i=new e.ActiveXObject("Microsoft.XMLDOM");return i.async="false",i.loadXML(t),i}:(h.warn("XML parser not available, trying to parse any XML will result in an error."),h.parseXML=function(){throw new Error("Trying to parse XML, but not XML parser is available in this environment")}),r.exports=h,r.exports}),s("audio/AudioPlayer",["require","exports","module","./AudioPlayer","../utils/EventEmitter","../utils/utils","../utils/inherit","../utils/support"],function(t,e,i){var r=t("./AudioPlayer"),s=t("../utils/EventEmitter"),n=t("../utils/utils"),o=t("../utils/inherit"),a=t("../utils/support"),r=function(t,e,i){s.call(this),this.src="",this.game=t.game,this.key=e.key,this.autoplay=!1,this.format=null,this.loop=!1,this.pos3d=[0,0,-.5],this.sprite={},Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),this._file=e,this._volume=1,this._duration=0,this._loaded=!1,this._manager=t,this._webAudio=a.webAudio,this._nodes=[],this._onendTimer=[],n.setValues(this,i),this._webAudio&&this._setupAudioNode(),this._load()};return o(r,Object,{_load:function(){var t=this,e=this._file;if(e.webAudio)e.decoded?this._loadSoundBuffer(e.data):this._manager.ctx.decodeAudioData(e.data,function(i){i&&(e.data=i,e.decoded=!0,t._loadSoundBuffer(i))});else{var i=e.data.cloneNode();this._nodes.push(i),i._pos=0,i.volume=this._manager.muted?0:this._volume*this._manager.volume,this._duration=i.duration,this.sprite._default=[0,1e3*i.duration],this._loaded||(this._loaded=!0,this.emit("ready",this.src)),this.autoplay&&this.play()}return this},play:function(t,e){var i=this;return"function"==typeof t&&(e=t,t=null),t||(t="_default"),this._loaded?this.sprite[t]?(this._inactiveNode(function(r){var s,n=r._pos>0?r._pos:i.sprite[t][0]/1e3,o=i.sprite[t][1]/1e3-r._pos,a=i.loop||i.sprite[t][2],h="string"==typeof e?e:Math.round(Date.now()*Math.random())+"";if(r._sprite=t,function(t){s=setTimeout(function(){!i._webAudio&&t.loop&&i.stop(t.id,t.timer).play(t.sprite,t.id),i._webAudio&&!t.loop&&(i._nodeById(t.id).paused=!0),i._webAudio||t.loop||i.stop(t.id,t.timer),i.emit("end",t.id)},1e3*o),i._onendTimer.push(s),t.timer=s}({id:h,sprite:t,loop:a}),i._webAudio)r.id=h,r.paused=!1,i._refreshBuffer([a,n,o],h),i._playStart=i._manager.ctx.currentTime,r.gain.value=i._volume,"undefined"==typeof r.bufferSource.start?r.bufferSource.noteGrainOn(0,n,o):r.bufferSource.start(0,n,o);else{if(4!==r.readyState)return i._clearEndTimer(s),function(){var s=i,n=t,o=e,a=r,h=function(){s.play(n,o),a.removeEventListener("canplaythrough",h,!1)};a.addEventListener("canplaythrough",h,!1)}(),i;r.id=h,r.currentTime=n,r.muted=i._manager.muted,r.volume=i._volume*i._manager.volume,r.play()}i.emit("play",h),"function"==typeof e&&e(h)}),this):("function"==typeof e&&e(),this):(this.on("ready",function(){i.play(t,e)}),this)},pause:function(t,e){var i=this;if(!this._loaded)return this.on("play",function(){i.play(t,e)}),this;this._clearEndTimer(e||0);var r=t?this._nodeById(t):this._activeNode();if(r)if(this._webAudio){if(!r.bufferSource)return this;r.paused=!0,r._pos+=this._manager.ctx.currentTime-this._playStart,"undefined"==typeof r.bufferSource.stop?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r._pos=r.currentTime,r.pause();return this.emit("pause",r?r.id:t),this},stop:function(t,e){var i=this;if(!this._loaded)return this.on("play",function(){i.stop(t,e)}),this;this._clearEndTimer(e||0);var r=t?this._nodeById(t):this._activeNode();if(r)if(r._pos=0,this._webAudio){if(!r.bufferSource)return this;r.paused=!0,"undefined"==typeof r.bufferSource.stop?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r.pause(),r.currentTime=0;return this},mute:function(t){return this.setMuted(!0,t)},unmute:function(t){return this.setMuted(!1,t)},setMuted:function(t,e){var i=this;if(!this._loaded)return this.on("play",function(){i.setMuted(t,e)}),this;var r=e?this._nodeById(e):this._activeNode();return r&&(this._webAudio?r.gain.value=t?0:this._volume:r.volume=t?0:this._volume),this},seek:function(t,e){var i=this;if(!this._loaded)return this.on("ready",function(){i.seek(t,e)}),this;(!t||0>t)&&(t=0);var r=e?this._nodeById(e):this._activeNode();return r&&(this._webAudio?(r._pos=t,this.pause(r.id).play(r._sprite,e)):r.currentTime=t),this},getPosition:function(t){var e=this;if(!this._loaded)return this.on("ready",function(){e.getPosition(t)}),this;var i=t?this._nodeById(t):this._activeNode();return i?this._webAudio?i._pos+(this._manager.ctx.currentTime-this._playStart):i.currentTime:0},fade:function(t,e,i,r,s){var n=this,o=Math.abs(t-e),a=t>e?"dowm":"up",h=o/.01,l=i/h;if("function"==typeof r&&(s=r,r=null),!this._loaded)return this.on("ready",function(){n.fade(t,e,i,r,s)}),this;this.setVolume(t,r);for(var u=1;h>=u;++u){var c=this._volume+("up"===a?.01:-.01)*u,p=Math.round(1e3*c)/1e3,d=l*u;this._doFadeStep(p,d,e,r,s)}},getVolume:function(){return this._volume},setVolume:function(t,e){var i=this;if(t=parseFloat(t),!this._loaded)return this.on("play",function(){i.setVolume(t,e)}),this;if(t>=0&&1>=t){this._volume=t;var r=e?this._nodeById(e):this._activeNode();r&&(this._webAudio?r.gain.volume=t:r.volume=t*this._manager.volume)}return this},setPosition:function(t,e,i,r){var s=this;if(t=t?t:0,e=e?e:0,i=i||0===i?i:-.5,!this._loaded)return this.on("play",function(){s.setPosition(t,e,i,r)}),this;if(this._webAudio){var n=r?this._nodeById(r):this._activeNode();n&&(this.pos3d[0]=t,this.pos3d[1]=e,this.pos3d[2]=i,n.panner.setPosition(t,e,i))}return this},_doFadeStep:function(t,e,i,r,s){var n=this;setTimeout(function(){n.setVolume(t,r),t===i&&"function"==typeof s&&s()},e)},_nodeById:function(t){for(var e=this._nodes[0],i=0,r=this._nodes.length;r>i;++i)if(this._nodes[i].id===t){e=this._nodes[i];break}return e},_activeNode:function(){for(var t,e=0,i=this._nodes.length;i>e;++e)if(!this._nodes[e].paused){t=this._nodes[e];break}return this._drainPool(),t},_inactiveNode:function(t){for(var e,i=0,r=this._nodes.length;r>i;++i)if(this._nodes[i].paused&&4===this._nodes[i].readyState){t(e=this._nodes[i]);break}this._drainPool(),e||(this._webAudio?(e=this._setupAudioNode(),t(e)):(this._load(),e=this._nodes[this.nodes.length-1],e.addEventListener("loadedmetadata",function(){t(e)})))},_drainPool:function(){var t=0,e=0,i=0;for(e=0,i=this._nodes.length;i>e;++e)this._nodes[e].paused&&t++;for(e=this._nodes.length-1;e>=0&&!(5>=t);--e)this._nodes[e].paused&&(t--,this._nodes.splice(e,1))},_clearEndTimer:function(t){var e=this._onendTimer.indexOf(t);e=e>=0?e:0,this._onendTimer[e]&&(clearTimeout(this._onendTimer[e]),this._onendTimer.splice(e,1))},_setupAudioNode:function(){var t=this._manager.ctx.createGain?this._manager.ctx.createGain():this._manager.ctx.createGainNode();return this._nodes.push(t),t.gain.value=this._volume,t.paused=!0,t._pos=0,t.readyState=4,t.connect(this._manager.masterGain),t.panner=this._manager.ctx.createPanner(),t.panner.setPosition(this.pos3d[0],this.pos3d[1],this.pos3d[2]),t.panner.connect(t),t},_loadSoundBuffer:function(t){this._duration=t?t.duration:this._duration,this.sprite._default=[0,1e3*this._duration],this._loaded||(this._loaded=!0,this.emit("ready",this.src)),this.autoplay&&this.play()},_refreshBuffer:function(t,e){var i=this._nodeById(e);i.bufferSource=this._manager.ctx.createBufferSource(),i.bufferSource.buffer=this._file.data,i.bufferSource.connect(i.panner),i.bufferSource.loop=t[0],t[0]&&(i.bufferSource.loopStart=t[1],i.bufferSource.loopEnd=t[1]+t[2])}}),i.exports=r,i.exports}),s("audio/AudioManager",["require","exports","module","./AudioPlayer","../utils/inherit","../utils/support"],function(t,i,r){var s=t("./AudioPlayer"),n=t("../utils/inherit"),o=t("../utils/support"),a=e.AudioContext||e.webkitAudioContext||e.mozAudioContext,h=o.webAudio?new a:null,l=function(t,e){this.game=t,this.parent=e,this._muted=!1,this._volume=1,Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),this.ctx=h,this.canPlay=o.webAudio||o.htmlAudio,o.webAudio&&(this.masterGain=this.ctx.createGain?this.ctx.createGain():this.ctx.createGainNode(),this.masterGain.gain.value=1,this.setParent(e)),this.sounds={}};return n(l,Object,{getVolume:function(){return this._volume},setVolume:function(t){if(t=parseFloat(t,10),!isNaN(t)&&t>=0&&1>=t){this._volume=t,o.webAudio&&(this.masterGain.gain.value=t);for(var e in this.sounds)if(this.sounds.hasOwnProperty(e)&&this.sounds[e]._webAudio===!1)for(var i=this.sounds[e],r=0,s=i._nodes.length;s>r;++r)i._nodes[r].volume=i._volume*this._volume}},mute:function(){return this.setMuted(!0)},unmute:function(){return this.setMuted(!1)},setMuted:function(t){this._muted=t=!!t,o.webAudio&&(this.masterGain.gain.value=t?0:this._volume);for(var e in this.sounds)if(this.sounds.hasOwnProperty(e)&&this.sounds[e]._webAudio===!1)for(var i=this.sounds[e],r=0,s=i._nodes.length;s>r;++r)i._nodes[r].mute();return this},setParent:function(t){return this.parent=t,o.webAudio&&(t&&t.masterGain?this.masterGain.connect(t.masterGain):this.masterGain.connect(this.ctx.destination)),this},attach:function(t){if(t._manager!==this&&(t._manager&&t._manager.detach(t),this.sounds[t.key]=t,t._manager=this,o.webAudio))for(var e=0;e<t._nodes.length;++e)t._nodes[e].connect(this.masterGain);return t},detach:function(t){if(t._manager!==this&&(delete this.sounds[t.key],t._manager=null,o.webAudio))for(var e=0;e<t._nodes.length;++e)t._nodes[e].disconnect();return t},add:function(t,e){if(!this.canPlay)return!1;var i=this.game.cache.getAudio(t);return i.player||(i.player=new s(this,i,e)),this.sounds[t]=i.player},remove:function(t){var e=this.sounds[t];return e&&e.stop(),delete this.sounds[t],e?e:!1}}),r.exports=l,r.exports}),s("physics/PhysicsTarget",["require","exports","module","../math/Vector"],function(t,e,i){var r=t("../math/Vector");return i.exports=function(){this._phys={},this.mass=0,this.inertia=0,this._velocity=new r,this.enablePhysics=function(t,e){var i=this;return"function"==typeof t&&(e=t,t=null),t?(this._phys.active?this._phys.system.remove(this,function(){t.add(i,e)}):t.add(this,e),this._phys.system=t):this._phys.system.add(this,e),this},this.disablePhysics=function(t){return this._phys.system&&this._phys.system.remove(this,t),this},this.reindex=function(t){return this._phys.system&&this._phys.system.reindex(this,t),this},this.setMass=function(t){return this._phys.system&&this._phys.system.setMass(this,t),this},this.setVelocity=function(t,e){return e=void 0!==t.y?t.y:e||0,t=void 0!==t.x?t.x:t||0,this._velocity.set(t,e),this._phys.system&&this._phys.system.setVelocity(this,this._velocity),this},this.setRotation=function(t){return this.rotation=t,this._phys.system&&this._phys.system.setRotation(this,t),this},this.setPosition=function(t,e){return e=void 0!==t.y?t.y:e||0,t=void 0!==t.x?t.x:t||0,this.position.set(t,e),this._phys.system&&this._phys.system.setPosition(this,this.position),this},this.onCollision=function(t,e,i,r){this.emit("collision",t,e,i,r)},this.onSeparate=function(t,e,i){this.emit("separate",t,e,i)}},i.exports}),s("display/Container",["require","exports","module","../utils/EventEmitter","../physics/PhysicsTarget","../utils/utils","../utils/inherit","../vendor/pixi"],function(t,e,i){var r=t("../utils/EventEmitter"),s=t("../physics/PhysicsTarget"),n=t("../utils/utils"),o=t("../utils/inherit"),a=t("../vendor/pixi"),h=function(t){a.DisplayObjectContainer.call(this),r.call(this),s.call(this),n.setValues(this,t)};return o(h,a.DisplayObjectContainer,{show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},addChild:function(t){return a.DisplayObjectContainer.prototype.addChild.apply(this,arguments),t},addChildAt:function(t){return a.DisplayObjectContainer.prototype.addChildAt.apply(this,arguments),t},removeChild:function(t){return a.DisplayObjectContainer.prototype.removeChild.apply(this,arguments),t},removeAllChildren:function(){for(;this.children.length;)this.removeChild(this.children[0]);return this},bringChildToTop:function(t){return t.parent===this&&this.addChild(this.removeChild(t)),t},destroy:function(){this.disablePhysics(),this.destroyAllChildren(),this.parent&&this.parent.removeChild(this)},destroyAllChildren:function(){for(;this.children.length;)this.children[0].destroy?this.children[0].destroy():this.removeChild(this.children[0]);return this},onCollide:function(){}}),i.exports=h,i.exports}),s("display/Texture",["require","exports","module","../vendor/pixi","../utils/utils","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").Texture,s=t("../utils/utils"),n=t("../vendor/pixi");return r.fromJSON=function(t,e,i){if(!e.frames)return s.warn('Invalid Texture Atlas JSON for fromJSON, missing "frames" array, full json:',e),void 0;var n,o=e.frames,a={};if(o.length)for(var h=0,l=o.length;l>h;++h)n=t+"_"+o[h].filename,a[o[h].filename]=r._createFrame(n,o[h],i);else for(var u in o)n=t+"_"+u,a[u]=r._createFrame(n,o[u],i);return a},r._createFrame=function(t,e,i){var s=e.frame;if(s){var o=n.TextureCache[t]=new r(i,{x:s.x,y:s.y,width:s.w,height:s.h});return o.trimmed=e.trimmed,o.rotated=e.rotated,o.sourceSize=e.sourceSize,o.realSize=e.spriteSourceSize,o}},r.fromXML=function(t,e,i){if(!e.getElementsByTagName("TextureAtlas"))return s.warn("Invalid Texture Atlas XML given, missing <TextureAtlas> tag, full xml:",e),void 0;for(var o=e.getElementsByTagName("SubTexture")||e.getElementsByTagName("sprite"),a={},h=0;h<o.length;h++){var l=o[h],u=l.attributes,c=u.getNamedItem("name")||u.getNamedItem("n"),p=u.getNamedItem("x"),d=u.getNamedItem("y"),f=u.getNamedItem("width")||u.getNamedItem("w"),m=u.getNamedItem("height")||u.getNamedItem("h"),v=u.getNamedItem("frameX")||u.getNamedItem("oX"),y=u.getNamedItem("frameY")||u.getNamedItem("oY"),g=u.getNamedItem("frameWidth")||u.getNamedItem("oW"),b=u.getNamedItem("frameHeight")||u.getNamedItem("oH"),x=!!u.getNamedItem("r"),_=a[c]=n.TextureCache[t+"_"+c]=new r(i,{x:parseInt(p.nodeValue,10),y:parseInt(d.nodeValue,10),width:parseInt(f.nodeValue,10),height:parseInt(m.nodeValue,10)});_.trimmed=v&&y,_.rotated=x,_.trimmed&&(_.sourceSize={w:parseInt(g.nodeValue,10),h:parseInt(b.nodeValue,10)},_.realSize={x:Math.abs(parseInt(v.nodeValue,10)),y:Math.abs(parseInt(y.nodeValue,10)),w:parseInt(g.nodeValue,10),h:parseInt(b.nodeValue,10)})}return a},r.fromSpritesheet=function(t){return t},i.exports=r,i.exports}),s("display/Sprite",["require","exports","module","../utils/EventEmitter","../geom/Rectangle","../physics/PhysicsTarget","../utils/inherit","./Texture","../math/math","../utils/utils","../vendor/pixi"],function(t,e,i){var r=t("../utils/EventEmitter"),s=t("../geom/Rectangle"),n=t("../physics/PhysicsTarget"),o=t("../utils/inherit"),a=t("./Texture"),h=t("../math/math"),l=t("../utils/utils"),u=t("../vendor/pixi"),c=function(t,e,i){if(r.call(this),n.call(this),t||(t=a.__default),t instanceof a)t={_default:{frames:[t]}},i="_default";else if(t instanceof Array)t={_default:{frames:t}},i="_default";else for(var o in t){void 0===i&&(i=o);var h=t[o];h instanceof Array?t[o]={name:o,frames:h}:h instanceof a?t[o]={name:o,frames:[h]}:t[o].name=o}u.Sprite.call(this,t[i].frames[0]),this.name="",this.lifespan=1/0,this.speed=e||1,this.loop=!1,this.animations=t,this.currentAnimation=i,this.currentFrame=0,this.playing=!1,this.hitArea=this.hitArea||new s(0,0,this.width,this.height),this.goto(0,this.currentAnimation)};return o(c,u.Sprite,{show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},clone:function(){var t=l.extend(!0,{},this.animations),e=new c(t,this.speed,this.currentAnimation);return e.name=this.name,e.loop=this.loop,e.currentFrame=this.currentFrame,e.playing=this.playing,e.hitArea=this.hitArea.clone(),e.body=this.body.clone(),e.blendMode=this.blendMode,e.anchor.x=this.anchor.x,e.anchor.y=this.anchor.y,e.position.x=this.position.x,e.position.y=this.position.y,e.scale.x=this.scale.x,e.scale.y=this.scale.y,e.pivot.x=this.pivot.x,e.pivot.y=this.pivot.y,e.rotation=this.rotation,e.alpha=this.alpha,e.visible=this.visible,e.buttonMode=this.buttonMode,e.renderable=this.renderable,e},addAnimation:function(t,e,i,r){return"object"==typeof t?this.animations[t.name]=t:this.animations[t]={name:t,frames:e,speed:i,loop:r},this},"goto":function(t,e){return"string"==typeof t&&(e=t,t=0),this.currentFrame=t||0,this.lastRound=h.round(t||0),e&&(this.currentAnimation=e),this.setTexture(this.animations[this.currentAnimation].frames[this.currentFrame]),this.emit("frame",this.currentAnimation,this.lastRound),this},play:function(){return this.playing=!0,this},stop:function(){return this.playing=!1,this},destroy:function(){this.stop(),this.disablePhysics(),this.parent&&this.parent.removeChild(this),this.name=null,this.lifetime=null,this.speed=null,this.loop=null,this.animations=null,this.currentAnimation=null,this.currentFrame=null,this.playing=null,this.hitArea=null},updateTransform:function(){if(u.Sprite.prototype.updateTransform.call(this),this.playing){var t,e=this.animations[this.currentAnimation],i=void 0!==e.loop?e.loop:this.loop;this.currentFrame+=e.speed||this.speed,t=h.round(this.currentFrame),t<e.frames.length?t!==this.lastRound&&(this.lastRound=t,this.setTexture(e.frames[t]),this.emit("frame",this.currentAnimation,t)):i?this.goto(0):(this.stop(),this.emit("complete",this.currentAnimation))}}}),i.exports=c,i.exports}),s("utils/ObjectPool",["require","exports","module","./inherit"],function(t,e,i){var r=t("./inherit"),s=function(t,e){this.type=t,this.pool=[],this.parent=e};return r(s,Object,{create:function(){var t=this.pool.pop();return t||(t=this._construct(this.type,arguments),this.parent&&this.parent.addChild(t)),t.__allocated=!0,t},free:function(t){t.__allocated&&(t.__allocated=!1,this.pool.push(t))},_construct:function(t,e){function i(){return t.apply(this,e)}return i.prototype=t.prototype,new i}}),i.exports=s,i.exports}),s("gui/GuiItem",["require","exports","module","../utils/inherit","../display/Sprite"],function(t,e,i){var r=t("../utils/inherit"),s=t("../display/Sprite"),n=function(t,e){this.draggable=!1,this.dragging=!1,s.call(this,t),this.interactive=e};return r(n,s,{mousedown:function(t){s.prototype.mousedown.call(this,t),this.draggable&&(this.dragging=t.data.getLocalPosition(t.object.parent))},mouseup:function(t){s.prototype.mouseup.call(this,t),this.dragging=!1},mousemove:function(t){if(s.prototype.mousemove.call(this,t),this.draggable&&this.dragging){var e=t.data.getLocalPosition(this.parent);this.position.x+=e.x-this.dragging.x,this.position.y+=e.y-this.dragging.y,this.dragging=e}}}),i.exports=n,i.exports}),s("geom/Ellipse",["require","exports","module","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").Ellipse;return i.exports=r,i.exports}),s("tilemap/ObjectGroup",["require","exports","module","../display/Container","../math/Vector","../geom/Polygon","../geom/Ellipse","../geom/Rectangle","../utils/utils","../utils/inherit","../math/math"],function(t,e,i){var r=t("../display/Container"),s=t("../math/Vector"),n=t("../geom/Polygon"),o=t("../geom/Ellipse"),a=t("../geom/Rectangle"),h=t("../utils/utils"),l=t("../utils/inherit"),u=t("../math/math"),c=function(t,e){r.call(this,e),this.map=t,this.game=t.game,this.state=t.state,this.name=e.name||"",this.color=e.color,this.properties=e.properties||{},this.objects=e.objects,this.type=e.type||"objectgroup",this.position.x=e.x||0,this.position.y=e.y||0,this.alpha=void 0!==e.opacity?e.opacity:1,this.visible=void 0!==e.visible?e.visible:!0};return l(c,r,{spawn:function(){for(var t=this.game,e=this.objects.length-1;e>=0;--e){var i,s,n,o=this.objects[e],a=h.parseTiledProperties(o.properties)||{};if(a.tileprops={},o.gid?(i=this.parent.getTileset(o.gid),i&&(a.texture=i.getTileTexture(o.gid),a.tileprops=i.getTileProperties(o.gid),a.hitArea||(a.hitArea=a.tileprops.hitArea?a.tileprops.hitArea:i.properties.hitArea))):a.hitArea||(a.hitArea=o.polyline?this._getPolyline(o):o.polygon?this._getPolygon(o):o.ellipse?this._getEllipse(o):this._getRectangle(o)),o.name=o.name||a.name||a.tileprops.name,o.type=o.type||a.type||a.tileprops.type,"string"==typeof a.texture&&(a.texture=t.cache.getTexture(a.texture)),a.texture){a.width=o.width,a.height=o.height,a.zIndex=this.zIndex,n=t.spritepool.create(o.name,a.texture,a),n.name=o.name,n.type=o.type,n.position.x=o.x,n.position.y=o.y,n.mass=a.mass||a.tileprops.mass,n.inertia=a.inertia||a.tileprops.inertia,n.friction=a.friction||a.tileprops.friction,n.sensor=a.sensor||a.tileprops.sensor,n.hitArea=a.hitArea;var l=a.anchor||a.tileprops.anchor;n.anchor.y=l?l[1]:1,n.anchor.x=l?l[0]:"isometric"===this.parent.orientation?.5:0,n.mass&&n.enablePhysics(t.physics),a.tileprops&&(a.tileprops.flippedX&&(n.scale.x=-1,n.anchor.x=l?l[0]:1),a.tileprops.flippedY&&(n.scale.y=-1,n.anchor.y=l?l[1]:0),a.tileprops.rotatedCW&&(n.rotation=u.degreesToRadians(45))),(a.animation||a.tileprops.animation)&&n.goto&&n.goto(0,a.animation||a.tileprops.animation).play(),"number"==typeof o.rotation&&n.setRotation(o.rotation)}else n=new r,n.width=o.width,n.height=o.height,n.name=o.name,n.type=o.type,n.rotation=o.rotation,n.position.x=o.x,n.position.y=o.y,n.sensor=!0,n.hitArea=a.hitArea,n.enablePhysics(t.physics);if(n.visible=void 0!==o.visible?!!o.visible:!0,"isometric"===this.parent.orientation){var c=o.x/this.parent.tileSize.x,p=o.y/this.parent.tileSize.y;o.x=c*this.parent.tileSize.x-(p-1)*(this.parent.tileSize.x/2),o.y=p*this.parent.tileSize.y/2+c*this.parent.tileSize.y}s=this._getInteractive(i,a),s&&(n.interactive=s,n.click=this.onObjectEvent.bind(this,"click",n),n.mousedown=this.onObjectEvent.bind(this,"mousedown",n),n.mouseup=this.onObjectEvent.bind(this,"mouseup",n),n.mousemove=this.onObjectEvent.bind(this,"mousemove",n),n.mouseout=this.onObjectEvent.bind(this,"mouseout",n),n.mouseover=this.onObjectEvent.bind(this,"mouseover",n),n.mouseupoutside=this.onObjectEvent.bind(this,"mouseupoutside",n)),n.properties={};for(var d in a.tileprops)n.properties[d]=a.tileprops[d];for(var f in a)"tileprops"!==f&&(n.properties[f]=a[f]);n._objIndex=e,this.addChild(n)}return this},onObjectEvent:function(t,e,i){this.parent.onObjectEvent(t,e,i)},_getPolygon:function(t){for(var e=[],i=0,r=t.polygon.length;r>i;++i)e.push(new s(t.polygon[i].x,t.polygon[i].y));return new n(e)},_getPolyline:function(t){for(var e=[],i=0,r=t.polyline.length;r>i;++i)e.push(new s(t.polyline[i].x,t.polyline[i].y));return new n(e)},_getEllipse:function(t){return new o(0,0,t.width,t.height)},_getRectangle:function(t){return new a(0,0,t.width,t.height)},_getInteractive:function(t,e){return e.interactive||e.tileprops.interactive||t&&t.properties.interactive||this.properties.interactive||this.parent.properties.interactive},despawn:function(){return r.prototype.destroyAllChildren.call(this)},destroy:function(){this.despawn(),r.prototype.destroy.call(this),this.map=null,this.game=null,this.state=null,this.name=null,this.color=null,this.properties=null,this.objects=null,this.type=null}}),i.exports=c,i.exports}),s("tilemap/Tile",["require","exports","module","../display/Sprite","../utils/inherit"],function(t,e,i){var r=t("../display/Sprite"),s=t("../utils/inherit"),n=function(t){r.call(this,t)};return s(n,r,{}),i.exports=n,i.exports}),s("tilemap/Tilelayer",["require","exports","module","../display/Container","../geom/Rectangle","../math/Vector","../display/Texture","./Tile","../math/math","../utils/utils","../utils/inherit","../utils/support"],function(t,e,i){var r=t("../display/Container"),s=t("../geom/Rectangle"),n=t("../math/Vector"),o=t("../display/Texture"),a=t("./Tile"),h=t("../math/math"),l=t("../utils/utils"),u=t("../utils/inherit"),c=t("../utils/support"),p=function(t,e){r.call(this,e),this.map=t,this.state=t.state,this.state=t.state,this.tiles=[],this.name=e.name||"",this.size=new n(e.width||0,e.height||0),this.tileIds=c.typedArrays?new Uint32Array(e.data):e.data,this.properties=l.parseTiledProperties(e.properties)||{},this.type=e.type||"tilelayer",this.preRender=e.preRender||this.properties.preRender||!1,this.chunkSize=new n(e.chunkSizeX||e.chunkSize||this.properties.chunkSizeX||this.properties.chunkSize||512,e.chunkSizeY||e.chunkSize||this.properties.chunkSizeY||this.properties.chunkSize||512),this.position.x=e.x||0,this.position.y=e.y||0,this.alpha=void 0!==e.opacity?e.opacity:1,this.visible=void 0!==e.visible?e.visible:!0,this._preRendered=!1,this._tilePool=[],this._buffered={left:!1,right:!1,top:!1,bottom:!1},this._panDelta=new n,this._rendered=new s};return u(p,r,{render:function(t,e,i,r){if(!this.preRender)return this.tileSize||(this.tileSize=this.map.tileSize),this.clearTiles(),this._renderTiles(t,e,i,r),this;if(this._preRendered)for(var s=this.children.length-1;s>-1;--s)this.children[s].visible=!0;else this._preRender()},_preRender:function(){if(this.visible){this._preRendered=!0,this.tileSize=this.chunkSize.clone();for(var t=this.map,e=t.size.x*t.tileSize.x,i=t.size.y*t.tileSize.y,r=h.ceil(e/this.chunkSize.x),s=h.ceil(i/this.chunkSize.y),n=0;r>n;++n)for(var o=0;s>o;++o){var a=n===r-1?e-n*this.chunkSize.x:this.chunkSize.x,l=o===s-1?i-o*this.chunkSize.y:this.chunkSize.y;this._preRenderChunk(n,o,a,l)}}},_preRenderChunk:function(t,e,i,r){var s=this.map,n=s.tileSize.x,l=s.tileSize.y,u=i/n,c=r/l,p=t*this.chunkSize.x%n,d=e*this.chunkSize.y%l,f=h.floor(t*this.chunkSize.x/n),m=h.floor(e*this.chunkSize.y/l),v=s.size.x,y=s.size.y,g=document.createElement("canvas"),b=g.getContext("2d");g.width=i,g.height=r;for(var x=0;u>x;++x)for(var _=0;c>_;++_)if(v>x+f&&y>_+m){var T,w,S=x+f+(_+m)*v,A=this.tileIds[S],E=s.getTileset(A);
E&&(T=E.getTileTexture(A),w=T.frame,b.drawImage(T.baseTexture.source,w.x,w.y,w.width,w.height,x*n-p+E.tileoffset.x,_*l-d+E.tileoffset.y,w.width,w.height))}var C=new a(o.fromCanvas(g));C.setPosition(t*this.chunkSize.x,e*this.chunkSize.y),this.tiles[t]||(this.tiles[t]={}),this.addChild(C),this.tiles[t][e]=C},_renderTiles:function(t,e,i,r){t=h.floor(t/this.map.scaledTileSize.x),e=h.floor(e/this.map.scaledTileSize.y),t=0>t?0:t,e=0>e?0:e,i=h.ceil(i/this.map.scaledTileSize.x)+1,r=h.ceil(r/this.map.scaledTileSize.y)+1,i=t+i>this.map.size.x?this.map.size.x-t:i,r=e+r>this.map.size.y?this.map.size.y-e:r;for(var s=t+i,n=e+r,o=t;s>o;++o)for(var a=e;n>a;++a)this.moveTileSprite(-1,-1,o,a);this._rendered.x=t,this._rendered.y=e,this._rendered.width=i,this._rendered.height=r,this._buffered.left=this._buffered.right=this._buffered.top=this._buffered.bottom=!1,this._panDelta.x=this.state.world.position.x%this.map.scaledTileSize.x,this._panDelta.y=this.state.world.position.y%this.map.scaledTileSize.y},_freeTile:function(t,e){this.tiles[t]&&this.tiles[t][e]&&(this.clearTile(this.tiles[t][e]),this.tiles[t][e]=null)},clearTiles:function(t){var e;{if(!this.preRender||t){for(this._preRendered=!1,e=this.children.length-1;e>-1;--e)this.clearTile(this.children[e],t);return this.tiles.length=0,this}for(e=this.children.length-1;e>-1;--e)this.children[e].visible=!1}},clearTile:function(t,e){return t.visible=!1,t.disablePhysics(),e?this.removeChild(t):this._tilePool.push(t),this},moveTileSprite:function(t,e,i,r){if(0>i||0>r||i>=this.map.size.x||r>=this.map.size.y)return this.tiles[t]&&this.tiles[t][e]&&this.tiles[t][e].disablePhysics(),void 0;var s,n,o,h,l,u,c=i+r*this.size.x,p=this.tileIds[c],d=this.map.getTileset(p);return d?(n=d.getTileTexture(p),o=d.getTileProperties(p),l=o.hitArea||d.properties.hitArea,u=this._getInteractive(d,o),h=[i*this.map.tileSize.x+d.tileoffset.x,r*this.map.tileSize.y+d.tileoffset.y],h[1]+=this.map.tileSize.y,this.tiles[t]&&this.tiles[t][e]?(s=this.tiles[t][e],this.tiles[t][e]=null,s.disablePhysics()):s=this._tilePool.pop(),s||(s=new a(n),s.anchor.y=1,this.addChild(s)),s.collisionType=o.type,s.interactive=u,s.hitArea=l,s.mass=o.mass||0,s.setTexture(n),s.setPosition(h[0],h[1]),s.show(),s.mass&&s.enablePhysics(this.state.physics),u&&(s.click=this.onTileEvent.bind(this,"click",s),s.mousedown=this.onTileEvent.bind(this,"mousedown",s),s.mouseup=this.onTileEvent.bind(this,"mouseup",s),s.mousemove=this.onTileEvent.bind(this,"mousemove",s),s.mouseout=this.onTileEvent.bind(this,"mouseout",s),s.mouseover=this.onTileEvent.bind(this,"mouseover",s),s.mouseupoutside=this.onTileEvent.bind(this,"mouseupoutside",s)),this.tiles[i]||(this.tiles[i]=[]),this.tiles[i][r]=s,s):(this._freeTile(t,e),void 0)},onTileEvent:function(t,e,i){this.map.onTileEvent(t,e,i)},_getInteractive:function(t,e){return e.interactive||t&&t.properties.interactive||this.properties.interactive||this.map.properties.interactive},pan:function(t,e){if(!this.preRender){this._panDelta.x+=t,this._panDelta.y+=e;var i=this.map.scaledTileSize.x,r=this.map.scaledTileSize.y;for(t>0&&!this._buffered.left?this._renderLeft(this._buffered.left=!0):0>t&&!this._buffered.right&&this._renderRight(this._buffered.right=!0),e>0&&!this._buffered.top?this._renderUp(this._buffered.top=!0):0>e&&!this._buffered.bottom&&this._renderDown(this._buffered.bottom=!0);this._panDelta.x>=i;)this._renderLeft(),this._panDelta.x-=i;for(;this._panDelta.x<=-i;)this._renderRight(),this._panDelta.x+=i;for(;this._panDelta.y>=r;)this._renderUp(),this._panDelta.y-=r;for(;this._panDelta.y<=-r;)this._renderDown(),this._panDelta.y+=r}},_renderLeft:function(t){for(var e=0;e<this._rendered.height+1;++e)this.moveTileSprite(t?-1:this._rendered.right,t?-1:this._rendered.top+e,this._rendered.left-1,this._rendered.top+e);this._rendered.x--,t&&this._rendered.width++},_renderRight:function(t){for(var e=0;e<this._rendered.height+1;++e)this.moveTileSprite(t?-1:this._rendered.left,t?-1:this._rendered.top+e,this._rendered.right+1,this._rendered.top+e);t||this._rendered.x++,t&&this._rendered.width++},_renderUp:function(t){for(var e=0;e<this._rendered.width+1;++e)this.moveTileSprite(t?-1:this._rendered.left+e,t?-1:this._rendered.bottom,this._rendered.left+e,this._rendered.top-1);this._rendered.y--,t&&this._rendered.height++},_renderDown:function(t){for(var e=0;e<this._rendered.width+1;++e)this.moveTileSprite(t?-1:this._rendered.left+e,t?-1:this._rendered.top,this._rendered.left+e,this._rendered.bottom+1);t||this._rendered.y++,t&&this._rendered.height++},destroy:function(){r.prototype.destroy.call(this),this.clearTiles(!0),this.state=null,this.name=null,this.size=null,this.tileIds=null,this.properties=null,this.type=null,this.position.x=null,this.position.y=null,this.alpha=null,this.visible=null,this.preRender=null,this.chunkSize=null,this._preRendered=null,this._tilePool=null,this._buffered=null,this._panDelta=null,this._rendered=null}}),i.exports=p,i.exports}),s("tilemap/Tileset",["require","exports","module","../utils/utils","../utils/inherit","../math/math","../display/Texture","../math/Vector","../vendor/pixi"],function(t,e,i){var r=t("../utils/utils"),s=t("../utils/inherit"),n=t("../math/math"),o=t("../display/Texture"),a=t("../math/Vector"),h=t("../vendor/pixi"),l=function(t,e){o.call(this,t.baseTexture||t),this.firstgid=e.firstgid||1,this.name=e.name,this.tileSize=new a(e.tilewidth,e.tileheight),this.spacing=e.spacing||0,this.margin=e.margin||0,this.tileoffset=new a(e.tileoffset?e.tileoffset.x:0,e.tileoffset?e.tileoffset.y:0),this.numTiles=new a(n.floor((this.baseTexture.source.width-this.margin)/(this.tileSize.x-this.spacing)),n.floor((this.baseTexture.source.height-this.margin)/(this.tileSize.y-this.spacing))),this.lastgid=this.firstgid+(this.numTiles.x*this.numTiles.y-1||0),this.properties=e.properties||{},this.tileproperties=e.tileproperties||{},this.size=new a(e.imagewidth||this.baseTexture.source.width,e.imageheight||this.baseTexture.source.height),this.textures=[],this.properties=r.parseTiledProperties(this.properties);for(var i in this.tileproperties)this.tileproperties[i]=r.parseTiledProperties(this.tileproperties[i]);for(var s=0,l=this.lastgid-this.firstgid+1;l>s;++s){var u=n.floor(s/this.numTiles.x),c=s-u*this.numTiles.x;c=c*this.tileSize.x+c*this.spacing+this.margin,u=u*this.tileSize.y+u*this.spacing+this.margin,this.textures.push(new o(this.baseTexture,new h.Rectangle(c,u,this.tileSize.x,this.tileSize.y)))}};s(l,o,{getTileProperties:function(t){if(!t)return null;var e=l.FLAGS,i=t&e.FlippedX,r=t&e.FlippedY,s=t&e.RotatedCW;if(t=(t&~l.FLAGS.ALL)-this.firstgid,0>t)return null;var n=this.tileproperties[t]?this.tileproperties[t]:this.tileproperties[t]={collidable:!1,breakable:!1};return n.flippedX=i,n.flippedY=r,n.rotatedCW=s,n},getTileTexture:function(t){return t?(t=(t&~l.FLAGS.ALL)-this.firstgid,0>t?null:this.textures[t]):null},contains:function(t){return t?(t&=~l.FLAGS.ALL,t>=this.firstgid&&t<=this.lastgid):!1}}),l.FLAGS={FlippedX:2147483648,FlippedY:1073741824,RotatedCW:536870912};var u=0;for(var c in l.FLAGS)u|=l.FLAGS[c];return l.FLAGS.ALL=u,i.exports=l,i.exports}),s("tilemap/Tilemap",["require","exports","module","../display/Container","./ObjectGroup","../display/Sprite","../math/Vector","./Tilelayer","./Tileset","../utils/utils","../utils/inherit"],function(t,e,i){var r=t("../display/Container"),s=t("./ObjectGroup"),n=t("../display/Sprite"),o=t("../math/Vector"),a=t("./Tilelayer"),h=t("./Tileset"),l=t("../utils/utils"),u=t("../utils/inherit"),c=function(t,e,i){r.call(this,e),this.state=t,this.game=t.game,this.properties=l.parseTiledProperties(e.properties)||{},this.scale.x=this.properties.scale||1,this.scale.y=this.properties.scale||1,this.tileSize=new o(e.tilewidth,e.tileheight),this.size=new o(e.width,e.height),this.orientation=e.orientation,this.version=e.version,this.backgroundColor=e.backgroundColor,this.tilesets=[],this.scaledTileSize=new o(e.tilewidth*this.scale.x,e.tileheight*this.scale.y),this.realSize=new o(this.size.x*this.scaledTileSize.x,this.size.y*this.scaledTileSize.y);for(var u=0,c=e.tilesets.length;c>u;++u){var p=e.tilesets[u];this.tilesets.push(new h(i[p.name],p))}for(var d=0,f=e.layers.length;f>d;++d){var m;switch(e.layers[d].type){case"tilelayer":m=new a(this,e.layers[d]);break;case"objectgroup":m=new s(this,e.layers[d]);break;case"imagelayer":m=new n(e.layers[d])}this.addChild(m)}var v=this.game.state.active.world;v.bounds.width=Math.max(v.bounds.width,this.realSize.x),v.bounds.height=Math.max(v.bounds.height,this.realSize.y)};return u(c,r,{getTileset:function(t){for(var e=0,i=this.tilesets.length;i>e;++e)if(this.tilesets[e].contains(t))return this.tilesets[e]},destroy:function(){r.prototype.destroy.call(this),this.game=null,this.properties=null,this.tileSize=null,this.size=null,this.orientation=null,this.version=null,this.backgroundColor=null,this.tilesets=null,this.scaledTileSize=null,this.realSize=null},spawnObjects:function(){for(var t=0,e=this.children.length;e>t;++t){var i=this.children[t];"objectgroup"===i.type&&i.spawn()}return this},despawnObjects:function(){for(var t=0,e=this.children.length;e>t;++t){var i=this.children[t];"objectgroup"===i.type&&i.despawn()}return this},clearTiles:function(){for(var t=0,e=this.children.length;e>t;++t){var i=this.children[t];"tilelayer"===i.type&&i.clearTiles()}return this},onTileEvent:function(t,e,i){this.emit("tile."+t,{tile:e,data:i})},onObjectEvent:function(t,e,i){this.emit("object."+t,{object:e,data:i})},findLayer:function(t){for(var e=0,i=this.children.length;i>e;++e){var r=this.children[e];if(r.name===t)return r}},pan:function(t,e){for(var i=0,r=this.children.length;r>i;++i){var s=this.children[i];s.pan&&s.pan(t,e)}return this},render:function(t,e,i,r){t=t||-this.state.world.position.x,e=e||-this.state.world.position.y,i=i||this.game.width,r=r||this.game.height;for(var s=0,n=this.children.length;n>s;++s){var o=this.children[s];o.render&&o.render(t,e,i,r)}return this}}),i.exports=c,i.exports}),s("text/BitmapText",["require","exports","module","../display/Container","../utils/ObjectPool","../display/Texture","../display/Sprite","../math/Vector","../geom/Rectangle","../utils/utils","../utils/inherit","../vendor/pixi"],function(t,e,i){var r=t("../display/Container"),s=t("../utils/ObjectPool"),n=t("../display/Texture"),o=t("../display/Sprite"),a=t("../math/Vector"),h=t("../geom/Rectangle"),l=t("../utils/utils"),u=t("../utils/inherit"),c=t("../vendor/pixi"),p=function(t,e,i){r.call(this),this.dirty=!1,this.font=e,this.monospace=0,this._text=t,this.sprites=new s(o,this),this.text=t,this.setStyle(i)};return u(p,r,{setStyle:function(t){t=t||{},this.align=t.align,this.size=t.size||this.font.size,this.dirty=!0},renderText:function(){for(var t=this.font,e=new a,i=null,r=[],s=0,n=[],o=0,h=this.size/t.size,l=0;l<this.text.length;++l){var u=this.text.charCodeAt(l),c=this.text.charAt(l);if(/(?:\r\n|\r|\n)/.test(c))n.push(e.x),s=Math.max(s,e.x),o++,e.x=0,e.y+=t.lineHeight,i=null;else{var p=t.chars[u];p&&(i&&p[i]&&(e.x+=p.kerning[i]||0),r.push({texture:p.texture,line:o,code:u,x:e.x+p.xOffset,y:e.y+p.yOffset}),e.x+=this.monospace||p.xAdvance,i=u)}}n.push(e.x),s=Math.max(s,e.x);var d=[],f=this.align,m=0;for(l=0;o>=l;++l)m=0,"right"===f?m=s-n[l]:"center"===f&&(m=(s-n[l])/2),d.push(m);for(l=0;l<r.length;++l){var v=this.sprites.create(r[l].texture);v.setTexture(r[l].texture),v.visible=!0,v.position.x=(r[l].x+d[r[l].line])*h,v.position.y=r[l].y*h,v.scale.x=v.scale.y=h,this.addChild(v)}this.width=e.x*h,this.height=(e.y+t.lineHeight)*h},clone:function(){return new p(this._text,this.font,{align:this.align,size:this.size})},updateTransform:function(){if(this.dirty){for(var t=0,e=this.children.length;e>t;++t){var i=this.children[t];i.visible=!1,this.sprites.free(i)}this.renderText(),this.dirty=!1}r.prototype.updateTransform.call(this)}}),Object.defineProperty(p.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this.dirty=!0}}),p.parseXML=function(t,e,i){var r=i.baseTexture;e.getElementsByTagName("font")||l.warn("Invalid XML for BitmapText.parseXML(), missing <font> tag. Full XML:",e);var s={},o=e.getElementsByTagName("info")[0],a=e.getElementsByTagName("common")[0];s.name=o.attributes.getNamedItem("face").nodeValue,s.size=parseInt(o.attributes.getNamedItem("size").nodeValue,10),s.lineHeight=parseInt(a.attributes.getNamedItem("lineHeight").nodeValue,10),s.chars={};for(var u=e.getElementsByTagName("char"),p=0,d=u.length;d>p;++p){var f=u[p],m=f.attributes,v=parseInt(m.getNamedItem("id").nodeValue,10),y=new h(parseInt(m.getNamedItem("x").nodeValue,10),parseInt(m.getNamedItem("y").nodeValue,10),parseInt(m.getNamedItem("width").nodeValue,10),parseInt(m.getNamedItem("height").nodeValue,10)),g=c.TextureCache[t+"_"+v]=new n(r,y);s.chars[v]={xOffset:parseInt(m.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(m.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(m.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:g}}var b=e.getElementsByTagName("kerning");for(p=0,d=b.length;d>p;++p){var x=b[p],_=x.attributes,T=parseInt(_.getNamedItem("first").nodeValue,10),w=parseInt(_.getNamedItem("second").nodeValue,10),S=parseInt(_.getNamedItem("amount").nodeValue,10);s.chars[w].kerning[T]=S}return c.BitmapText.fonts[s.name]=s,s},i.exports=p,i.exports}),s("utils/ObjectFactory",["require","exports","module","./inherit","../gui/GuiItem","../display/Sprite","../tilemap/Tilemap","../geom/Rectangle","../text/BitmapText","../constants"],function(t,e,i){var r=t("./inherit"),s=t("../gui/GuiItem"),n=t("../display/Sprite"),o=t("../tilemap/Tilemap"),a=t("../geom/Rectangle"),h=t("../text/BitmapText"),l=t("../constants"),u=function(t,e){this.state=t,this.game=t.game,this.parent=e};return r(u,Object,{obj:function(t){return this.parent.addChild(t)},sprite:function(t,e,i){var r,s=this.game;return"string"==typeof t&&(t=e||0===e?s.cache.getTextures(t)[e]:s.cache.getTexture(t)),t||(t=s.cache.getTexture("__default")),r=new n(t),(i||void 0===i)&&r.enablePhysics(this.state.physics),this.parent.addChild(r)},audio:function(t,e){return this.state.audio.add(t,e)},tilemap:function(t,e){var i,r=this.game.cache.getTilemap(t)||{},s=r.format,n=r.data,h=r.textures;return s===l.FILE_FORMAT.JSON?i=new o(this.state,n,h):s===l.FILE_FORMAT.XML?i=o.fromXML(this.state,n,h):s===l.FILE_FORMAT.CSV&&(i=o.fromCSV(this.state,n,h)),e&&this.state.camera.constrain(new a(0,0,i.realSize.x,i.realSize.y)),i.render(-this.state.world.position.x,-this.state.world.position.x,this.game.width,this.game.height),i._cachekey=t,this.parent.addChild(i)},gui:function(t,e){return"string"==typeof t&&(t=this.game.cache.getTexture(t)),this.parent.addChild(new s(t,e))},bitmaptext:function(t,e,i){return"string"==typeof e&&(e=this.game.cache.getBitmapFont(e)),this.parent.addChild(new h(t,e,i))}}),i.exports=u,i.exports}),s("display/Graphics",["require","exports","module","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").Graphics;return i.exports=r,i.exports}),s("fx/camera/Effect",["require","exports","module","../../display/Container","../../utils/inherit","../../display/Graphics"],function(t,e,i){var r=t("../../display/Container"),s=t("../../utils/inherit"),n=t("../../display/Graphics"),o=function(){r.call(this),this.gfx=this.addChild(new n),this.gfx.visible=!1,this.done=!0};return s(o,r,{start:function(t){return this.done=!1,this.cb=t,this},stop:function(){return this.done=!0,this},update:function(){return this},_complete:function(){if(this.done=!0,"function"==typeof this.cb){var t=this.cb();t!==!1&&this.stop()}else this.stop()}}),i.exports=o,i.exports}),s("fx/camera/Close",["require","exports","module","./Effect","../../utils/inherit"],function(t,e,i){var r=t("./Effect"),s=t("../../utils/inherit"),n=function(){r.call(this)};return s(n,r,{start:function(t,e,i,s){return"function"==typeof i&&(s=i,i=null),"function"==typeof e&&(s=e,i=null,e=null),"function"==typeof t&&(s=t,i=null,e=null,t=null),r.prototype.start.call(this,s),this.shape=t||"circle",this.duration=e&&e>0?e:1e3,this.cx=i?i.x:this.parent.size.x/2,this.cy=i?i.y:this.parent.size.y/2,this.w=this.mx=this.parent.size.x,this.h=this.my=this.parent.size.y,this.radius=this.maxRadius=Math.max(this.w/2,this.h/2),this.gfx.visible=!0,this.gfx.position.x=this.cx,this.gfx.position.y=this.cy,this.parent.state.mask=this.gfx,this.gfx.scale.y="ellipse"===t?.5:1,this},stop:function(){return r.prototype.stop.call(this),this.radius=this.sx=this.sy=0,this.gfx.visible=!1,this.parent.state.mask===this.gfx&&(this.parent.state.mask=null),this},update:function(t){if(!this.done){var e=1e3*t/this.duration;switch(this.gfx.clear(),this.gfx.beginFill(16711935),this.shape){case"ellipse":case"circle":this.radius-=e*this.maxRadius,this.radius<=0?this._complete():this.gfx.drawCircle(0,0,this.radius);break;case"rect":case"rectangle":this.w-=e*this.mx,this.h-=e*this.my,this.w<=0?this._complete():this.gfx.drawRect(-(this.w/2),-(this.h/2),this.w,this.h)}return this.gfx.endFill(),this}}}),i.exports=n,i.exports}),s("fx/camera/Fade",["require","exports","module","./Effect","../../utils/inherit"],function(t,e,i){var r=t("./Effect"),s=t("../../utils/inherit"),n=function(){r.call(this)};return s(n,r,{start:function(t,e,i,s){return"function"==typeof i&&(s=e,i=null),"function"==typeof e&&(s=e,i=null,e=null),"function"==typeof t&&(s=t,i=null,e=null,t=null),r.prototype.start.call(this,s),t="number"==typeof t?t:16777215,this.goal=i||1,this.duration=e&&e>0?e:1e3,this.gfx.visible=!0,this.gfx.alpha=0,this.gfx.clear(),this.gfx.beginFill(t),this.gfx.drawRect(0,0,this.parent.size.x,this.parent.size.y),this},stop:function(){return r.prototype.stop.call(this),this.gfx.alpha=0,this.gfx.visible=!1,this},update:function(t){return this.done?void 0:(this.gfx.alpha<this.goal&&(this.gfx.alpha+=1e3*t/this.duration,this.gfx.alpha>=this.goal&&this._complete()),this)}}),i.exports=n,i.exports}),s("fx/camera/Flash",["require","exports","module","./Effect","../../utils/inherit"],function(t,e,i){var r=t("./Effect"),s=t("../../utils/inherit"),n=function(){r.call(this)};return s(n,r,{start:function(t,e,i,s){return"function"==typeof i&&(s=e,i=null),"function"==typeof e&&(s=e,i=null,e=null),"function"==typeof t&&(s=t,i=null,e=null,t=null),r.prototype.start.call(this,s),i=i||1,t="number"==typeof t?t:16777215,this.duration=e&&e>0?e:1e3,this.gfx.visible=!0,this.gfx.alpha=i,this.gfx.clear(),this.gfx.beginFill(t),this.gfx.drawRect(0,0,this.parent.size.x,this.parent.size.y),this},stop:function(){return r.prototype.stop.call(this),this.gfx.alpha=0,this.gfx.visible=!1,this},update:function(t){return this.done?void 0:(this.gfx.alpha>0&&(this.gfx.alpha-=1e3*t/this.duration,this.gfx.alpha<=0&&this._complete()),this)}}),i.exports=n,i.exports}),s("fx/camera/Scanlines",["require","exports","module","./Effect","../../utils/inherit","../../constants"],function(t,e,i){var r=t("./Effect"),s=t("../../utils/inherit"),n=t("../../constants"),o=function(){r.call(this)};return s(o,r,{start:function(t,e,i,s,o,a){"function"==typeof o&&(a=o,o=null),"function"==typeof s&&(a=s,o=null,s=null),"function"==typeof i&&(a=i,o=null,s=null,i=null),"function"==typeof e&&(a=i,o=null,s=null,i=null,e=null),"function"==typeof t&&(a=i,o=null,s=null,i=null,e=null,t=null),r.prototype.start.call(this,a),t=t||0,e=e||n.AXIS.HORIZONTAL,i=i||4,s=s||1,o=o||.3;var h=this.parent.size.x,l=this.parent.size.y;if(this.gfx.clear(),this.gfx.visible=!0,this.gfx.beginFill(t,o),e&n.AXIS.VERTICAL)for(var u=0;h>u;u+=i)this.gfx.drawRect(u,0,s,l);if(e&n.AXIS.HORIZONTAL)for(var c=0;l>c;c+=i)this.gfx.drawRect(0,c,h,s);return this.gfx.endFill(),this},stop:function(){return r.prototype.stop.call(this),this.gfx.visible=!1,this}}),i.exports=o,i.exports}),s("fx/camera/Shake",["require","exports","module","./Effect","../../math/Vector","../../utils/inherit","../../math/math","../../constants"],function(t,e,i){var r=t("./Effect"),s=t("../../math/Vector"),n=t("../../utils/inherit"),o=t("../../math/math"),a=t("../../constants"),h=function(){r.call(this),this.offset=new s};return n(h,r,{start:function(t,e,i,s){return"function"==typeof i&&(s=i,i=null),"function"==typeof e&&(s=e,i=null,e=null),"function"==typeof t&&(s=t,i=null,e=null,t=null),r.prototype.start.call(this,s),this.intensity=t||.01,this.duration=e||1e3,this.direction=i||a.AXIS.BOTH,this.offset.x=this.offset.y=0,this},stop:function(){return r.prototype.stop.call(this),this.duration=this.offset.x=this.offset.y=0,this},update:function(t){this.done||(this.duration-=1e3*t,this.offset.x=-this.offset.x,this.offset.y=-this.offset.y,this.parent.pan(this.offset.x,this.offset.y),this.duration<=0?this._complete():(this.direction&a.AXIS.HORIZONTAL&&(this.offset.x=o.round(2*Math.random()*this.intensity*this.parent.size.x-this.intensity*this.parent.size.x)),this.direction&a.AXIS.VERTICAL&&(this.offset.y=o.round(2*Math.random()*this.intensity*this.parent.size.y-this.intensity*this.parent.size.y)),this.parent.pan(this.offset.x,this.offset.y)))}}),i.exports=h,i.exports}),s("camera/Camera",["require","exports","module","../display/Container","../display/Sprite","../geom/Rectangle","../math/Vector","../utils/ObjectPool","../utils/ObjectFactory","../fx/camera/Close","../fx/camera/Fade","../fx/camera/Flash","../fx/camera/Scanlines","../fx/camera/Shake","../utils/inherit","../math/math","../constants"],function(t,e,i){var r=t("../display/Container"),s=t("../display/Sprite"),n=t("../geom/Rectangle"),o=t("../math/Vector"),a=t("../utils/ObjectPool"),h=t("../utils/ObjectFactory"),l=t("../fx/camera/Close"),u=t("../fx/camera/Fade"),c=t("../fx/camera/Flash"),p=t("../fx/camera/Scanlines"),d=t("../fx/camera/Shake"),f=t("../utils/inherit"),m=t("../math/math"),v=t("../constants"),y=function(t){this.world=t.world,this.game=t.game,this.state=t,this.bounds=t.world.bounds.clone(),this._deadzone=null,this._target=null,this._targetPos=new o,this.size=new o,this.hSize=new o,this.gui=new r,this.add=new h(t,this.gui),this.fxpools={flash:new a(c,this),fade:new a(u,this),shake:new a(d,this),scanlines:new a(p,this),close:new a(l,this)};var e=this;Object.keys(this.fxpools).forEach(function(t){e[t]=function(){var i=e.fxpools[t].create(),r=Array.prototype.slice.call(arguments),s=r.pop();return void 0!==s&&"function"!=typeof s&&r.push(s),r.push(this._fxCallback.bind(this,i,t,s)),i.start.apply(i,r)}}),r.call(this),this.addChild(this.gui)};return f(y,r,{_fxCallback:function(t,e,i){var r;return"function"==typeof i&&(r=i()),this.fxpools[e].free(t),r},follow:function(t,e){if(!(t instanceof s))return this;switch(this._target=t,this._targetPos.set(null,null),e){case v.CAMERA_FOLLOW.PLATFORMER:var i=this.size.x/8,r=this.size.y/3;this._deadzone=new n((this.size.x-i)/2,(this.size.y-r)/2-r/4,i,r);break;case v.CAMERA_FOLLOW.TOPDOWN:var o=Math.max(this.size.x,this.size.y)/4;this._deadzone=new n((this.size.x-o)/2,(this.size.y-o)/2,o,o);break;case v.CAMERA_FOLLOW.TOPDOWN_TIGHT:var a=Math.max(this.size.x,this.size.y)/8;this._deadzone=new n((this.size.x-a)/2,(this.size.y-a)/2,a,a);break;case v.CAMERA_FOLLOW.LOCKON:default:this._deadzone=null}return this.focusSprite(this._target),this},unfollow:function(){return this._target=null,this._targetPos.set(null,null),this},focusSprite:function(t){for(var e=t.position.x,i=t.position.y,r=t.parent;r&&r!==this.world;)e+=r.position.x,i+=r.position.y,r=r.parent;return this.focus(m.floor(e*t.worldTransform[0]),m.floor(i*t.worldTransform[4]))},focus:function(t,e){e=void 0!==t.y?t.y:e||0,t=void 0!==t.x?t.x:t||0;var i=t-this.hSize.x,r=e-this.hSize.y,s=i+this.world.position.x,n=r+this.world.position.y;return this.pan(s,n)},pan:function(t,e){if(e=void 0!==t.y?t.y:e||0,t=void 0!==t.x?t.x:t||0,t||e){var i=this.world.position,r=i.x-t,s=i.y-e,n=this.bounds;return n&&(this._outsideBounds(-r,-i.y)&&(t=(0>t?n.x:n.right-this.size.x)+i.x),this._outsideBounds(-i.x,-s)&&(e=(0>e?n.y:n.bottom-this.size.y)+i.y)),(t||e)&&(t||(t=0),e||(e=0),this.world.pan(-t,-e)),this}},_outsideBounds:function(t,e){return!(this.bounds.contains(t,e)&&this.bounds.contains(t,e+this.size.y)&&this.bounds.contains(t+this.size.x,e)&&this.bounds.contains(t+this.size.x,e+this.size.y))},resize:function(t,e){return this.size.set(t,e),this.hSize.set(m.round(this.size.x/2),m.round(this.size.y/2)),this},constrain:function(t){return this.bounds=t,this},unconstrain:function(){return this.bounds=null,this},update:function(t){if(this._target&&!this._target.position.equals(this._targetPos))if(this._targetPos.copy(this._target.position),this._deadzone){var e,i,r,s,n=this._target.position.x+this.world.position.x,o=this._target.position.y+this.world.position.y;e=i=r=s=0,r=n-this._deadzone.x,s=o-this._deadzone.y,0>r&&(e=r),0>s&&(i=s),r=n-(this._deadzone.x+this._deadzone.width),s=o-(this._deadzone.y+this._deadzone.height),r>0&&(e=r),s>0&&(i=s),this.pan(m.round(e),m.round(i))}else this.focusSprite(this._target);for(var a=0,h=this.children.length;h>a;++a){var l=this.children[a];l.update&&l.update(t)}return this}}),i.exports=y,i.exports}),s("display/BaseTexture",["require","exports","module","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").BaseTexture;return i.exports=r,i.exports}),s("display/RenderTexture",["require","exports","module","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").RenderTexture;return i.exports=r,i.exports}),s("display/TilingSprite",["require","exports","module","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").TilingSprite;return i.exports=r,i.exports}),s("particles/ParticleEmitter",["require","exports","module","../display/Sprite","../display/Texture","../display/Container","../math/Vector","../math/math","../utils/inherit","../constants"],function(t,e,i){var r=t("../display/Sprite"),s=t("../display/Texture"),n=t("../display/Container"),o=t("../math/Vector"),a=t("../math/math"),h=t("../utils/inherit"),l=t("../constants"),u=function(t){n.call(this),this.name=t,this.maxParticles=100,this.width=0,this.height=0,this.lifespan=2e3,this.minSpeed=new o(-100,-100),this.maxSpeed=new o(100,100),this.minScale=1,this.maxScale=1,this.minRotation=-2*Math.PI,this.maxRotation=2*Math.PI,this.delay=100,this.active=!1,this.particles=[],this._rate=0,this._total=0,this._emitted=0,this._timer=0,this._particle=null,this._textures=null,this._pool=[]};return h(u,n,{start:function(t,e,i,r){return this.active=!0,this.lifespan=t||2e3,this.delay=e||250,this._rate=i||1,this._total=r||l.PARTICLES.MAX_EMITTER_PARTICLES,this._timer=0,this},stop:function(){return this.active=!1,this},setup:function(t,e){return void 0===e&&(e=l.DIRECTION.ALL),t instanceof s?(this._particle=new r(t),this._textures=[t]):Array.isArray(t)?(this._particle=new r(t[0]),this._textures=t):(this._particle=t,this._textures=[t.texture]),this},_get:function(){if(this._emitted>=this._total||this._emitted>this.maxParticles)return null;var t=this._pool.pop();return t||(t=this._particle.clone()),t.setTexture(a.randomElement(this._textures)),t.visible=!0,this.addChild(t),this._emitted++,t},_free:function(t){t.visible=!1,this._pool.push(t),this.removeChild(t),this._emitted--},emitParticle:function(){var t=this._get();if(t)return t.setPosition(a.randomInt(0,this.width),a.randomInt(0,this.height)),t.scale.x=t.scale.y=a.randomReal(this.minScale,this.maxScale),t.lifespan=this.lifespan,t.setVelocity(a.randomInt(this.minSpeed.x,this.maxSpeed.x),a.randomInt(this.minSpeed.y,this.maxSpeed.y)),this},update:function(t){for(var e=1e3*t,i=0;i<this.children.length;++i){var r=this.children[i];r.lifespan-=e,r.lifespan<=0&&this._free(r)}if(this.active&&(this._timer+=e,this._timer>=this._delay)){this._timer-=this._delay;for(var s=0;s<this._rate;++s)this.emitParticle()}}}),i.exports=u,i.exports}),s("particles/ParticleSystem",["require","exports","module","./ParticleEmitter","../display/Container","../utils/inherit"],function(t,e,i){var r=t("./ParticleEmitter"),s=t("../display/Container"),n=t("../utils/inherit"),o=function(){s.call(this),this.emitters={},this.nextId=0};return n(o,s,{add:function(t){var e;return e="string"==typeof t?new r(t):"function"==typeof t?new t:t,e.name||(e.name="emitter_"+this.nextId++),this.emitters[e.name]=e,this.addChild(e),e},remove:function(t){return"string"==typeof t&&(t=this.emitters[t]),t.parent&&t.parent.removeChild(t),delete this.emitters[t.name],this},update:function(t){for(var e=0,i=this.children.length;i>e;++e){var r=this.children[e];r.update&&r.update(t)}}}),i.exports=o,i.exports}),s("game/World",["require","exports","module","../utils/inherit","../display/Container","../geom/Rectangle","../utils/ObjectFactory","../particles/ParticleSystem","../math/math"],function(t,e,i){var r=t("../utils/inherit"),s=t("../display/Container"),n=t("../geom/Rectangle"),o=t("../utils/ObjectFactory"),a=t("../particles/ParticleSystem"),h=t("../math/math"),l=function(t){s.call(this),this.game=t.game,this.state=t,this.particles=this.addChild(new a),this.bounds=new n(0,0,t.game.width,t.game.height),this.add=new o(t,this)};return r(l,s,{pan:function(t,e){e=h.floor(void 0!==t.y?t.y:e||0),t=h.floor(void 0!==t.x?t.x:t||0),this.position.x+=t*this.scale.x,this.position.y+=e*this.scale.y;for(var i=0,r=this.children.length;r>i;++i){var s=this.children[i];s.pan&&s.pan(t,e)}return this},resize:function(t,e){for(var i=0,r=this.children.length;r>i;++i){var s=this.children[i];s.render&&s.render(-this.position.x,-this.position.y,t,e)}return this},update:function(t){this.particles.update(t)}}),i.exports=l,i.exports}),s("vendor/cp",["require","exports","module"],function(t,i,r){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var s;"undefined"==typeof i?(s={},"object"==typeof e&&(e.cp=s)):s=i;var n,o,a=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},h=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},l=function(t,e){return e>t?t:e},u=function(t,e){return t>e?t:e};"object"==typeof e&&e.navigator.userAgent.indexOf("Firefox")>-1?(n=Math.min,o=Math.max):(n=l,o=u);var c=function(t,e){return e>t?t+" "+e:e+" "+t},p=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],t.length--,void 0},d=function(t,e,i){var r=R(e,i),s=x(w(r,R(t,i))/k(r));return C(i,P(r,s))},f=function(t,e,i,r,s,n){var o=i-s,a=r-n,h=x(S(o,a,t-s,e-n)/D(o,a));return new _(s+o*h,n+a*h)};s.momentForCircle=function(t,e,i,r){return t*(.5*(e*e+i*i)+k(r))},s.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},s.momentForSegment=function(t,e,i){var r=P(C(e,i),.5);return t*(V(i,e)/12+k(r))},s.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*z(t,e))},s.momentForPoly=function(t,e,i){for(var r=0,s=0,n=e.length,o=0;n>o;o+=2){var a=e[o]+i.x,h=e[o+1]+i.y,l=e[(o+2)%n]+i.x,u=e[(o+3)%n]+i.y,c=O(l,u,a,h),p=S(a,h,a,h)+S(a,h,l,u)+S(l,u,l,u);r+=c*p,s+=c}return t*r/(6*s)},s.areaForPoly=function(t){for(var e=0,i=0,r=t.length;r>i;i+=2)e+=M(new _(t[i],t[i+1]),new _(t[(i+2)%r],t[(i+3)%r]));return-e/2},s.centroidForPoly=function(t){for(var e=0,i=new _(0,0),r=0,s=t.length;s>r;r+=2){var n=new _(t[r],t[r+1]),o=new _(t[(r+2)%s],t[(r+3)%s]),a=M(n,o);e+=a,i=C(i,P(C(n,o),a))}return P(i,1/(3*e))},s.recenterPoly=function(t){for(var e=s.centroidForPoly(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},s.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},s.momentForBox2=function(t,e){var i=e.r-e.l,r=e.t-e.b,n=P([e.l+e.r,e.b+e.t],.5);return s.momentForBox(t,i,r)+t*k(n)};var m=s.loopIndexes=function(t){var e,i,r,s,n=0,o=0;e=r=t[0],i=s=t[1];for(var a=t.length>>1,h=1;a>h;h++){var l=t[2*h],u=t[2*h+1];e>l||l==e&&i>u?(e=l,i=u,n=h):(l>r||l==r&&u>s)&&(r=l,s=u,o=h)}return[n,o]},v=function(t,e,i){var r=t[2*e];t[2*e]=t[2*i],t[2*i]=r,r=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=r},y=function(t,e,i,r,s,n){if(0===i)return 0;for(var o=0,a=e,h=R(s,r),l=n*A(h),u=e,c=e+i-1;c>=u;){var p=new _(t[2*u],t[2*u+1]),d=M(h,R(p,r));d>l?(d>o&&(o=d,a=u),u++):(v(t,u,c),c--)}return a!=e&&v(t,e,a),u-e},g=function(t,e,i,r,s,n,o,a){if(0>r)return 0;if(0==r)return e[2*a]=n.x,e[2*a+1]=n.y,1;var h=y(e,i,r,s,n,t),l=new _(e[2*i],e[2*i+1]),u=g(t,e,i+1,h-1,s,l,n,a),c=a+u++;e[2*c]=n.x,e[2*c+1]=n.y;var p=y(e,i+h,r-h,n,o,t),d=new _(e[2*(i+h)],e[2*(i+h)+1]);
return u+g(t,e,i+h+1,p-1,n,d,o,a+u)};s.convexHull=function(t,e,i){if(e)for(var r=0;r<t.length;r++)e[r]=t[r];else e=t;var s=m(t),n=s[0],o=s[1];if(n==o)return e.length=2,e;v(e,0,n),v(e,1,0==o?n:o);var a=new _(e[0],e[1]),l=new _(e[2],e[3]),u=t.length>>1,c=g(i,e,2,u-2,a,l,a,1)+1;return e.length=2*c,h(se(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var b=function(t,e,i){return n(o(t,e),i)},x=function(t){return o(0,n(t,1))},_=s.Vect=function(t,e){this.x=t,this.y=e};s.v=function(t,e){return new _(t,e)};var T=s.vzero=new _(0,0),w=s.v.dot=function(t,e){return t.x*e.x+t.y*e.y},S=function(t,e,i,r){return t*i+e*r},A=s.v.len=function(t){return Math.sqrt(w(t,t))},E=s.v.len2=function(t,e){return Math.sqrt(t*t+e*e)};s.v.eql=function(t,e){return t.x===e.x&&t.y===e.y};var C=s.v.add=function(t,e){return new _(t.x+e.x,t.y+e.y)};_.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var R=s.v.sub=function(t,e){return new _(t.x-e.x,t.y-e.y)};_.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var L=s.v.neg=function(t){return new _(-t.x,-t.y)};_.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var P=s.v.mult=function(t,e){return new _(t.x*e,t.y*e)};_.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var M=s.v.cross=function(t,e){return t.x*e.y-t.y*e.x},O=function(t,e,i,r){return t*r-e*i},I=s.v.perp=function(t){return new _(-t.y,t.x)};s.v.pvrperp=function(t){return new _(t.y,-t.x)};var B=s.v.project=function(t,e){return P(e,w(t,e)/k(e))};_.prototype.project=function(t){return this.mult(w(this,t)/k(t)),this};var F=s.v.rotate=function(t,e){return new _(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};_.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var j=s.v.unrotate=function(t,e){return new _(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},k=s.v.lengthsq=function(t){return w(t,t)},D=s.v.lengthsq2=function(t,e){return t*t+e*e},G=s.v.lerp=function(t,e,i){return C(P(t,1-i),P(e,i))},N=s.v.normalize=function(t){return P(t,1/A(t))},U=s.v.normalize_safe=function(t){return 0===t.x&&0===t.y?T:N(t)},W=s.v.clamp=function(t,e){return w(t,t)>e*e?P(N(t),e):t};s.v.lerpconst=function(t,e,i){return C(t,W(R(e,t),i))};var z=s.v.dist=function(t,e){return A(R(t,e))},V=s.v.distsq=function(t,e){return k(R(t,e))};s.v.near=function(t,e,i){return V(t,e)<i*i};var X=s.v.slerp=function(t,e,i){var r=Math.acos(w(t,e));if(r){var s=1/Math.sin(r);return C(P(t,Math.sin((1-i)*r)*s),P(e,Math.sin(i*r)*s))}return t};s.v.slerpconst=function(t,e,i){var r=Math.acos(w(t,e));return X(t,e,n(i,r)/r)},s.v.forangle=function(t){return new _(Math.cos(t),Math.sin(t))},s.v.toangle=function(t){return Math.atan2(t.y,t.x)},s.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"};var q=0,Y=s.BB=function(t,e,i,r){this.l=t,this.b=e,this.r=i,this.t=r,q++};s.bb=function(t,e,i,r){return new Y(t,e,i,r)};var H=function(t,e){return new Y(t.x-e,t.y-e,t.x+e,t.y+e)},J=function(t,e,i,r,s){return t.l<=r&&e<=t.r&&t.b<=s&&i<=t.t},K=0;s.NO_GROUP=0;var Q=s.ALL_LAYERS=-1;s.resetShapeIdCounter=function(){K=0};var $=s.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=K++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=T,this.collision_type=0,this.group=0,this.layers=Q,this.space=null,this.collisionCode=this.collisionCode};$.prototype.setElasticity=function(t){this.e=t},$.prototype.setFriction=function(t){this.body.activate(),this.u=t},$.prototype.setLayers=function(t){this.body.activate(),this.layers=t},$.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},$.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},$.prototype.getBody=function(){return this.body},$.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},$.prototype.setBody=function(t){a(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},$.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},$.prototype.update=function(t,e){a(!isNaN(e.x),"Rotation is NaN"),a(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},$.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);return e.d<0?e:void 0},$.prototype.getBB=function(){return new Y(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var Z=function(t,e,i){this.shape=t,this.p=e,this.d=i},te=function(t,e,i){this.shape=t,this.t=e,this.n=i};te.prototype.hitPoint=function(t,e){return G(t,e,this.t)},te.prototype.hitDist=function(t,e){return z(t,e)*this.t};var ee=s.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",$.call(this,t)};ee.prototype=Object.create($.prototype),ee.prototype.cacheData=function(t,e){var i=this.tc=F(this.c,e).add(t),r=this.r;this.bb_l=i.x-r,this.bb_b=i.y-r,this.bb_r=i.x+r,this.bb_t=i.y+r},ee.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,r=E(e,i),s=this.r,n=new _(this.tc.x+e*s/r,this.tc.y+i*s/r);return new Z(this,n,r-s)};var ie=function(t,e,i,r,s){r=R(r,e),s=R(s,e);var n=w(r,r)-2*w(r,s)+w(s,s),o=-2*w(r,r)+2*w(r,s),a=w(r,r)-i*i,h=o*o-4*n*a;if(h>=0){var l=(-o-Math.sqrt(h))/(2*n);if(l>=0&&1>=l)return new te(t,l,N(G(r,s,l)))}};ee.prototype.segmentQuery=function(t,e){return ie(this,this.tc,this.r,t,e)};var re=s.SegmentShape=function(t,e,i,r){this.a=e,this.b=i,this.n=I(N(R(i,e))),this.ta=this.tb=this.tn=null,this.r=r,this.a_tangent=T,this.b_tangent=T,this.type="segment",$.call(this,t)};re.prototype=Object.create($.prototype),re.prototype.cacheData=function(t,e){this.ta=C(t,F(this.a,e)),this.tb=C(t,F(this.b,e)),this.tn=F(this.n,e);var i,r,s,n;this.ta.x<this.tb.x?(i=this.ta.x,r=this.tb.x):(i=this.tb.x,r=this.ta.x),this.ta.y<this.tb.y?(s=this.ta.y,n=this.tb.y):(s=this.tb.y,n=this.ta.y);var o=this.r;this.bb_l=i-o,this.bb_b=s-o,this.bb_r=r+o,this.bb_t=n+o},re.prototype.nearestPointQuery=function(t){var e=d(t,this.ta,this.tb),i=t.x-e.x,r=t.y-e.y,s=E(i,r),n=this.r,o=s?C(e,P(new _(i,r),n/s)):e;return new Z(this,o,s-n)},re.prototype.segmentQuery=function(t,e){var i=this.tn,r=w(R(this.ta,t),i),s=this.r,n=r>0?L(i):i,o=R(P(n,s),t),a=C(this.ta,o),h=C(this.tb,o),l=R(e,t);if(M(l,a)*M(l,h)<=0){var u=r+(r>0?-s:s),c=-u,p=w(l,i)-u;if(0>c*p)return new te(this,c/(c-p),n)}else if(0!==s){var d=ie(this,this.ta,this.r,t,e),f=ie(this,this.tb,this.r,t,e);return d?f&&f.t<d.t?f:d:f}},re.prototype.setNeighbors=function(t,e){this.a_tangent=R(t,this.a),this.b_tangent=R(e,this.b)},re.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=I(N(R(e,t)))};var se=function(t){for(var e=t.length,i=0;e>i;i+=2){var r=t[i],s=t[i+1],n=t[(i+2)%e],o=t[(i+3)%e],a=t[(i+4)%e],h=t[(i+5)%e];if(O(n-r,o-s,a-n,h-o)>0)return!1}return!0},ne=s.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",$.call(this,t)};ne.prototype=Object.create($.prototype);var oe=function(t,e){this.n=t,this.d=e};oe.prototype.compare=function(t){return w(this.n,t)-this.d},ne.prototype.setVerts=function(t,e){a(t.length>=4,"Polygons require some verts"),a("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),a(se(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,r=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(r),this.tPlanes=new Array(r);for(var s=0;i>s;s+=2){var n=t[s]+e.x,o=t[s+1]+e.y,h=t[(s+2)%i]+e.x,l=t[(s+3)%i]+e.y,u=N(I(new _(h-n,l-o)));this.verts[s]=n,this.verts[s+1]=o,this.planes[s>>1]=new oe(u,S(u.x,u.y,n,o)),this.tPlanes[s>>1]=new oe(new _(0,0),0)}},s.BoxShape=function(t,e,i){var r=e/2,s=i/2;return ae(t,new Y(-r,-s,r,s))};var ae=s.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new ne(t,i,T)};ne.prototype.transformVerts=function(t,e){for(var i=this.verts,r=this.tVerts,s=1/0,a=-1/0,h=1/0,l=-1/0,u=0;u<i.length;u+=2){var c=i[u],p=i[u+1],d=t.x+c*e.x-p*e.y,f=t.y+c*e.y+p*e.x;r[u]=d,r[u+1]=f,s=n(s,d),a=o(a,d),h=n(h,f),l=o(l,f)}this.bb_l=s,this.bb_b=h,this.bb_r=a,this.bb_t=l},ne.prototype.transformAxes=function(t,e){for(var i=this.planes,r=this.tPlanes,s=0;s<i.length;s++){var n=F(i[s].n,e);r[s].n=n,r[s].d=w(t,n)+i[s].d}},ne.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},ne.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,r=i[i.length-2],s=i[i.length-1],n=1/0,o=T,a=!1,h=0;h<e.length;h++){e[h].compare(t)>0&&(a=!0);var l=i[2*h],u=i[2*h+1],c=f(t.x,t.y,r,s,l,u),p=z(t,c);n>p&&(n=p,o=c),r=l,s=u}return new Z(this,o,a?n:-n)},ne.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,r=this.tVerts,s=i.length,n=2*s,o=0;s>o;o++){var a=i[o].n,h=w(t,a);if(!(i[o].d>h)){var l=w(e,a),u=(i[o].d-h)/(l-h);if(!(0>u||u>1)){var c=G(t,e,u),p=-M(a,c),d=-O(a.x,a.y,r[2*o],r[2*o+1]),f=-O(a.x,a.y,r[(2*o+2)%n],r[(2*o+3)%n]);if(p>=d&&f>=p)return new te(this,u,a)}}}},ne.prototype.valueOnAxis=function(t,e){for(var i=this.tVerts,r=S(t.x,t.y,i[0],i[1]),s=2;s<i.length;s+=2)r=n(r,S(t.x,t.y,i[s],i[s+1]));return r-e},ne.prototype.containsVert=function(t,e){for(var i=this.tPlanes,r=0;r<i.length;r++){var s=i[r].n,n=S(s.x,s.y,t,e)-i[r].d;if(n>0)return!1}return!0},ne.prototype.containsVertPartial=function(t,e,i){for(var r=this.tPlanes,s=0;s<r.length;s++){var n=r[s].n;if(!(w(n,i)<0)){var o=S(n.x,n.y,t,e)-r[s].d;if(o>0)return!1}}return!0},ne.prototype.getNumVerts=function(){return this.verts.length/2},ne.prototype.getVert=function(t){return new _(this.verts[2*t],this.verts[2*t+1])};var he=s.Body=function(t,e){this.p=new _(0,0),this.vx=this.vy=0,this.f=new _(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new _(0,0),this.setAngle(0)};if("undefined"!=typeof DEBUG&&DEBUG){var le=function(t,e){a(t.x==t.x&&t.y==t.y,e)},ue=function(t,e){a(1/0!==Math.abs(t.x)&&1/0!==Math.abs(t.y),e)},ce=function(t,e){le(t,e),ue(t,e)};he.prototype.sanityCheck=function(){a(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),a(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),ce(this.p,"Body's position is invalid."),ce(this.f,"Body's force is invalid."),a(this.vx===this.vx&&1/0!==Math.abs(this.vx),"Body's velocity is invalid."),a(this.vy===this.vy&&1/0!==Math.abs(this.vy),"Body's velocity is invalid."),a(this.a===this.a&&1/0!==Math.abs(this.a),"Body's angle is invalid."),a(this.w===this.w&&1/0!==Math.abs(this.w),"Body's angular velocity is invalid."),a(this.t===this.t&&1/0!==Math.abs(this.t),"Body's torque is invalid."),ce(this.rot,"Body's rotation vector is invalid."),a(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),a(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else he.prototype.sanityCheck=function(){};he.prototype.getPos=function(){return this.p},he.prototype.getVel=function(){return new _(this.vx,this.vy)},he.prototype.getAngVel=function(){return this.w},he.prototype.isSleeping=function(){return null!==this.nodeRoot},he.prototype.isStatic=function(){return 1/0===this.nodeIdleTime},he.prototype.isRogue=function(){return null===this.space},he.prototype.setMass=function(t){a(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},he.prototype.setMoment=function(t){a(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},he.prototype.addShape=function(t){this.shapeList.push(t)},he.prototype.removeShape=function(t){p(this.shapeList,t)};var pe=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=pe(t.next_a,e,i):t.next_b=pe(t.next_b,e,i),t)};he.prototype.removeConstraint=function(t){this.constraintList=pe(this.constraintList,this,t)},he.prototype.setPos=function(t){this.activate(),this.sanityCheck(),t===T&&(t=s.v(0,0)),this.p=t},he.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},he.prototype.setAngVel=function(t){this.activate(),this.w=t},he.prototype.setAngleInternal=function(t){a(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},he.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},he.prototype.velocity_func=function(t,e,i){var r=this.vx*e+(t.x+this.f.x*this.m_inv)*i,s=this.vy*e+(t.y+this.f.y*this.m_inv)*i,n=this.v_limit,o=r*r+s*s,a=o>n*n?n/Math.sqrt(o):1;this.vx=r*a,this.vy=s*a;var h=this.w_limit;this.w=b(this.w*e+this.t*this.i_inv*i,-h,h),this.sanityCheck()},he.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},he.prototype.resetForces=function(){this.activate(),this.f=new _(0,0),this.t=0},he.prototype.applyForce=function(t,e){this.activate(),this.f=C(this.f,t),this.t+=M(e,t)},he.prototype.applyImpulse=function(t,e){this.activate(),fi(this,t.x,t.y,e)},he.prototype.getVelAtPoint=function(t){return C(new _(this.vx,this.vy),P(I(t),this.w))},he.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(R(t,this.p))},he.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(F(t,this.rot))},he.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;i>e;e++)t(this.shapeList[e])},he.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},he.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},he.prototype.local2World=function(t){return C(this.p,F(t,this.rot))},he.prototype.world2Local=function(t){return j(R(t,this.p),this.rot)},he.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var de=s.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};de.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new Y(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var fe=s.BBTree=function(t){de.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};fe.prototype=Object.create(de.prototype);var me=0,ve=function(t,e,i){this.obj=null,this.bb_l=n(e.bb_l,i.bb_l),this.bb_b=n(e.bb_b,i.bb_b),this.bb_r=o(e.bb_r,i.bb_r),this.bb_t=o(e.bb_t,i.bb_t),this.parent=null,this.setA(e),this.setB(i)};fe.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(me++,new ve(this,t,e))};var ye=0,ge=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,ye++};fe.prototype.getBB=function(t,e){var i=this.velocityFunc;if(i){var r=.1,s=(t.bb_r-t.bb_l)*r,a=(t.bb_t-t.bb_b)*r,h=P(i(t),.1);e.bb_l=t.bb_l+n(-s,h.x),e.bb_b=t.bb_b+n(-a,h.y),e.bb_r=t.bb_r+o(s,h.x),e.bb_t=t.bb_t+o(a,h.y)}else e.bb_l=t.bb_l,e.bb_b=t.bb_b,e.bb_r=t.bb_r,e.bb_t=t.bb_t},fe.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},fe.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var be=0,xe=function(t,e,i,r){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=r};fe.prototype.makePair=function(t,e,i,r){var s=this.pooledPairs;return s?(this.pooledPairs=s.prevA,s.prevA=null,s.leafA=t,s.nextA=e,s.prevB=null,s.leafB=i,s.nextB=r,s):(be++,new xe(t,e,i,r))},xe.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var _e=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};ge.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,_e(i.prevB,i.leafB,i.nextB)):(e=i.nextB,_e(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var Te=function(t,e,i){var r=t.pairs,s=e.pairs,n=i.makePair(t,r,e,s);t.pairs=e.pairs=n,r&&(r.leafA===t?r.prevA=n:r.prevB=n),s&&(s.leafA===e?s.prevA=n:s.prevB=n)};ve.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},ge.prototype.recycle=function(){},ve.prototype.setA=function(t){this.A=t,t.parent=this},ve.prototype.setB=function(t){this.B=t,t.parent=this},ge.prototype.isLeaf=!0,ve.prototype.isLeaf=!1,ve.prototype.otherChild=function(t){return this.A==t?this.B:this.A},ve.prototype.replaceChild=function(t,e,i){h(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(i),this.setA(e)):(this.B.recycle(i),this.setB(e));for(var r=this;r;r=r.parent){var s=r.A,a=r.B;r.bb_l=n(s.bb_l,a.bb_l),r.bb_b=n(s.bb_b,a.bb_b),r.bb_r=o(s.bb_r,a.bb_r),r.bb_t=o(s.bb_t,a.bb_t)}},ve.prototype.bbArea=ge.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var we=function(t,e){return(o(t.bb_r,e.bb_r)-n(t.bb_l,e.bb_l))*(o(t.bb_t,e.bb_t)-n(t.bb_b,e.bb_b))},Se=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},Ae=function(t,e,i){if(null==t)return e;if(t.isLeaf)return i.makeNode(e,t);var r=t.B.bbArea()+we(t.A,e),s=t.A.bbArea()+we(t.B,e);return r===s&&(r=Se(t.A,e),s=Se(t.B,e)),r>s?t.setB(Ae(t.B,e,i)):t.setA(Ae(t.A,e,i)),t.bb_l=n(t.bb_l,e.bb_l),t.bb_b=n(t.bb_b,e.bb_b),t.bb_r=o(t.bb_r,e.bb_r),t.bb_t=o(t.bb_t,e.bb_t),t};ve.prototype.intersectsBB=ge.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var Ee=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(Ee(t.A,e,i),Ee(t.B,e,i)))},Ce=function(t,e,i){var r=1/(i.x-e.x),s=t.bb_l==e.x?-1/0:(t.bb_l-e.x)*r,a=t.bb_r==e.x?1/0:(t.bb_r-e.x)*r,h=n(s,a),l=o(s,a),u=1/(i.y-e.y),c=t.bb_b==e.y?-1/0:(t.bb_b-e.y)*u,p=t.bb_t==e.y?1/0:(t.bb_t-e.y)*u,d=n(c,p),f=o(c,p);if(l>=d&&f>=h){var m=o(h,d),v=n(l,f);if(v>=0&&1>=m)return o(m,0)}return 1/0},Re=function(t,e,i,r,s){if(t.isLeaf)return s(t.obj);var o=Ce(t.A,e,i),a=Ce(t.B,e,i);return a>o?(r>o&&(r=n(r,Re(t.A,e,i,r,s))),r>a&&(r=n(r,Re(t.B,e,i,r,s)))):(r>a&&(r=n(r,Re(t.B,e,i,r,s))),r>o&&(r=n(r,Re(t.A,e,i,r,s)))),r};fe.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var Le=function(t,e,i){if(e==t)return null;var r=e.parent;if(r==t){var s=t.otherChild(e);return s.parent=t.parent,t.recycle(i),s}return r.parent.replaceChild(r,r.otherChild(e),i),t},Pe=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};ge.prototype.markLeafQuery=function(t,e,i,r){Pe(t,this)&&(e?Te(t,this,i):(this.stamp<t.stamp&&Te(this,t,i),r&&r(t.obj,this.obj)))},ve.prototype.markLeafQuery=function(t,e,i,r){Pe(t,this)&&(this.A.markLeafQuery(t,e,i,r),this.B.markLeafQuery(t,e,i,r))},ge.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var r=this;r.parent;r=r.parent)r==r.parent.A?r.parent.B.markLeafQuery(this,!0,t,i):r.parent.A.markLeafQuery(this,!1,t,i)}else for(var s=this.pairs;s;)this===s.leafB?(i&&i(s.leafA.obj,this.obj),s=s.nextB):s=s.nextA},ve.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},ge.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},ge.prototype.update=function(t){var e=t.root,i=this.obj;return this.containsObj(i)?!1:(t.getBB(this.obj,this),e=Le(e,this,t),t.root=Ae(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},ge.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;i&&i.markLeafQuery(this,!0,e,null)}else{var r=t.staticIndex.root;this.markSubtree(t,r,null)}},fe.prototype.insert=function(t,e){var i=new ge(this,t);this.leaves[e]=i,this.root=Ae(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},fe.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=Le(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},fe.prototype.contains=function(t,e){return null!=this.leaves[e]};var Me=function(){};fe.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var r=this.staticIndex,s=r&&r.root;this.root.markSubtree(this,s,t),r&&!s&&this.collideStatic(this,r,t),this.incrementStamp()}},fe.prototype.reindex=function(){this.reindexQuery(Me)},fe.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},fe.prototype.pointQuery=function(t,e){this.query(new Y(t.x,t.y,t.x,t.y),e)},fe.prototype.segmentQuery=function(t,e,i,r){this.root&&Re(this.root,t,e,i,r)},fe.prototype.query=function(t,e){this.root&&Ee(this.root,t,e)},fe.prototype.count=function(){return this.count},fe.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var Oe=function(t,e,i,r,s){return(o(t.bb_r,r)-n(t.bb_l,e))*(o(t.bb_t,s)-n(t.bb_b,i))},Ie=function(t,e,i,r){if(1==r)return e[i];if(2==r)return t.makeNode(e[i],e[i+1]);for(var s=e[i],a=s.bb_l,h=s.bb_b,l=s.bb_r,u=s.bb_t,c=i+r,p=i+1;c>p;p++)s=e[p],a=n(a,s.bb_l),h=n(h,s.bb_b),l=o(l,s.bb_r),u=o(u,s.bb_t);var d=l-a>u-h,f=new Array(2*r);if(d)for(var p=i;c>p;p++)f[2*p+0]=e[p].bb_l,f[2*p+1]=e[p].bb_r;else for(var p=i;c>p;p++)f[2*p+0]=e[p].bb_b,f[2*p+1]=e[p].bb_t;f.sort(function(t,e){return t-e});var m=.5*(f[r-1]+f[r]),v=a,y=h,g=l,b=u,x=a,_=h,T=l,w=u;d?g=x=m:b=_=m;for(var S=c,A=i;S>A;){var s=e[A];Oe(s,x,_,T,w)<Oe(s,v,y,g,b)?(S--,e[A]=e[S],e[S]=s):A++}if(S==r){for(var s=null,p=i;c>p;p++)s=Ae(s,e[p],t);return s}return NodeNew(t,Ie(t,e,i,S-i),Ie(t,e,S,c-S))};fe.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Ie(tree,t,t.length)};var Be=function(t,e){!t.isLeaf&&10>=e&&(Be(t.A,e+1),Be(t.B,e+1));for(var i="",r=0;e>r;r++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};fe.prototype.log=function(){this.root&&Be(this.root,0)};var Fe=s.CollisionHandler=function(){this.a=this.b=0};Fe.prototype.begin=function(){return!0},Fe.prototype.preSolve=function(){return!0},Fe.prototype.postSolve=function(){},Fe.prototype.separate=function(){};var je=function(t,e){this.e=0,this.u=0,this.surface_vr=T,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};je.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},je.prototype.totalImpulse=function(){for(var t=this.contacts,e=new _(0,0),i=0,r=t.length;r>i;i++){var s=t[i];e.add(P(s.n,s.jnAcc))}return this.swappedColl?e:e.neg()},je.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new _(0,0),i=0,r=t.length;r>i;i++){var s=t[i];e.add(new _(s.jnAcc,s.jtAcc).rotate(s.n))}return this.swappedColl?e:e.neg()},je.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,r=0,s=i.length;s>r;r++){var n=i[r],o=n.jnAcc,a=n.jtAcc;e+=t*o*o/n.nMass+a*a/n.tMass}return e},je.prototype.ignore=function(){this.state="ignore"},je.prototype.getA=function(){return this.swappedColl?this.b:this.a},je.prototype.getB=function(){return this.swappedColl?this.a:this.b},je.prototype.isFirstContact=function(){return"first coll"===this.state};var ke=function(t,e,i){this.point=t,this.normal=e,this.dist=i};je.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new ke(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},je.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?L(e):e},je.prototype.getPoint=function(t){return this.contacts[t].p},je.prototype.getDepth=function(t){return this.contacts[t].dist};var De=function(t,e,i,r){i?i.body_a===e?i.thread_a_next=r:i.thread_b_next=r:e.arbiterList=r,r&&(r.body_a===e?r.thread_a_prev=i:r.thread_b_prev=i)};je.prototype.unthread=function(){De(this,this.body_a,this.thread_a_prev,this.thread_a_next),De(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},je.prototype.update=function(t,e,i,r){if(this.contacts)for(var s=0;s<this.contacts.length;s++)for(var n=this.contacts[s],o=0;o<t.length;o++){var a=t[o];a.hash===n.hash&&(a.jnAcc=n.jnAcc,a.jtAcc=n.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*r.e,this.u=i.u*r.u,this.surface_vr=R(i.surface_v,r.surface_v),this.a=i,this.body_a=i.body,this.b=r,this.body_b=r.body,"cached"==this.state&&(this.state="first coll")},je.prototype.preStep=function(t,e,i){for(var r=this.body_a,s=this.body_b,o=0;o<this.contacts.length;o++){var a=this.contacts[o];a.r1=R(a.p,r.p),a.r2=R(a.p,s.p),a.nMass=1/gi(r,s,a.r1,a.r2,a.n),a.tMass=1/gi(r,s,a.r1,a.r2,I(a.n)),a.bias=-i*n(0,a.dist+e)/t,a.jBias=0,a.bounce=di(r,s,a.r1,a.r2,a.n)*this.e}},je.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,r=0;r<this.contacts.length;r++){var s=this.contacts[r],n=s.n.x,o=s.n.y,a=n*s.jnAcc-o*s.jtAcc,h=n*s.jtAcc+o*s.jnAcc;mi(e,i,s.r1,s.r2,a*t,h*t)}};var Ge=0,Ne=0;je.prototype.applyImpulse=function(){Ge++;for(var t=this.body_a,e=this.body_b,i=this.surface_vr,r=this.u,s=0;s<this.contacts.length;s++){Ne++;var n=this.contacts[s],a=n.nMass,h=n.n,l=n.r1,u=n.r2,c=e.vx-u.y*e.w-(t.vx-l.y*t.w),p=e.vy+u.x*e.w-(t.vy+l.x*t.w),d=h.x*(e.v_biasx-u.y*e.w_bias-t.v_biasx+l.y*t.w_bias)+h.y*(u.x*e.w_bias+e.v_biasy-l.x*t.w_bias-t.v_biasy),f=S(c,p,h.x,h.y),m=S(c+i.x,p+i.y,-h.y,h.x),v=(n.bias-d)*a,y=n.jBias;n.jBias=o(y+v,0);var g=-(n.bounce+f)*a,x=n.jnAcc;n.jnAcc=o(x+g,0);var _=r*n.jnAcc,T=-m*n.tMass,w=n.jtAcc;n.jtAcc=b(w+T,-_,_);var A=h.x*(n.jBias-y),E=h.y*(n.jBias-y);vi(t,-A,-E,l),vi(e,A,E,u);var C=n.jnAcc-x,R=n.jtAcc-w;mi(t,e,l,u,h.x*C-h.y*R,h.x*R+h.y*C)}},je.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},je.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Ue=0,We=function(t,e,i,r){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=T,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=r,Ue++},ze=[],Ve=function(t,e,i,r){var s=i+r,n=R(e,t),o=k(n);if(!(o>=s*s)){var a=Math.sqrt(o);return new We(C(t,P(n,.5+(i-.5*s)/(a?a:1/0))),a?P(n,1/a):new _(1,0),a-s,0)}},Xe=function(t,e){var i=Ve(t.tc,e.tc,t.r,e.r);return i?[i]:ze},qe=function(t,e){var i=e.ta,r=e.tb,s=t.tc,n=R(r,i),o=x(w(n,R(s,i))/k(n)),a=C(i,P(n,o)),h=Ve(s,a,t.r,e.r);if(h){var l=h.n;return 0===o&&w(l,e.a_tangent)<0||1===o&&w(l,e.b_tangent)<0?ze:[h]}return ze},Ye=0,He=function(t,e){var i=0,r=t.valueOnAxis(e[0].n,e[0].d);if(r>0)return-1;for(var s=1;s<e.length;s++){var n=t.valueOnAxis(e[s].n,e[s].d);if(n>0)return-1;n>r&&(r=n,i=s)}return Ye=r,i},Je=function(t,e,i,r){for(var s=[],n=t.tVerts,o=0;o<n.length;o+=2){var a=n[o],h=n[o+1];e.containsVertPartial(a,h,L(i))&&s.push(new We(new _(a,h),i,r,c(t.hashid,o)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],h=l[o+1];t.containsVertPartial(a,h,i)&&s.push(new We(new _(a,h),i,r,c(e.hashid,o)))}return s},Ke=function(t,e,i,r){for(var s=[],n=t.tVerts,o=0;o<n.length;o+=2){var a=n[o],h=n[o+1];e.containsVert(a,h)&&s.push(new We(new _(a,h),i,r,c(t.hashid,o>>1)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],h=l[o+1];t.containsVert(a,h)&&s.push(new We(new _(a,h),i,r,c(e.hashid,o>>1)))}return s.length?s:Je(t,e,i,r)},Qe=function(t,e){var i=He(e,t.tPlanes);if(-1==i)return ze;var r=Ye,s=He(t,e.tPlanes);if(-1==s)return ze;var n=Ye;return r>n?Ke(t,e,t.tPlanes[i].n,r):Ke(t,e,L(e.tPlanes[s].n),n)},$e=function(t,e,i){var r=w(e,t.ta)-t.r,s=w(e,t.tb)-t.r;return n(r,s)-i},Ze=function(t,e,i,r,s){for(var n=M(e.tn,e.ta),o=M(e.tn,e.tb),a=P(e.tn,s),h=i.tVerts,l=0;l<h.length;l+=2){var u=h[l],p=h[l+1];if(S(u,p,a.x,a.y)<w(e.tn,e.ta)*s+e.r){var d=O(e.tn.x,e.tn.y,u,p);n>=d&&d>=o&&t.push(new We(new _(u,p),a,r,c(i.hashid,l)))}}},ti=function(t,e){var i=[],r=e.tPlanes,s=r.length,n=w(t.tn,t.ta),o=e.valueOnAxis(t.tn,n)-t.r,a=e.valueOnAxis(L(t.tn),-n)-t.r;if(a>0||o>0)return ze;var h=0,l=$e(t,r[0].n,r[0].d);if(l>0)return ze;for(var u=0;s>u;u++){var p=$e(t,r[u].n,r[u].d);if(p>0)return ze;p>l&&(l=p,h=u)}var d=L(r[h].n),f=C(t.ta,P(d,t.r)),m=C(t.tb,P(d,t.r));if(e.containsVert(f.x,f.y)&&i.push(new We(f,d,l,c(t.hashid,0))),e.containsVert(m.x,m.y)&&i.push(new We(m,d,l,c(t.hashid,1))),(o>=l||a>=l)&&(o>a?Ze(i,t,e,o,1):Ze(i,t,e,a,-1)),0===i.length){var v,y=2*h,g=e.tVerts,b=new _(g[y],g[y+1]);if(v=Ve(t.ta,b,t.r,0,i))return[v];if(v=Ve(t.tb,b,t.r,0,i))return[v];var x=2*s,T=new _(g[(y+2)%x],g[(y+3)%x]);if(v=Ve(t.ta,T,t.r,0,i))return[v];if(v=Ve(t.tb,T,t.r,0,i))return[v]}return i},ei=function(t,e){for(var i=e.tPlanes,r=0,s=w(i[0].n,t.tc)-i[0].d-t.r,n=0;n<i.length;n++){var o=w(i[n].n,t.tc)-i[n].d-t.r;if(o>0)return ze;o>s&&(s=o,r=n)}var a=i[r].n,h=e.tVerts,l=h.length,u=r<<1,c=h[u],p=h[u+1],d=h[(u+2)%l],f=h[(u+3)%l],m=O(a.x,a.y,c,p),v=O(a.x,a.y,d,f),y=M(a,t.tc);if(v>y){var g=Ve(t.tc,new _(d,f),t.r,0,g);return g?[g]:ze}if(m>y)return[new We(R(t.tc,P(a,t.r+s/2)),L(a),s,0)];var g=Ve(t.tc,new _(c,p),t.r,0,g);return g?[g]:ze};ee.prototype.collisionCode=0,re.prototype.collisionCode=1,ne.prototype.collisionCode=2,ee.prototype.collisionTable=[Xe,qe,ei],re.prototype.collisionTable=[null,function(){return ze},ti],ne.prototype.collisionTable=[null,null,Qe];var ii=s.collideShapes=function(t,e){return a(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},ri=new Fe,si=s.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new fe(null),this.activeShapes=new fe(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=ri,this.postStepCallbacks=[],this.iterations=10,this.gravity=T,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new he(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};si.prototype.getCurrentTimeStep=function(){return this.curr_dt},si.prototype.setIterations=function(t){this.iterations=t},si.prototype.isLocked=function(){return this.locked};var ni=function(t){a(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};si.prototype.addCollisionHandler=function(t,e,i,r,s,n){ni(this),this.removeCollisionHandler(t,e);var o=new Fe;o.a=t,o.b=e,i&&(o.begin=i),r&&(o.preSolve=r),s&&(o.postSolve=s),n&&(o.separate=n),this.collisionHandlers[c(t,e)]=o},si.prototype.removeCollisionHandler=function(t,e){ni(this),delete this.collisionHandlers[c(t,e)]},si.prototype.setDefaultCollisionHandler=function(t,e,i,r){ni(this);var s=new Fe;t&&(s.begin=t),e&&(s.preSolve=e),i&&(s.postSolve=i),r&&(s.separate=r),this.defaultHandler=s},si.prototype.lookupHandler=function(t,e){return this.collisionHandlers[c(t,e)]||this.defaultHandler},si.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(a(!t.space,"This shape is already added to a space and cannot be added to another."),ni(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},si.prototype.addStaticShape=function(t){a(!t.space,"This shape is already added to a space and cannot be added to another."),ni(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},si.prototype.addBody=function(t){return a(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),a(!t.space,"This body is already added to a space and cannot be added to another."),ni(this),this.bodies.push(t),t.space=this,t
},si.prototype.addConstraint=function(t){a(!t.space,"This shape is already added to a space and cannot be added to another."),ni(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},si.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var r=this.cachedArbiters[i];(t===r.body_a&&(e===r.a||null===e)||t===r.body_b&&(e===r.b||null===e))&&(e&&"cached"!==r.state&&r.callSeparate(this),r.unthread(),p(this.arbiters,r),delete this.cachedArbiters[i])}},si.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):(a(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),ni(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},si.prototype.removeStaticShape=function(t){a(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),ni(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},si.prototype.removeBody=function(t){a(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),ni(this),t.activate(),p(this.bodies,t),t.space=null},si.prototype.removeConstraint=function(t){a(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),ni(this),t.a.activate(),t.b.activate(),p(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},si.prototype.containsShape=function(t){return t.space===this},si.prototype.containsBody=function(t){return t.space==this},si.prototype.containsConstraint=function(t){return t.space==this},si.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[c(t.a.hashid,t.b.hashid)],p(this.arbiters,t)},si.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var r=this.sleepingComponents,i=0;i<r.length;i++)for(var s=r[i],n=s;n;){var o=n.nodeNext;t(n),n=o}this.unlock(!0)},si.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},si.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},si.prototype.reindexStatic=function(){a(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},si.prototype.reindexShape=function(t){a(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},si.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},si.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},si.prototype.activateBody=function(t){if(a(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)-1===this.rousedBodies.indexOf(t)&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var s=r.body_a;if(t===s||s.isStatic()){var n=r.a,o=r.b;this.cachedArbiters[c(n.hashid,o.hashid)]=r,r.stamp=this.stamp,r.handler=this.lookupHandler(n.collision_type,o.collision_type),this.arbiters.push(r)}}for(var h=t.constraintList;h;h=h.nodeNext){var s=h.a;(t===s||s.isStatic())&&this.constraints.push(h)}}},si.prototype.deactivateBody=function(t){a(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),p(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var s=r.body_a;(t===s||s.isStatic())&&this.uncacheArbiter(r)}for(var n=t.constraintList;n;n=n.nodeNext){var s=n.a;(t===s||s.isStatic())&&p(this.constraints,n)}};var oi=function(t){return t?t.nodeRoot:null},ai=function(t){if(t&&t.isSleeping(t)){a(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var r=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=r}p(e.sleepingComponents,t)}};he.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,ai(oi(this)))},he.prototype.activateStatic=function(t){a(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},he.prototype.pushArbiter=function(t){h(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),h(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;h(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var hi=function(t,e){e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e)},li=function(t,e){if(!e.isRogue()){var i=oi(e);if(null==i){hi(t,e);for(var r=e.arbiterList;r;r=r.next(e))li(t,e==r.body_a?r.body_b:r.body_a);for(var s=e.constraintList;s;s=s.next(e))li(t,e==s.a?s.b:s.a)}else h(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},ui=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};si.prototype.processComponents=function(t){for(var e=1/0!==this.sleepTimeThreshold,i=this.bodies,r=0;r<i.length;r++){var s=i[r];h(null===s.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),h(null===s.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var n=this.idleSpeedThreshold,o=n?n*n:k(this.gravity)*t*t,r=0;r<i.length;r++){var s=i[r],a=o?s.m*o:0;s.nodeIdleTime=s.kineticEnergy()>a?0:s.nodeIdleTime+t}for(var l=this.arbiters,r=0,u=l.length;u>r;r++){var c=l[r],p=c.body_a,d=c.body_b;e&&((d.isRogue()&&!d.isStatic()||p.isSleeping())&&p.activate(),(p.isRogue()&&!p.isStatic()||d.isSleeping())&&d.activate()),p.pushArbiter(c),d.pushArbiter(c)}if(e){for(var f=this.constraints,r=0;r<f.length;r++){var m=f[r],p=m.a,d=m.b;d.isRogue()&&!d.isStatic()&&p.activate(),p.isRogue()&&!p.isStatic()&&d.activate()}for(var r=0;r<i.length;){var s=i[r];if(null!==oi(s)||(li(s,s),ui(s,this.sleepTimeThreshold)))r++,s.nodeRoot=null,s.nodeNext=null;else{this.sleepingComponents.push(s);for(var v=s;v;v=v.nodeNext)this.deactivateBody(v)}}}},he.prototype.sleep=function(){this.sleepWithGroup(null)},he.prototype.sleepWithGroup=function(t){a(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(a(e,"Cannot put a rogue body to sleep."),a(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),a(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return a(oi(this)===oi(t),"The body is already sleeping and it's group cannot be reassigned."),void 0;for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);if(e.deactivateBody(this),t){var r=oi(t);this.nodeRoot=r,this.nodeNext=r.nodeNext,this.nodeIdleTime=0,r.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);p(e.bodies,this)},si.prototype.activateShapesTouchingShape=function(t){1/0!==this.sleepTimeThreshold&&this.shapeQuery(t,function(t){t.body.activate()})},si.prototype.pointQuery=function(t,e,i,r){var s=function(s){(!s.group||i!==s.group)&&e&s.layers&&s.pointQuery(t)&&r(s)},n=new Y(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(n,s),this.staticShapes.query(n,s),this.unlock(!0)},si.prototype.pointQueryFirst=function(t,e,i){var r=null;return this.pointQuery(t,e,i,function(t){t.sensor||(r=t)}),r},si.prototype.nearestPointQuery=function(t,e,i,r,s){var n=function(n){if((!n.group||r!==n.group)&&i&n.layers){var o=n.nearestPointQuery(t);o.d<e&&s(n,o.d,o.p)}},o=H(t,e);this.lock(),this.activeShapes.query(o,n),this.staticShapes.query(o,n),this.unlock(!0)},si.prototype.nearestPointQueryNearest=function(t,e,i,r){var s,n=function(n){if((!n.group||r!==n.group)&&i&n.layers&&!n.sensor){var o=n.nearestPointQuery(t);o.d<e&&(!s||o.d<s.d)&&(s=o)}},o=H(t,e);return this.activeShapes.query(o,n),this.staticShapes.query(o,n),s},si.prototype.segmentQuery=function(t,e,i,r,s){var n=function(n){var o;return(!n.group||r!==n.group)&&i&n.layers&&(o=n.segmentQuery(t,e))&&s(n,o.t,o.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,n),this.activeShapes.segmentQuery(t,e,1,n),this.unlock(!0)},si.prototype.segmentQueryFirst=function(t,e,i,r){var s=null,n=function(n){var o;return(!n.group||r!==n.group)&&i&n.layers&&!n.sensor&&(o=n.segmentQuery(t,e))&&(null===s||o.t<s.t)&&(s=o),s?s.t:1};return this.staticShapes.segmentQuery(t,e,1,n),this.activeShapes.segmentQuery(t,e,s?s.t:1,n),s},si.prototype.bbQuery=function(t,e,i,r){var s=function(s){(!s.group||i!==s.group)&&e&s.layers&&J(t,s.bb_l,s.bb_b,s.bb_r,s.bb_t)&&r(s)};this.lock(),this.activeShapes.query(t,s),this.staticShapes.query(t,s),this.unlock(!0)},si.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var r=new Y(t.bb_l,t.bb_b,t.bb_r,t.bb_t),s=!1,n=function(i){var r=t;if((!r.group||r.group!==i.group)&&r.layers&i.layers&&r!==i){var n;if(r.collisionCode<=i.collisionCode)n=ii(r,i);else{n=ii(i,r);for(var o=0;o<n.length;o++)n[o].n=L(n[o].n)}if(n.length&&(s=!(r.sensor||i.sensor),e)){for(var a=new Array(n.length),o=0;o<n.length;o++)a[o]=new ke(n[o].p,n[o].n,n[o].dist);e(i,a)}}};return this.lock(),this.activeShapes.query(r,n),this.staticShapes.query(r,n),this.unlock(!0),s},si.prototype.addPostStepCallback=function(t){h(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},si.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},si.prototype.lock=function(){this.locked++},si.prototype.unlock=function(t){if(this.locked--,a(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},si.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var r=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var s=r.lookupHandler(e.collision_type,i.collision_type),n=e.sensor||i.sensor;if(!n||s!==ri){if(e.collisionCode>i.collisionCode){var o=e;e=i,i=o}var a=ii(e,i);if(0!==a.length){var h=c(e.hashid,i.hashid),l=r.cachedArbiters[h];l||(l=r.cachedArbiters[h]=new je(e,i)),l.update(a,s,e,i),"first coll"!=l.state||s.begin(l,r)||l.ignore(),"ignore"!==l.state&&s.preSolve(l,r)&&!n?r.arbiters.push(l):(l.contacts=null,"ignore"!==l.state&&(l.state="normal")),l.stamp=r.stamp}}}}},si.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,r=t.body_b;return(i.isStatic()||i.isSleeping())&&(r.isStatic()||r.isSleeping())?!0:(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),e>=this.collisionPersistence?(t.contacts=null,!1):!0)};var ci=function(t){var e=t.body;t.update(e.p,e.rot)};si.prototype.step=function(t){if(0!==t){a(0===T.x&&0===T.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,r,s,n=this.bodies,o=this.constraints,h=this.arbiters;for(i=0;i<h.length;i++){var l=h[i];l.state="normal",l.body_a.isSleeping()||l.body_b.isSleeping()||l.unthread()}for(h.length=0,this.lock(),i=0;i<n.length;i++)n[i].position_func(t);this.activeShapes.each(ci),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(s in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[s])||delete this.cachedArbiters[s];var u=this.collisionSlop,c=1-Math.pow(this.collisionBias,t);for(i=0;i<h.length;i++)h[i].preStep(t,u,c);for(i=0;i<o.length;i++){var p=o[i];p.preSolve(this),p.preStep(t)}var d=Math.pow(this.damping,t),f=this.gravity;for(i=0;i<n.length;i++)n[i].velocity_func(f,d,t);var m=0===e?0:t/e;for(i=0;i<h.length;i++)h[i].applyCachedImpulse(m);for(i=0;i<o.length;i++)o[i].applyCachedImpulse(m);for(i=0;i<this.iterations;i++){for(r=0;r<h.length;r++)h[r].applyImpulse();for(r=0;r<o.length;r++)o[r].applyImpulse()}for(i=0;i<o.length;i++)o[i].postSolve(this);for(i=0;i<h.length;i++)h[i].handler.postSolve(h[i],this);this.unlock(!0)}};var pi=function(t,e,i,r){var s=t.vx+-i.y*t.w,n=t.vy+i.x*t.w,o=e.vx+-r.y*e.w,a=e.vy+r.x*e.w;return new _(o-s,a-n)},di=function(t,e,i,r,s){var n=t.vx+-i.y*t.w,o=t.vy+i.x*t.w,a=e.vx+-r.y*e.w,h=e.vy+r.x*e.w;return S(a-n,h-o,s.x,s.y)},fi=function(t,e,i,r){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(r.x*i-r.y*e)},mi=function(t,e,i,r,s,n){fi(t,-s,-n,i),fi(e,s,n,r)},vi=function(t,e,i,r){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*O(r.x,r.y,e,i)},yi=function(t,e,i){var r=M(e,i);return t.m_inv+t.i_inv*r*r},gi=function(t,e,i,r,s){var n=yi(t,i,s)+yi(e,r,s);return h(0!==n,"Unsolvable collision or constraint."),n},bi=function(t,e,i,r,s,n){var o,a,l,u,c=t.m_inv+e.m_inv;o=c,a=0,l=0,u=c;var p=t.i_inv,d=i.x*i.x*p,f=i.y*i.y*p,m=-i.x*i.y*p;o+=f,a+=m,l+=m,u+=d;var v=e.i_inv,y=r.x*r.x*v,g=r.y*r.y*v,b=-r.x*r.y*v;o+=g,a+=b,l+=b,u+=y;var x=o*u-a*l;h(0!==x,"Unsolvable constraint.");var _=1/x;s.x=u*_,s.y=-a*_,n.x=-l*_,n.y=o*_},xi=function(t,e,i){return new _(w(t,e),w(t,i))},_i=function(t,e){return 1-Math.pow(t,e)},Ti=s.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};Ti.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},Ti.prototype.preStep=function(){},Ti.prototype.applyCachedImpulse=function(){},Ti.prototype.applyImpulse=function(){},Ti.prototype.getImpulse=function(){return 0},Ti.prototype.preSolve=function(){},Ti.prototype.postSolve=function(){},Ti.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var wi=s.PinJoint=function(t,e,i,r){Ti.call(this,t,e),this.anchr1=i,this.anchr2=r;var s=t?C(t.p,F(i,t.rot)):i,n=e?C(e.p,F(r,e.rot)):r;this.dist=A(R(n,s)),h(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};wi.prototype=Object.create(Ti.prototype),wi.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=F(this.anchr1,e.rot),this.r2=F(this.anchr2,i.rot);var r=R(C(i.p,this.r2),C(e.p,this.r1)),s=A(r);this.n=P(r,1/(s?s:1/0)),this.nMass=1/gi(e,i,this.r1,this.r2,this.n);var n=this.maxBias;this.bias=b(-_i(this.errorBias,t)*(s-this.dist)/t,-n,n),this.jnMax=this.maxForce*t},wi.prototype.applyCachedImpulse=function(t){var e=P(this.n,this.jnAcc*t);mi(this.a,this.b,this.r1,this.r2,e.x,e.y)},wi.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,r=di(t,e,this.r1,this.r2,i),s=(this.bias-r)*this.nMass,n=this.jnAcc;this.jnAcc=b(n+s,-this.jnMax,this.jnMax),s=this.jnAcc-n,mi(t,e,this.r1,this.r2,i.x*s,i.y*s)},wi.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Si=s.SlideJoint=function(t,e,i,r,s,n){Ti.call(this,t,e),this.anchr1=i,this.anchr2=r,this.min=s,this.max=n,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Si.prototype=Object.create(Ti.prototype),Si.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=F(this.anchr1,e.rot),this.r2=F(this.anchr2,i.rot);var r=R(C(i.p,this.r2),C(e.p,this.r1)),s=A(r),n=0;s>this.max?(n=s-this.max,this.n=U(r)):s<this.min?(n=this.min-s,this.n=L(U(r))):(this.n=T,this.jnAcc=0),this.nMass=1/gi(e,i,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=b(-_i(this.errorBias,t)*n/t,-o,o),this.jnMax=this.maxForce*t},Si.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;mi(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},Si.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,r=this.r1,s=this.r2,n=pi(t,e,r,s),o=w(n,i),a=(this.bias-o)*this.nMass,h=this.jnAcc;this.jnAcc=b(h+a,-this.jnMax,0),a=this.jnAcc-h,mi(t,e,this.r1,this.r2,i.x*a,i.y*a)}},Si.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Ai=s.PivotJoint=function(t,e,i,r){if(Ti.call(this,t,e),"undefined"==typeof r){var s=i;i=t?t.world2Local(s):s,r=e?e.world2Local(s):s}this.anchr1=i,this.anchr2=r,this.r1=this.r2=T,this.k1=new _(0,0),this.k2=new _(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=T};Ai.prototype=Object.create(Ti.prototype),Ai.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=F(this.anchr1,e.rot),this.r2=F(this.anchr2,i.rot),bi(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var r=R(C(i.p,this.r2),C(e.p,this.r1));this.bias=W(P(r,-_i(this.errorBias,t)/t),this.maxBias)},Ai.prototype.applyCachedImpulse=function(t){mi(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ai.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,r=this.r2,s=pi(t,e,i,r),n=xi(R(this.bias,s),this.k1,this.k2),o=this.jAcc;this.jAcc=W(C(this.jAcc,n),this.jMaxLen),mi(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ai.prototype.getImpulse=function(){return A(this.jAcc)};var Ei=s.GrooveJoint=function(t,e,i,r,s){Ti.call(this,t,e),this.grv_a=i,this.grv_b=r,this.grv_n=I(N(R(r,i))),this.anchr2=s,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new _(0,0),this.k2=new _(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=null};Ei.prototype=Object.create(Ti.prototype),Ei.prototype.preStep=function(t){var e=this.a,i=this.b,r=e.local2World(this.grv_a),s=e.local2World(this.grv_b),n=F(this.grv_n,e.rot),o=w(r,n);this.grv_tn=n,this.r2=F(this.anchr2,i.rot);var a=M(C(i.p,this.r2),n);a<=M(r,n)?(this.clamp=1,this.r1=R(r,e.p)):a>=M(s,n)?(this.clamp=-1,this.r1=R(s,e.p)):(this.clamp=0,this.r1=R(C(P(I(n),-a),P(n,o)),e.p)),bi(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var h=R(C(i.p,this.r2),C(e.p,this.r1));this.bias=W(P(h,-_i(this.errorBias,t)/t),this.maxBias)},Ei.prototype.applyCachedImpulse=function(t){mi(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ei.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*M(t,e)>0?t:B(t,e);return W(i,this.jMaxLen)},Ei.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,r=this.r2,s=pi(t,e,i,r),n=xi(R(this.bias,s),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(C(o,n)),mi(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ei.prototype.getImpulse=function(){return A(this.jAcc)},Ei.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=I(N(R(this.grv_b,t))),this.activateBodies()},Ei.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=I(N(R(t,this.grv_a))),this.activateBodies()};var Ci=function(t,e){return(t.restLength-e)*t.stiffness},Ri=s.DampedSpring=function(t,e,i,r,s,n,o){Ti.call(this,t,e),this.anchr1=i,this.anchr2=r,this.restLength=s,this.stiffness=n,this.damping=o,this.springForceFunc=Ci,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};Ri.prototype=Object.create(Ti.prototype),Ri.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=F(this.anchr1,e.rot),this.r2=F(this.anchr2,i.rot);var r=R(C(i.p,this.r2),C(e.p,this.r1)),s=A(r);this.n=P(r,1/(s?s:1/0));var n=gi(e,i,this.r1,this.r2,this.n);h(0!==n,"Unsolvable this."),this.nMass=1/n,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*n);var o=this.springForceFunc(this,s);mi(e,i,this.r1,this.r2,this.n.x*o*t,this.n.y*o*t)},Ri.prototype.applyCachedImpulse=function(){},Ri.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,r=this.r1,s=this.r2,n=di(t,e,r,s,i),o=(this.target_vrn-n)*this.v_coef;this.target_vrn=n+o,o*=this.nMass,mi(t,e,this.r1,this.r2,this.n.x*o,this.n.y*o)},Ri.prototype.getImpulse=function(){return 0};var Li=function(t,e){return(e-t.restAngle)*t.stiffness},Pi=s.DampedRotarySpring=function(t,e,i,r,s){Ti.call(this,t,e),this.restAngle=i,this.stiffness=r,this.damping=s,this.springTorqueFunc=Li,this.target_wrn=0,this.w_coef=0,this.iSum=0};Pi.prototype=Object.create(Ti.prototype),Pi.prototype.preStep=function(t){var e=this.a,i=this.b,r=e.i_inv+i.i_inv;h(0!==r,"Unsolvable spring."),this.iSum=1/r,this.w_coef=1-Math.exp(-this.damping*t*r),this.target_wrn=0;var s=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=s*e.i_inv,i.w+=s*i.i_inv},Pi.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,r=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+r;var s=r*this.iSum;t.w+=s*t.i_inv,e.w-=s*e.i_inv};var Mi=s.RotaryLimitJoint=function(t,e,i,r){Ti.call(this,t,e),this.min=i,this.max=r,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Mi.prototype=Object.create(Ti.prototype),Mi.prototype.preStep=function(t){var e=this.a,i=this.b,r=i.a-e.a,s=0;r>this.max?s=this.max-r:r<this.min&&(s=this.min-r),this.iSum=1/(1/e.i+1/i.i);var n=this.maxBias;this.bias=b(-_i(this.errorBias,t)*s/t,-n,n),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Mi.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Mi.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,r=-(this.bias+i)*this.iSum,s=this.jAcc;this.jAcc=this.bias<0?b(s+r,0,this.jMax):b(s+r,-this.jMax,0),r=this.jAcc-s,t.w-=r*t.i_inv,e.w+=r*e.i_inv}},Mi.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Oi=s.RatchetJoint=function(t,e,i,r){Ti.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=r,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Oi.prototype=Object.create(Ti.prototype),Oi.prototype.preStep=function(t){var e=this.a,i=this.b,r=this.angle,s=this.phase,n=this.ratchet,o=i.a-e.a,a=r-o,h=0;a*n>0?h=a:this.angle=Math.floor((o-s)/n)*n+s,this.iSum=1/(e.i_inv+i.i_inv);var l=this.maxBias;this.bias=b(-_i(this.errorBias,t)*h/t,-l,l),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Oi.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Oi.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,r=this.ratchet,s=-(this.bias+i)*this.iSum,n=this.jAcc;this.jAcc=b((n+s)*r,0,this.jMax*Math.abs(r))/r,s=this.jAcc-n,t.w-=s*t.i_inv,e.w+=s*e.i_inv}},Oi.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Ii=s.GearJoint=function(t,e,i,r){Ti.call(this,t,e),this.phase=i,this.ratio=r,this.ratio_inv=1/r,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Ii.prototype=Object.create(Ti.prototype),Ii.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var r=this.maxBias;this.bias=b(-_i(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-r,r),this.jMax=this.maxForce*t},Ii.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv*this.ratio_inv,i.w+=r*i.i_inv},Ii.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,r=(this.bias-i)*this.iSum,s=this.jAcc;this.jAcc=b(s+r,-this.jMax,this.jMax),r=this.jAcc-s,t.w-=r*t.i_inv*this.ratio_inv,e.w+=r*e.i_inv},Ii.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Ii.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var Bi=s.SimpleMotor=function(t,e,i){Ti.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};return Bi.prototype=Object.create(Ti.prototype),Bi.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},Bi.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Bi.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,r=-i*this.iSum,s=this.jAcc;this.jAcc=b(s+r,-this.jMax,this.jMax),r=this.jAcc-s,t.w-=r*t.i_inv,e.w+=r*e.i_inv},Bi.prototype.getImpulse=function(){return Math.abs(this.jAcc)},r.exports}),s("physics/PhysicsSystem",["require","exports","module","../geom/Rectangle","../geom/Circle","../geom/Polygon","../math/Vector","../tilemap/Tile","../utils/inherit","../vendor/cp"],function(t,e,i){var r=t("../geom/Rectangle"),s=t("../geom/Circle"),n=t("../geom/Polygon"),o=t("../math/Vector"),a=t("../tilemap/Tile"),h=t("../utils/inherit"),l=t("../vendor/cp"),u=function(t,e){e=e||{},e.gravity=e.gravity instanceof o?e.gravity:new o(0,9.87),e.sleepTimeThreshold=void 0!==e.sleepTimeThreshold?e.sleepTimeThreshold:.2,e.collisionSlop=void 0!==e.collisionSlop?e.collisionSlop:.1,this.state=t,this.space=new l.Space,this.gravity=this.space.gravity=e.gravity,this.space.sleepTimeThreshold=e.sleepTimeThreshold,this.space.collisionSlop=e.collisionSlop,this.space.addCollisionHandler(u.COLLISION_TYPE.SPRITE,u.COLLISION_TYPE.SPRITE,this.onCollisionBegin.bind(this),null,this.onCollisionPostSolve.bind(this),this.onCollisionEnd.bind(this)),this.space.addCollisionHandler(u.COLLISION_TYPE.SPRITE,u.COLLISION_TYPE.TILE,this.onCollisionBegin.bind(this),null,this.onCollisionPostSolve.bind(this),this.onCollisionEnd.bind(this)),this.actionQueue=[],this.tickCallbacks=[],this._skip=0};return h(u,Object,{pause:function(){return this._paused=!0,this},resume:function(){return this._paused=!1,this},skip:function(t){return this._skip+=t,this},skipNext:function(){return this.skip(1)},nextTick:function(t){return this.tickCallbacks.push(t),this},getCollisionType:function(t){return t instanceof a?u.COLLISION_TYPE.TILE:u.COLLISION_TYPE.SPRITE},add:function(t,e){if(!t._phys.active){var i,r=this._createBody(t),s=this._createShape(t,r);if(!r.isStatic()){var n=new l.Body(1/0,1/0),o=new l.PivotJoint(n,r,l.vzero,l.vzero),a=new l.GearJoint(n,r,0,1);o.maxBias=0,o.maxForce=1e4,a.errorBias=0,a.maxBias=1.2,a.maxForce=5e4,i={},i.body=n,i.pivot=o,i.gear=a}return t._phys.active=!0,this.actionQueue.push(["add",{spr:t,body:r,shape:s,control:i},e]),this.act(),t}},remove:function(t,e){return t&&t._phys.active?(t._phys.active=!1,this.actionQueue.push(["remove",t._phys,e]),this.act(),t):void 0},reindex:function(t,e){return t&&t._phys.active?(t._phys._cb=e,this.actionQueue.push(["reindex",t._phys.shape,e]),this.act(),this):void 0},reindexStatic:function(t){return this.actionQueue.push(["reindexStatic",null,t]),this.act(),this},addCustomShape:function(t,e,i,r){if(t&&t._phys.body){var s=this._createShape(t,t._phys.body,e);return s.setSensor(i),s.width=t.width,s.height=t.height,s.sprite=t,s.setElasticity(0),s.setSensor(void 0!==i?i:t.sensor),s.setCollisionType(this.getCollisionType(t)),s.setFriction(t.friction||0),this.actionQueue.push(["addCustomShape",{spr:t,shape:s},r]),this.act(),s}},setMass:function(t,e){return t&&t._phys.body?(t._phys.body.setMass(e),this):void 0},setVelocity:function(t,e){return t?(t._phys.control?t._phys.control.body.setVel(e):t._phys.body.setVel(e),this):void 0},setPosition:function(t,e){return t?(t._phys.body&&t._phys.body.setPos(e),t._phys.control&&t._phys.control.body.setPos(e),this):void 0},setRotation:function(t,e){return t?(t._phys.control?t._phys.control.body.setAngle(e):t._phys.body&&t._phys.body.setAngle(e),this):void 0},update:function(t){if(!this._paused){for(;this.tickCallbacks.length;)this.tickCallbacks.shift().call(this);if(this._skip)return this._skip--;this.space.step(t),this.space.activeShapes.each(function(t){var e=t.sprite;e.position.x=t.body.p.x,e.position.y=t.body.p.y,e.rotation=t.body.a,e.emit("physUpdate")})}},onCollisionBegin:function(t){var e=t.getShapes(),i=e[0].sprite,r=e[1].sprite;return(e[0].sensor||e[1].sensor)&&(i.onCollision(r,t.getNormal(0),e[1],e[0]),r.onCollision(i,t.getNormal(0),e[0],e[1])),!0},onCollisionPostSolve:function(t){var e=t.getShapes(),i=e[0].sprite,r=e[1].sprite;return t.isFirstContact()&&(i.onCollision(r,t.totalImpulse(),e[1],e[0]),r.onCollision(i,t.totalImpulse(),e[0],e[1])),!0},onCollisionEnd:function(t){var e=t.getShapes(),i=e[0].sprite,r=e[1].sprite;return i.onSeparate(r,e[1],e[0]),r.onSeparate(i,e[0],e[1]),!0},act:function(){if(this.space.locked)this.space.addPostStepCallback(this.onPostStep.bind(this));else{var t=this;setTimeout(function(){t.onPostStep()},1)}},onPostStep:function(){for(;this.actionQueue.length;){var t=this.actionQueue.shift(),e=t[0],i=t[1],r=t[2];switch(e){case"add":i.body.setPos(i.spr.position),i.body.isStatic()||this.space.addBody(i.body),this.space.addShape(i.shape),i.control&&(i.control.body.setPos(i.spr.position),this.space.addConstraint(i.control.pivot),this.space.addConstraint(i.control.gear)),i.spr._phys.body=i.body,i.spr._phys.shape=i.shape,i.spr._phys.control=i.control;break;case"remove":if(i.body.space&&this.space.removeBody(i.body),i.shape.space&&this.space.removeShape(i.shape),i.customShapes)for(var s=i.customShapes.length-1;s>-1;--s)this.space.removeShape(i.customShapes[s]);i.body=null,i.shape.sprite=null,i.shape=null,i.customShapes=null;break;case"reindex":this.space.reindexShape(i);break;case"reindexStatic":this.space.reindexStatic();break;case"addCustomShape":i.spr._phys.customShapes||(i.spr._phys.customShapes=[]),i.spr._phys.customShapes.push(i.shape),this.space.addShape(i.shape)}r&&r.call(this)}},_createBody:function(t){var e=new l.Body(t.mass||1,t.inertia||l.momentForBox(t.mass||1,t.width,t.height)||1/0);return 1/0===t.mass&&(e.nodeIdleTime=1/0),e},_createShape:function(t,e,i){var a,h=i||t.hitArea,u=t.anchor?t.anchor.x:0,c=t.anchor?t.anchor.y:0,p=t.width*u,d=t.height*c;if(h)if(h instanceof r){var f=h.x,m=h.x+h.width,v=h.y-t.height,y=v+h.height;f-=p,m-=p,v+=t.height-d,y+=t.height-d,a=new l.BoxShape2(e,new l.BB(f,v,m,y))}else if(h instanceof s){var g=new o(t.width/2-p+h.x,t.height/2-d+h.y);a=new l.CircleShape(e,h.radius,g)}else if(h instanceof n){for(var b=[],x=h.points,_=0;_<x.length;++_){var T=x[_];b.push(T.x-p),b.push(T.y-d)}a=new l.PolyShape(e,l.convexHull(b,null,0),l.vzero)}return a||(a=new l.BoxShape2(e,new l.BB(0,-t.height,t.width,0))),a.width=t.width,a.height=t.height,a.sprite=t,a.setElasticity(0),a.setSensor(t.sensor),a.setCollisionType(this.getCollisionType(t)),a.setFriction(t.friction||0),a}}),u.COLLISION_TYPE={SPRITE:0,TILE:1},i.exports=u,i.exports}),s("game/State",["require","exports","module","../audio/AudioManager","../display/Container","./World","../camera/Camera","../physics/PhysicsSystem","../math/math","../utils/inherit"],function(t,e,i){var r=t("../audio/AudioManager"),s=t("../display/Container"),n=t("./World"),o=t("../camera/Camera"),a=t("../physics/PhysicsSystem"),h=t("../math/math"),l=t("../utils/inherit"),u=function(t,e,i){e||(e=h.randomString()),this.name=e,this.game=t,this.audio=new r(t,t.audio),this.world=new n(this),this.physics=new a(this,i),this.camera=new o(this),s.call(this),this.visible=!1,this.addChild(this.world),this.addChild(this.camera),this.camera.resize(t.width,t.height)};return l(u,s,{enable:function(){return this.game.state.enable(this),this},resize:function(t,e){return this.camera.resize(t,e),this.world.resize(t,e),this},update:function(t){return this.game.timings.cameraStart=this.game.clock.now(),this.camera.update(t),this.game.timings.cameraEnd=this.game.clock.now(),this.game.timings.worldStart=this.game.clock.now(),this.world.update(t),this.game.timings.worldEnd=this.game.clock.now(),this.game.timings.physicsStart=this.game.clock.now(),this.physics.update(t),this.game.timings.physicsEnd=this.game.clock.now(),this}}),i.exports=u,i.exports}),s("game/StateManager",["require","exports","module","../utils/inherit","./State"],function(t,e,i){var r=t("../utils/inherit"),s=t("./State"),n=function(t){this.game=t,this.states={},this.active=null,this.count=0,this._createDefault()
};return r(n,Object,{_createDefault:function(){return this.add("__default",!0)},add:function(t,e){var i;return"string"==typeof t?i=new s(this.game,t):"function"==typeof t?i=new t(this.game):(i=t,i.game=this.game),this.states[i.name]=i,this.game.stage.addChild(i),e&&this.enable(i),this.count++,i},remove:function(t){return"string"==typeof t&&(t=this.states[t]),t.parent&&t.parent.removeChild(t),delete this.states[t.name],this.count--,this},enable:function(t){return"string"!=typeof t&&(t=t.name),this.states[t]&&(this.active&&(this.active.visible=!1),this.active=this.states[t],this.active.visible=!0),this},destroy:function(){this.game=null,this.states=null}}),i.exports=n,i.exports}),s("utils/Cache",["require","exports","module","./inherit","../constants","../display/Texture","../display/BaseTexture","../text/BitmapText","../vendor/pixi"],function(t,e,i){var r=t("./inherit"),s=t("../constants"),n=t("../display/Texture"),o=t("../display/BaseTexture"),a=t("../text/BitmapText"),h=t("../vendor/pixi"),l=function(t){this.game=t,this._canvases={},this._images={},this._sounds={},this._text={},this._tilemaps={},this.addDefaultImage()};return r(l,Object,{addCanvas:function(t){this._canvases[t.key]=t},addSpriteSheet:function(t){var e=t.key;h.BaseTextureCache[e]=new o(t.image),h.TextureCache[e]=new n(h.BaseTextureCache[e]),t.texture=h.TextureCache[e],t.textures=n.fromSpritesheet(t),this._images[e]=t},addTilemap:function(t){var e,i,r=t.key,a=t.format;a===s.FILE_FORMAT.XML?e=t.data.getElementsByTagName("tilesets"):a===s.FILE_FORMAT.JSON&&(e=t.data.tilesets),t.textures={};for(var l=0,u=t.images.length;u>l;++l){a===s.FILE_FORMAT.JSON?i=e[l].name:a===s.FILE_FORMAT.XML&&(i=e[l].attributes.getNamedItem("name").nodeValue);var c=r+"_"+i;h.BaseTextureCache[c]=new o(t.images[l]),h.TextureCache[c]=new n(h.BaseTextureCache[c]),t.textures[i]=h.TextureCache[c]}this._tilemaps[r]=t},addTextureAtlas:function(t){var e=t.key;h.BaseTextureCache[e]=new o(t.image),h.TextureCache[e]=new n(h.BaseTextureCache[e]),t.texture=h.TextureCache[e],t.format===s.ATLAS_FORMAT.JSON_ARRAY||t.format===s.ATLAS_FORMAT.JSON_HASH?t.textures=n.fromJSON(e,t.data,t.texture.baseTexture):t.format===s.ATLAS_FORMAT.STARLING_XML&&(t.textures=n.fromXML(e,t.data,t.texture.baseTexture)),this._images[e]=t},addBitmapFont:function(t){var e=t.key;h.BaseTextureCache[e]=new o(t.image),h.TextureCache[e]=new n(h.BaseTextureCache[e]),t.texture=h.TextureCache[e],t.font=a.parseXML(e,t.data,t.texture),this._images[e]=t},addImage:function(t){var e=t.key;h.BaseTextureCache[e]=new o(t.image),h.TextureCache[e]=new n(h.BaseTextureCache[e]),t.texture=h.TextureCache[e],this._images[e]=t},addAudio:function(t){var e=t.key;t.webAudio||(t.decoded=!0),t.isDecoding=!1,this._sounds[e]=t},updateSound:function(t,e,i){this._sounds[t]&&(this._sounds[t][e]=i)},addText:function(t){this._text[t.key]=t},addDefaultImage:function(){var t="__default",e=new o;e.width=0,e.height=0,e.hasLoaded=!0,h.BaseTextureCache[t]=e,h.TextureCache[t]=new n(e),n.__default=h.TextureCache[t],this._images[t]={texture:h.TextureCache[t]}},getCanvas:function(t){return this._canvases[t]?this._canvases[t].canvas:void 0},getImage:function(t){return this._images[t]?this._images[t].image:void 0},getTexture:function(t){return this._images[t]?this._images[t].texture:void 0},getTextures:function(t){return this._images[t]?this._images[t].textures:void 0},getBitmapFont:function(t){return this._images[t]?this._images[t].font:void 0},getTilemap:function(t){return this._tilemaps[t]},getAudio:function(t){return this._sounds[t]},getAudioData:function(t){return this._sounds[t]?this._sounds[t].data:void 0},getText:function(t){return this._text[t]?this._text[t].data:void 0},removeCanvas:function(t){delete this._canvases[t]},removeImage:function(t){delete this._images[t]},removeSound:function(t){delete this._sounds[t]},removeText:function(t){delete this._text[t]},destroy:function(){this.game=null,this._canvases=null,this._images=null,this._sounds=null,this._text=null,this._tilemaps=null}}),i.exports=l,i.exports}),s("utils/Clock",["require","exports","module","./inherit"],function(t,i,r){var s=t("./inherit"),n=function(){this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,this.timer=e.performance&&e.performance.now?e.performance:Date};return s(n,Object,{now:function(){return this.timer.now()},start:function(){return this.startTime=this.oldTime=this.now(),this.running=!0,this},stop:function(){return this.getElapsedTime(),this.running=!1,this},reset:function(){return this.elapsedTime=0,this.startTime=this.oldTime=this.now(),this},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.running){var e=this.now();t=.001*(e-this.oldTime),this.oldTime=e,this.elapsedTime+=t}return t}}),r.exports=n,r.exports}),s("utils/SpritePool",["require","exports","module","./inherit","../display/Sprite"],function(t,e,i){var r=t("./inherit"),s=t("../display/Sprite"),n=function(t){this.types={},this.game=t,this.add("_default",s)};return r(n,Object,{add:function(t,e){return this.types[t]=e},has:function(t){return!!this.types[t]},create:function(t,e,i){return t&&this.types[t]||(t="_default"),new this.types[t](e,i)},free:function(){}}),i.exports=n,i.exports}),s("loader/Loader",["require","exports","module","../utils/utils","../utils/inherit","../utils/support","../utils/EventEmitter","../constants"],function(t,e,i){var r=t("../utils/utils"),s=t("../utils/inherit"),n=t("../utils/support"),o=t("../utils/EventEmitter"),a=t("../constants"),h=function(t){o.call(this),this.game=t,this.keys=[],this.assets={},this.total=0,this.done=0,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.crossOrigin="",this.baseUrl=""};return s(h,Object,{hasKey:function(t){return!!this.assets[t]},reset:function(){return this.progress=0,this.total=0,this.done=0,this.hasLoaded=!1,this.isLoading=!1,this.assets={},this.keys.length=0,this},add:function(t,e,i,r){var s={type:t,key:e,url:i,image:null,data:null,error:!1,loaded:!1};if(void 0!==r)for(var n in r)s[n]=r[n];return this.assets[e]=s,this.keys.push(e),this.total++,this},image:function(t,e,i){return(i||!this.hasKey(t))&&this.add("image",t,e),this},text:function(t,e,i){return(i||!this.hasKey(t))&&this.add("text",t,e),this},spritesheet:function(t,e,i,r,s,n){return(n||!this.hasKey(t))&&this.add("spritesheet",t,e,{frameWidth:i,frameHeight:r,numFrames:s}),this},audio:function(t,e,i){return(i||!this.hasKey(t))&&this.add("audio",t,e),this},tilemap:function(t,e,i,r,s){if(s||!this.hasKey(t)){if(r||(r=a.FILE_FORMAT.JSON),"string"==typeof i)switch(r){case a.FILE_FORMAT.JSON:i=JSON.parse(i);break;case a.FILE_FORMAT.XML:i=a.utils.parseXML(i);break;case a.FILE_FORMAT.CSV:}this.add("tilemap",t,e,{data:i,format:r})}return this},bitmapFont:function(t,e,i,s,n,o){if(o||!this.hasKey(t)){if(n||(n=a.FILE_FORMAT.XML),"string"==typeof s)switch(n){case a.FILE_FORMAT.XML:s=r.parseXML(s);break;case a.FILE_FORMAT.JSON:s=JSON.parse(s)}this.add("bitmapfont",t,e,{dataUrl:i,data:s,format:n})}return this},atlasJSONArray:function(t,e,i,r){return this.atlas(t,e,i,r,a.ATLAS_FORMAT.JSON_ARRAY)},atlasJSONHash:function(t,e,i,r){return this.atlas(t,e,i,r,a.ATLAS_FORMAT.JSON_HASH)},atlasXML:function(t,e,i,r){return this.atlas(t,e,i,r,a.ATLAS_FORMAT.XML_STARLING)},atlas:function(t,e,i,s,n,o){if(o||!this.hasKey(t)){if(n||(n=a.ATLAS_FORMAT.JSON_ARRAY),"string"==typeof s)switch(n){case a.ATLAS_FORMAT.XML_STARLING:s=r.parseXML(s);break;case a.ATLAS_FORMAT.JSON_ARRAY:case a.ATLAS_FORMAT.JSON_HASH:s=JSON.parse(s)}this.add("textureatlas",t,e,{dataUrl:i,data:s,format:n})}return this},start:function(){if(!this.isLoading){if(this.progress=0,this.hasLoaded=!1,this.isLoading=!0,this.emit("start",this.keys.length),this.keys.length>0)for(;this.keys.length>0;)this.loadFile();else this.progress=100,this.hasLoaded=!0,this.emit("complete");return this}},loadFile:function(){var t=this.assets[this.keys.shift()],e=this;switch(t.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":t.image=new Image,t.image.name=t.key,t.image.addEventListener("load",this.fileComplete.bind(this,t.key),!1),t.image.addEventListener("error",this.fileError.bind(this,t.key),!1),t.image.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:this.crossOrigin,t.image.src=this.baseUrl+t.url;break;case"tilemap":r.ajax({url:this.baseUrl+t.url,dataType:this._getFormatAjaxType(t.format),load:function(i){t.data=i,e.fileComplete(t.key)},error:function(i){e.fileError(t.key,i)}});break;case"audio":t.url=this.getAudioUrl(t.url),t.url?n.webAudio?r.ajax({url:this.baseUrl+t.url,dataType:"arraybuffer",load:function(i){t.data=i,e.fileComplete(t.key)},error:function(i){e.fileError(t.key,i)}}):n.htmlAudio&&(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.baseUrl+t.url,t.data.addEventListener("error",t._bndError=this.fileError.bind(this,t.key),!1),t.data.addEventListener("canplaythrough",t._bndComplete=this.fileComplete.bind(this,t.key),!1),t.data.load()):this.fileError(t.key,"No supported audio URL could be determined!");break;case"text":r.ajax({url:this.baseUrl+t.url,dataType:"text",load:function(i){t.data=i,e.fileComplete(t.key)},error:function(i){e.fileError(t.key,i)}})}return this},getAudioUrl:function(t){for(var e=0,i=t.length;i>e;++e){var r=t[e],s=r.match(/.+\.([^?]+)(\?|$)/);if(s=s&&s.length>=2?s[1]:r.match(/data\:audio\/([^?]+);/)[1],n.codec[s])return r}},fileError:function(t,e){this.assets[t].loaded=!0,this.assets[t].error=e,this.fileDone(t,e)},fileComplete:function(t){if(!this.assets[t])return r.warn("fileComplete key is invalid!",t);this.assets[t].loaded=!0;var e=this.assets[t],i=!0,s=this;switch(e.type){case"image":this.game.cache.addImage(e);break;case"spritesheet":this.game.cache.addSpriteSheet(e);break;case"tilemap":e.baseUrl=e.url.replace(/[^\/]*$/,""),e.numImages=e.numLoaded=0,e.images=[],e.format===a.FILE_FORMAT.JSON?(i=!1,this._loadJsonTilesets(e)):e.format===a.FILE_FORMAT.XML&&(i=!1,this._loadXmlTilesets(e));break;case"textureatlas":i=!1,this._dataget(e,function(){s.game.cache.addTextureAtlas(e)});break;case"bitmapfont":i=!1,this._dataget(e,function(){s.game.cache.addBitmapFont(e)});break;case"audio":n.webAudio?(e.webAudio=!0,e.decoded=!1):(e.data.removeEventListener("error",e._bndError),e.data.removeEventListener("canplaythrough",e._bndComplete)),this.game.cache.addAudio(e);break;case"text":this.game.cache.addText(e)}i&&this.fileDone(e.key)},fileDone:function(t,e){this.done++,this.progress=Math.round(100*(this.done/this.total)),this.emit("progress",this.progress),e&&(r.warn('Error loading file "'+t+'", error received:',e),this.emit("error",e,t)),this.progress>=100&&(this.progress=100,this.hasLoaded=!0,this.isLoading=!1,this.emit("complete"))},_getFormatAjaxType:function(t){switch(t){case a.ATLAS_FORMAT.JSON_ARRAY:case a.ATLAS_FORMAT.JSON_HASH:case a.FILE_FORMAT.JSON:return"json";case a.ATLAS_FORMAT.XML_STARLING:case a.FILE_FORMAT.XML:return"xml";case a.FILE_FORMAT.CSV:return"text"}},_dataget:function(t,e){var i=this;t.dataUrl?r.ajax({url:this.baseUrl+t.dataUrl,dataType:this._getFormatAjaxType(t.format),load:function(r){t.data=r,e&&e(),i.fileDone(t.key)},error:function(e){i.fileError(t.key,e)}}):setTimeout(e,1)},_loadJsonTilesets:function(t){for(var e=t.data,i=t.baseUrl,r=0,s=e.tilesets.length;s>r;++r){var n,o=e.tilesets[r];o.image&&(t.numImages++,n=new Image,n.addEventListener("load",this._onTilesetLoaded.bind(this,t),!1),n.addEventListener("error",this._onTilesetError.bind(this,t),!1),n.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:this.crossOrigin,n.src=this.baseUrl+i+o.image,t.images.push(n))}},_loadXmlTilesets:function(t){for(var e=t.data,i=t.baseUrl,r=e.getElementsByTagName("tileset"),s=0,n=r.length;n>s;++s){var o,a=r[s],h=a.getElementsByTagName("image")[0];h&&(t.numImages++,o=new Image,o.addEventListener("load",this._onTilesetLoaded.bind(this,t),!1),o.addEventListener("error",this._onTilesetError.bind(this,t),!1),o.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:this.crossOrigin,o.src=this.baseUrl+i+h.attributes.getNamedItem("source").nodeValue,t.images.push(o))}},_onTilesetLoaded:function(t){t.numLoaded++,t.numImages===t.numLoaded&&(this.game.cache.addTilemap(t),this.fileDone(t.key))},_onTilesetError:function(t,e){t.error=e,t.numLoaded++,t.numImages===t.numLoaded&&this.fileDone(t.key,e)}}),i.exports=h,i.exports}),s("input/Input",["require","exports","module","../utils/inherit","../utils/EventEmitter"],function(t,e,i){var r=t("../utils/inherit"),s=t("../utils/EventEmitter"),n=function(t){s.call(this),this.game=t};return r(n,Object,{}),i.exports=n,i.exports}),s("input/Keyboard",["require","exports","module","../utils/inherit","./Input"],function(t,e,i){var r=t("../utils/inherit"),s=t("./Input"),n=function(t){s.call(this,t),this.sequence=[],this.sequenceTimeout=500,this._clearSq=null,t.canvas.addEventListener("keydown",this.onKeyDown.bind(this),!1),t.canvas.addEventListener("keyup",this.onKeyUp.bind(this),!1)};return r(n,s,{onKeyDown:function(t,e){return this.modifyKey(t,e||t.keyCode||t.which,!0)},onKeyUp:function(t,e){return this.modifyKey(t,e||t.keyCode||t.which,!1)},modifyKey:function(t,e,i){if(this.emit(e,this._getEventData(t,i)),i){this.sequence.push(e);var r=this.sequence.toString();r!==e.toString()&&this.emit(r,this._getEventData(t,i)),clearTimeout(this._clearSq),this._clearSq=setTimeout(this._clearSequence.bind(this),this.sequenceTimeout)}},_getEventData:function(t,e){return{input:this,originalEvent:t,down:e}},_clearSequence:function(){this.sequence.length=0}}),n.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,PLUS:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_STAR:106,NUMPAD_PLUS:107,NUMPAD_MINUS:109,NUMPAD_DOT:110,NUMPAD_SLASH:111,F1:112,F2:113,F3:114,F4:115,MINUS:173,TILDE:192},i.exports=n,i.exports}),s("input/gamepad/GamepadButtons",["require","exports","module","../../utils/inherit","../Input"],function(t,e,i){var r=t("../../utils/inherit"),s=t("../Input"),n=function(){s.call(this),this.threshold=.4,this.buttons={};for(var t in n.BUTTON)this.buttons[n.BUTTON[t]]={code:n.BUTTON[t],name:t,down:!1,value:0}};return r(n,s,{pollStatus:function(t){for(var e=0,i=t.buttons.length;i>e;++e){var r=t.buttons[e]>this.threshold,s=this.buttons[e];s.value=t.buttons[e],s.down!==r&&(s.down=r,this.emit(e,s))}}}),n.BUTTON={FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_TOP:12,PAD_BOTTOM:13,PAD_LEFT:14,PAD_RIGHT:15,SYSTEM_MENU:16},n.getGpButtonName=function(t){for(var e in n.BUTTON)if(n.BUTTON[e]===t)return e;return""},i.exports=n,i.exports}),s("input/gamepad/GamepadSticks",["require","exports","module","../../utils/inherit","../Input"],function(t,e,i){var r=t("../../utils/inherit"),s=t("../Input"),n=function(){s.call(this),this.threshold=.5,this.axes={};for(var t in n.AXIS)this.axes[n.AXIS[t]]={code:n.AXIS[t],name:t,value:0}};return r(n,s,{pollStatus:function(t){for(var e=0,i=t.axes.length;i>e;++e){var r=t.axes[e],s=this.axes[e];s.value=Math.abs(r)>=this.threshold?r:0,this.emit(e,s)}}}),n.AXIS={LEFT_ANALOGUE_HOR:0,LEFT_ANALOGUE_VERT:1,RIGHT_ANALOGUE_HOR:2,RIGHT_ANALOGUE_VERT:3},n.getGpAxisName=function(t){for(var e in n.AXIS)if(n.AXIS[e]===t)return e;return""},i.exports=n,i.exports}),s("input/Gamepad",["require","exports","module","../utils/inherit","./Input","./gamepad/GamepadButtons","./gamepad/GamepadSticks"],function(t,i,r){var s=t("../utils/inherit"),n=t("./Input"),o=t("./gamepad/GamepadButtons"),a=t("./gamepad/GamepadSticks"),h=function(){n.call(this),this.ticking=!1,this.pads=[],this.prevTimestamps=[],this.buttons=new o,this.sticks=new a,e.addEventListener("MozGamepadConnected",this.onGamepadConnect.bind(this),!1),e.addEventListener("MozGamepadDisconnected",this.onGamepadDisconnect.bind(this),!1),(navigator.webkitGamepads||navigator.webkitGetGamepads)&&this.startPolling()};return s(h,n,{onGamepadConnect:function(t){this.pads.push(t.gamepad),this.startPolling()},onGamepadDisconnect:function(t){for(var e=0,i=this.pads.length;i>e;++e)if(this.pads[e].index===t.gamepad.index){this.pads.splice(e,1);break}0===this.pads.length&&this.stopPolling()},startPolling:function(){this.ticking||(this.ticking=!0,this.update())},stopPolling:function(){this.ticking=!1},pollGamepads:function(){var t=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;if(t){this.pads.length=0;for(var e=0,i=t.length;i>e;++e)t[e]&&this.pads.push(t[e])}},pollStatus:function(){for(var t=0,e=this.pads.length;e>t;++t){var i=this.pads[t];i.timestamp&&i.timestamp===this.prevTimestamps[t]||(this.prevTimestamps[t]=i.timestamp,this.buttons.pollStatus(i),this.sticks.pollStatus(i))}},update:function(){this.ticking&&(this.pollGamepads(),this.pollStatus())}}),r.exports=h,r.exports}),s("input/pointer/Pointer",["require","exports","module","../Input","../../math/Vector","../../utils/Clock","../../utils/inherit"],function(t,e,i){var r=t("../Input"),s=t("../../math/Vector"),n=t("../../utils/Clock"),o=t("../../utils/inherit"),a=function(t,e){r.call(this),this.id=t,this.manager=e,this.game=e.game,this.active=!1,this.mouse=1===t,this.clock=new n,this.button=null,this.type=null,this._holdSent=!1,this.position=new s,this.positionDown=new s};return o(a,r,{down:function(t){this.originalEvent=t,this.timeDown=this.clock.now(),this.timeHold=0,this._holdSent=!1,this.move(t),this.positionDown.copy(this.position),this.button=t.button,this.type=t.pointerType,this.active||(this.active=!0,this.manager.activePointers++)},up:function(t){var e;this.originalEvent=t,this.timeUp=this.clock.now(),this.timeHold=this.timeUp-this.timeDown,this.timeHold>=0&&this.timeHold<=this.manager.clickDelay&&(e=this.timeUp-this.previousClickTime<=this.manager.doubleClickDelay?"doubleclick":"click",this.previousClickTime=this.timeUp),this.mouse||(this.active=!1,this.manager.activePointers--),e&&this.manager.emit(e,this)},move:function(t){this.originalEvent=t,this.button=t.button,this.type=t.pointerType,this.position.set(t.pageX-this.game.offset.x,t.pageY-this.game.offset.y)},leave:function(t){this.move(t)},update:function(){this.active&&!this._holdSent&&(this.timeHold+=this.clock.now()-this.timeDown,this.timeHold>=this.manager.holdDelay&&(this._holdSent=!0,this.manager.emit("hold",this)))},positionWorld:{}}),Object.defineProperty(a.prototype.positionWorld,"x",{get:function(){return this.position.x-this.game.world.position.x}}),Object.defineProperty(a.prototype.positionWorld,"y",{get:function(){return this.position.y-this.game.world.position.y}}),a.TYPE={TOUCH:"touch",PEN:"pen",MOUSE:"mouse"},i.exports=a,i.exports}),s("input/Pointers",["require","exports","module","../utils/inherit","./Input","./pointer/Pointer"],function(t,i,r){var s=t("../utils/inherit"),n=t("./Input"),o=t("./pointer/Pointer"),a=function(t){n.call(this,t),this.pointers={},this.maxPointers=10,this.clickDelay=200,this.doubleClickDelay=300,this.holdDelay=2e3,this.mouse=this.pointers[1]=new o(1,this),this.activePointers=0,t.canvas.addEventListener("pointerdown",this.onPointer.bind(this,"down"),!1),t.canvas.addEventListener("pointerup",this.onPointer.bind(this,"up"),!1),t.canvas.addEventListener("pointermove",this.onPointer.bind(this,"move"),!1),t.canvas.addEventListener("pointerover",this.onPointer.bind(this,"over"),!1),t.canvas.addEventListener("pointerout",this.onPointer.bind(this,"out"),!1),t.canvas.addEventListener("pointercancel",this.onPointer.bind(this,"cancel"),!1),t.canvas.addEventListener("pointerenter",this.onPointer.bind(this,"enter"),!1),t.canvas.addEventListener("pointerleave",this.onPointer.bind(this,"leave"),!1)};return s(a,n,{onPointer:function(t,e){var i=e.pointerId,r=this.pointers[i];if(!r){if(!(this._numPointers<this.maxPointers))return;this.pointers[i]=new o(i,this)}r[t]&&r[t](e),this.emit(t,r)},update:function(t){for(var e=this.pointers,i=0;i<e.length;++i)e[i]&&e[i].update(t);return this}}),r.exports=a,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=Object(this),i=e.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&1/0!=r&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var s=r>=0?r:Math.max(i-Math.abs(r),0);i>s;s++)if(s in e&&e[s]===t)return s;return-1});var t=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter","PointerLeave","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],i="touch",r="pen",s="mouse",n={},o=function(t){for(;t&&t.handjs_forcePreventDefault!==!0;)t=t.parentElement;return null!=t},a=function(t,n){var a;if(document.createEvent?(a=document.createEvent("MouseEvents"),a.initMouseEvent(n,!0,!0,e,1,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,null)):(a=document.createEventObject(),a.screenX=t.screenX,a.screenY=t.screenY,a.clientX=t.clientX,a.clientY=t.clientY,a.ctrlKey=t.ctrlKey,a.altKey=t.altKey,a.shiftKey=t.shiftKey,a.metaKey=t.metaKey,a.button=t.button),void 0===a.offsetX&&(void 0!==t.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(a,"offsetX",{writable:!0}),Object.defineProperty(a,"offsetY",{writable:!0})),a.offsetX=t.offsetX,a.offsetY=t.offsetY):void 0!==t.layerX&&(a.offsetX=t.layerX-t.currentTarget.offsetLeft,a.offsetY=t.layerY-t.currentTarget.offsetTop)),a.isPrimary=void 0!==t.isPrimary?t.isPrimary:!0,t.pressure)a.pressure=t.pressure;else{var h=0;void 0!==t.which?h=t.which:void 0!==t.button&&(h=t.button),a.pressure=0==h?0:.5}if(a.rotation=t.rotation?t.rotation:0,a.hwTimestamp=t.hwTimestamp?t.hwTimestamp:0,a.tiltX=t.tiltX?t.tiltX:0,a.tiltY=t.tiltY?t.tiltY:0,a.height=t.height?t.height:0,a.width=t.width?t.width:0,a.preventDefault=function(){void 0!==t.preventDefault&&t.preventDefault()},void 0!==a.stopPropagation){var l=a.stopPropagation;a.stopPropagation=function(){void 0!==t.stopPropagation&&t.stopPropagation(),l.call(this)}}switch(a.POINTER_TYPE_TOUCH=i,a.POINTER_TYPE_PEN=r,a.POINTER_TYPE_MOUSE=s,a.pointerId=t.pointerId,a.pointerType=t.pointerType,a.pointerType){case 2:a.pointerType=a.POINTER_TYPE_TOUCH;break;case 3:a.pointerType=a.POINTER_TYPE_PEN;break;case 4:a.pointerType=a.POINTER_TYPE_MOUSE}t.currentTarget&&o(t.currentTarget)===!0&&a.preventDefault(),t.target?t.target.dispatchEvent(a):t.srcElement.fireEvent("on"+d(n),a)},h=function(t,e){t.pointerId=1,t.pointerType=s,a(t,e)},l=function(t,e,r,s){var n=e.identifier+2;e.pointerId=n,e.pointerType=i,e.currentTarget=r,e.target=r,void 0!==s.preventDefault&&(e.preventDefault=function(){s.preventDefault()}),a(e,t)},u=function(t,e){for(;t&&(!t.__handjsGlobalRegisteredEvents||!t.__handjsGlobalRegisteredEvents[e]);)t=t.parentElement;return null!=t},c=function(t,e,i,r){u(i,t)&&l(t,e,i,r)},p=function(t,e,i,r){t.preventManipulation&&t.preventManipulation();for(var s=0;s<t.changedTouches.length;++s){var o=t.changedTouches[s];i&&(n[o.identifier]=o.target),r?c(e,o,n[o.identifier],t):l(e,o,n[o.identifier],t)}},d=function(t){return t.toLowerCase().replace("pointer","mouse")},f=function(e,i,r){var s;if(r==r.toLowerCase()){var n=t.indexOf(r)-t.length/2;s=i+t[n]}else s=i+r;return s===i+"PointerEnter"&&void 0===e["on"+i.toLowerCase()+"pointerenter"]&&(s=i+"PointerOver"),s===i+"PointerLeave"&&void 0===e["on"+i.toLowerCase()+"pointerleave"]&&(s=i+"PointerOut"),s},m=function(t,e,i,r){if(void 0===t.__handjsRegisteredEvents&&(t.__handjsRegisteredEvents=[]),r){if(void 0!==t.__handjsRegisteredEvents[e])return t.__handjsRegisteredEvents[e]++,void 0;t.__handjsRegisteredEvents[e]=1,t.addEventListener(e,i,!1)}else{if(-1!==t.__handjsRegisteredEvents.indexOf(e)&&(t.__handjsRegisteredEvents[e]--,0!=t.__handjsRegisteredEvents[e]))return;t.removeEventListener(e,i),t.__handjsRegisteredEvents[e]=0}},v=function(t,e,i){if(void 0===t.onpointerdown){if(void 0!==t.onmspointerdown){var r=f(t,"MS",e);return m(t,r,function(t){a(t,e)},i),void 0}if(void 0!==t.ontouchstart)switch(e){case"pointermove":m(t,"touchmove",function(t){p(t,e)},i);break;case"pointercancel":m(t,"touchcancel",function(t){p(t,e)},i);break;case"pointerdown":case"pointerup":case"pointerout":case"pointerover":case"pointerleave":case"pointerenter":if(t.__handjsGlobalRegisteredEvents||(t.__handjsGlobalRegisteredEvents=[]),i){if(void 0!==t.__handjsGlobalRegisteredEvents[e])return t.__handjsGlobalRegisteredEvents[e]++,void 0;t.__handjsGlobalRegisteredEvents[e]=1}else void 0!==t.__handjsGlobalRegisteredEvents[e]&&(t.__handjsGlobalRegisteredEvents[e]--,t.__handjsGlobalRegisteredEvents[e]<0&&(t.__handjsGlobalRegisteredEvents[e]=0))}switch(e){case"pointerdown":m(t,"mousedown",function(t){h(t,e)},i);break;case"pointermove":m(t,"mousemove",function(t){h(t,e)},i);break;case"pointerup":m(t,"mouseup",function(t){h(t,e)},i);break;case"pointerover":m(t,"mouseover",function(t){h(t,e)},i);break;case"pointerout":m(t,"mouseout",function(t){h(t,e)},i);break;case"pointerenter":void 0===t.onmouseenter?m(t,"mouseover",function(t){h(t,e)},i):m(t,"mouseenter",function(t){h(t,e)},i);break;case"pointerleave":void 0===t.onmouseleave?m(t,"mouseout",function(t){h(t,e)},i):m(t,"mouseleave",function(t){h(t,e)},i)}}},y=function(e){var i=e.prototype?e.prototype.addEventListener:e.addEventListener,r=function(e,r,s){-1!=t.indexOf(e)&&v(this,e,!0),void 0===i?this.attachEvent("on"+d(e),r):i.call(this,e,r,s)};e.prototype?e.prototype.addEventListener=r:e.addEventListener=r},g=function(e){var i=e.prototype?e.prototype.removeEventListener:e.removeEventListener,r=function(e,r,s){-1!=t.indexOf(e)&&v(this,e,!1),void 0===i?this.detachEvent(d(e),r):i.call(this,e,r,s)};e.prototype?e.prototype.removeEventListener=r:e.removeEventListener=r};y(HTMLElement),y(document),y(HTMLBodyElement),y(HTMLDivElement),y(HTMLImageElement),y(HTMLUListElement),y(HTMLAnchorElement),y(HTMLLIElement),y(HTMLTableElement),e.HTMLSpanElement&&y(HTMLSpanElement),e.HTMLCanvasElement&&y(HTMLCanvasElement),e.SVGElement&&y(SVGElement),g(HTMLElement),g(document),g(HTMLBodyElement),g(HTMLDivElement),g(HTMLImageElement),g(HTMLUListElement),g(HTMLAnchorElement),g(HTMLLIElement),g(HTMLTableElement),e.HTMLSpanElement&&g(HTMLSpanElement),e.HTMLCanvasElement&&g(HTMLCanvasElement),e.SVGElement&&g(SVGElement),void 0!==e.ontouchstart&&(e.addEventListener("touchstart",function(t){for(var e=0;e<t.changedTouches.length;++e){var i=t.changedTouches[e];n[i.identifier]=i.target,c("pointerenter",i,i.target,t),c("pointerover",i,i.target,t),c("pointerdown",i,i.target,t)}}),e.addEventListener("touchend",function(t){for(var e=0;e<t.changedTouches.length;++e){var i=t.changedTouches[e],r=n[i.identifier];c("pointerup",i,r,t),c("pointerout",i,r,t),c("pointerleave",i,r,t)}}),e.addEventListener("touchmove",function(t){for(var e=0;e<t.changedTouches.length;++e){var i=t.changedTouches[e],r=document.elementFromPoint(i.clientX,i.clientY),s=n[i.identifier];s!==r&&(s&&(c("pointerout",i,s,t),s.contains(r)||c("pointerleave",i,s,t)),r&&(c("pointerover",i,r,t),r.contains(s)||c("pointerenter",i,r,t)),n[i.identifier]=r)}})),void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){var t=function(t){return t.replace(/^\s+|\s+$/,"")},e=function(e){for(var i=new RegExp(".+?{.*?}","m"),r=new RegExp(".+?{","m");""!=e;){var s=i.exec(e);if(!s)break;var n=s[0];e=t(e.replace(n,""));var o=t(r.exec(n)[0].replace("{",""));if(-1!=n.replace(/\s/g,"").indexOf("touch-action:none"))for(var a=document.querySelectorAll(o),h=0;h<a.length;h++){var l=a[h];void 0!==l.style.msTouchAction?l.style.msTouchAction="none":l.handjs_forcePreventDefault=!0}}};try{for(var i=0;i<document.styleSheets.length;i++){var r=document.styleSheets[i];if(void 0!=r.href){var s=new XMLHttpRequest;s.open("get",r.href,!1),s.send();var n=s.responseText.replace(/(\n|\r)/g,"");e(n)}}}catch(o){}for(var a=document.getElementsByTagName("style"),i=0;i<a.length;i++){var h=a[i],l=t(h.innerHTML.replace(/(\n|\r)/g,""));e(l)}},!1)}(),r.exports}),s("input/InputManager",["require","exports","module","../utils/inherit","./Keyboard","./Gamepad","./Pointers"],function(t,e,i){var r=t("../utils/inherit"),s=t("./Keyboard"),n=t("./Gamepad"),o=t("./Pointers"),a=function(t){this.game=t,this.canvas=t.canvas,this.keyboard=new s(t),this.pointers=new o(t),this.gamepad=new n};return r(a,Object,{update:function(t){this.pointers.update(t),this.gamepad.update(t)}}),i.exports=a,i.exports}),s("game/Game",["require","exports","module","./StateManager","../utils/EventEmitter","../utils/Cache","../utils/Clock","../utils/SpritePool","../loader/Loader","../input/InputManager","../audio/AudioManager","../math/Vector","../utils/utils","../utils/support","../utils/inherit","../vendor/pixi","../constants"],function(t,i,r){var s=t("./StateManager"),n=t("../utils/EventEmitter"),o=t("../utils/Cache"),a=t("../utils/Clock"),h=t("../utils/SpritePool"),l=t("../loader/Loader"),u=t("../input/InputManager"),c=t("../audio/AudioManager"),p=t("../math/Vector"),d=t("../utils/utils"),f=t("../utils/support"),m=t("../utils/inherit"),v=t("../vendor/pixi"),y=t("../constants"),g=function(t,e){n.call(this),e=e||{},e.width=e.width||800,e.height=e.height||600,e.renderer=e.renderer||y.RENDERER.AUTO,e.transparent=e.transparent||!1,e.background=e.background||"#FFF",e.antialias=void 0!==e.antialias?e.antialias:!0,e.canvas=e.canvas||null,this.container="string"==typeof t?document.getElementById(t):t,this.container||(this.container=document.body),this.width=e.width,this.height=e.height,this.renderMethod=e.renderer,this.transparent=e.transparent,this.background=e.background,this.antialias=e.antialias,this.canvas=e.canvas,this.renderer=this._createRenderer(),this.stage=new v.Stage(this.background),this.clock=new a,this.audio=new c(this),this.load=new l(this),this.cache=new o(this),this.input=new u(this),this.spritepool=new h(this),this.state=new s(this),this.offset=new p,this.timings={};var i=this.canvas;i.getAttribute("tabindex")||i.setAttribute("tabindex","1"),i.focus(),i.addEventListener("click",function(){i.focus()},!1)};return m(g,Object,{_createRenderer:function(){var t=this.renderMethod,e=null;if(!f.webgl&&!f.canvas)throw new Error("Neither WebGL nor Canvas is supported by this browser!");if(t!==y.RENDERER.WEBGL&&t!==y.RENDERER.AUTO||!f.webgl){if(t!==y.RENDERER.CANVAS&&t!==y.RENDERER.AUTO||!f.canvas)throw new Error('Your render method ("'+t+'") is not supported by this browser!');t=y.RENDERER.CANVAS,e=new v.CanvasRenderer(this.width,this.height,this.canvas,this.transparent)}else t=y.RENDERER.WEBGL,e=new v.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias);return this.canvas||(this.container.appendChild(e.view),this.canvas=e.view),this.offset=d.getOffset(this.canvas),this.renderMethod=t,e},resize:function(t,e){this.renderer.resize(t,e),this.width=t,this.height=e;for(var i=0,r=this.stage.children.length;r>i;++i){var s=this.stage.children[i];s.resize&&s.resize(t,e)}return this},requestFullscreen:function(){var t=this.renderer.view;return t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),this},render:function(){return this.clock.start(),this._tick(),this},_tick:function(){this.timings.tickStart=this.clock.now(),e.requestAnimFrame(this._tick.bind(this));var t=this.clock.getDelta();this.timings.lastDelta=t,this.timings.inputStart=this.clock.now(),this.input.update(t),this.timings.inputEnd=this.clock.now(),this.timings.stateStart=this.clock.now(),this.state.active.update(t),this.timings.stateEnd=this.clock.now(),this.timings.userFuncsStart=this.clock.now(),this.emit("tick",t),this.timings.userFuncsEnd=this.clock.now(),this.timings.renderStart=this.clock.now(),this.renderer.render(this.stage),this.timings.renderEnd=this.clock.now(),this.timings.tickEnd=this.clock.now()
}}),Object.defineProperty(g.prototype,"physics",{get:function(){return this.state.active.physics}}),Object.defineProperty(g.prototype,"camera",{get:function(){return this.state.active.camera}}),Object.defineProperty(g.prototype,"world",{get:function(){return this.state.active.world}}),r.exports=g,r.exports}),s("text/Text",["require","exports","module","../vendor/pixi"],function(t,e,i){var r=t("../vendor/pixi").Text;return i.exports=r,i.exports}),s("plugin",["require","exports","module"],function(t,i,r){var s={patch:function(t,e,i){if(void 0!==t.prototype&&(t=t.prototype),"function"!=typeof t[e])throw new TypeError(e+" is not a function in the passed object.");if("function"!=typeof i)throw new TypeError("The passed patch function is not a function.");var r=t[e];t[e]=function(t,e){return function(){var t=this._super;this._super=r;var i=e.apply(this,arguments);return this._super=t,i}}(e,i)},register:function(t,i){if(e.gf[i])throw new RangeError('Unable to register plugin: "'+i+'" already exists in the gf namespace, please choose something else!');e.gf[i]=t}};return r.exports=s,r.exports}),s("core",["require","exports","module","./constants","./audio/AudioManager","./audio/AudioPlayer","./camera/Camera","./display/BaseTexture","./display/Container","./display/Graphics","./display/RenderTexture","./display/Sprite","./display/Texture","./display/TilingSprite","./fx/camera/Effect","./fx/camera/Close","./fx/camera/Fade","./fx/camera/Flash","./fx/camera/Scanlines","./fx/camera/Shake","./game/Game","./game/State","./game/StateManager","./game/World","./geom/Circle","./geom/Ellipse","./geom/Polygon","./geom/Rectangle","./gui/GuiItem","./input/Input","./input/InputManager","./input/Keyboard","./input/Gamepad","./input/gamepad/GamepadButtons","./input/gamepad/GamepadSticks","./input/Pointers","./input/pointer/Pointer","./loader/Loader","./math/math","./math/Vector","./particles/ParticleEmitter","./particles/ParticleSystem","./physics/PhysicsSystem","./physics/PhysicsTarget","./text/BitmapText","./text/Text","./tilemap/Tile","./tilemap/Tilelayer","./tilemap/Tilemap","./tilemap/Tileset","./tilemap/ObjectGroup","./utils/utils","./utils/support","./utils/inherit","./utils/Cache","./utils/Clock","./utils/EventEmitter","./utils/ObjectPool","./utils/SpritePool","./utils/ObjectFactory","./plugin","./vendor/pixi"],function(t,i,r){var s=function(t,e,i){var r={AudioManager:t("./audio/AudioManager"),AudioPlayer:t("./audio/AudioPlayer"),Camera:t("./camera/Camera"),BaseTexture:t("./display/BaseTexture"),Container:t("./display/Container"),Graphics:t("./display/Graphics"),RenderTexture:t("./display/RenderTexture"),Sprite:t("./display/Sprite"),Texture:t("./display/Texture"),TilingSprite:t("./display/TilingSprite"),fx:{camera:{Effect:t("./fx/camera/Effect"),Close:t("./fx/camera/Close"),Fade:t("./fx/camera/Fade"),Flash:t("./fx/camera/Flash"),Scanlines:t("./fx/camera/Scanlines"),Shake:t("./fx/camera/Shake")}},Game:t("./game/Game"),State:t("./game/State"),StateManager:t("./game/StateManager"),World:t("./game/World"),Circle:t("./geom/Circle"),Ellipse:t("./geom/Ellipse"),Polygon:t("./geom/Polygon"),Rectangle:t("./geom/Rectangle"),GuiItem:t("./gui/GuiItem"),Input:t("./input/Input"),InputManager:t("./input/InputManager"),Keyboard:t("./input/Keyboard"),Gamepad:t("./input/Gamepad"),GamepadButtons:t("./input/gamepad/GamepadButtons"),GamepadSticks:t("./input/gamepad/GamepadSticks"),Pointers:t("./input/Pointers"),Pointer:t("./input/pointer/Pointer"),Loader:t("./loader/Loader"),math:t("./math/math"),Vector:t("./math/Vector"),ParticleEmitter:t("./particles/ParticleEmitter"),ParticleSystem:t("./particles/ParticleSystem"),PhysicsSystem:t("./physics/PhysicsSystem"),PhysicsTarget:t("./physics/PhysicsTarget"),BitmapText:t("./text/BitmapText"),Text:t("./text/Text"),Tile:t("./tilemap/Tile"),Tilelayer:t("./tilemap/Tilelayer"),Tilemap:t("./tilemap/Tilemap"),Tileset:t("./tilemap/Tileset"),ObjectGroup:t("./tilemap/ObjectGroup"),utils:t("./utils/utils"),support:t("./utils/support"),inherit:t("./utils/inherit"),Cache:t("./utils/Cache"),Clock:t("./utils/Clock"),EventEmitter:t("./utils/EventEmitter"),ObjectPool:t("./utils/ObjectPool"),SpritePool:t("./utils/SpritePool"),ObjectFactory:t("./utils/ObjectFactory"),plugin:t("./plugin"),PIXI:t("./vendor/pixi")};r.PIXI.Point=r.Vector;var s=t("./constants");for(var n in s)r[n]=s[n];return i.exports=r,i.exports}.call(this,t,i,r),n=e.gf;return e.gf=s,s.noConflict=function(){return e.gf=n,s},s}),i("core")};return i?define(n):s?module.exports=n():n()}).call(this,"object"==typeof exports?global:window,"object"==typeof exports?global:window);