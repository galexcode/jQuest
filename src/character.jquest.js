(function(){window.Character=function(){function t(){}return t.settings={fileExtension:"json",spriteDirectory:""},t.sprites=[],t.characters=[],t.playerSprite=!1,t.playerMoving=!1,t.loadSprite=function(t,e){var i;return i=""+(this.settings.spriteDirectory+t)+"."+this.settings.fileExtension,$.getJSON(i,function(t){return window.Character.sprites[t.id]=t,e?e(t.id):void 0})},t.placeCharacter=function(t,e,i){var a,r;return r=window.Map.tileIdPosition(i),$("#layer"+Map.playerLayer).append('<div class="character" id="character'+t+'" />'),a="#character"+t,$(a).width(this.sprites[e].cellWidth).height(this.sprites[e].cellHeight).css("background-image","url("+this.sprites[e].sprite+")").css("background-position","-"+this.sprites[e].cellWidth+"px 0px").css("left",r[0]).css("top",r[1])},t.loadPlayer=function(t){return window.Character.playerSprite=t,window.Character.characters[0]={sprite:t,timer:[]},window.Character.placeCharacter(0,t,window.Map.playerTile)},t.playerMove=function(t){var e,i,a;if(this.playerMoving)for(t=t.slice(1),this.stopAnimation(0),e=i=0,a=this.characters[0].timer.length;a>=0?a>i:i>a;e=a>=0?++i:--i)clearTimeout(this.characters[0].timer[e]);return $("#character0").clearQueue().stop(),this.playerMoving=!0,t[0]&&this.animate(0,t[0].direction),$.each(t,function(e,i){var a;return a=Map.tileIdPosition([i.x,i.y]),i.direction&&(window.Character.characters[0].timer[e]=setTimeout(function(){return window.Character.animate(0,i.direction)},310*e)),$("#character0").animate({left:a[0],top:a[1]},300,"linear",function(){var a,r;return e===t.length-1&&(r=window.Map.tileIdConvert([i.x,i.y]),(a=window.Map.tileProperties[r])&&Map.tilePropertyLogic(a),window.Character.playerMoving=!1,window.Character.stopAnimation(0),$(".destination").remove()),Map.playerTile=Map.tileIdConvert([i.x+1,i.y])})})},t.animate=function(t,e){return window.Character.stopAnimation(t),window.Character.characters[t].animation={timer:setInterval(function(){var i,a;switch(window.Character.characters[t].animation.step>5&&(window.Character.characters[t].animation.step=0),a=0,e){case"n":a=3;break;case"e":a=1;break;case"s":a=0;break;case"w":a=2;break;case"ne":a=6;break;case"nw":a=7;break;case"se":a=5;break;case"sw":a=4}return a*=window.Character.sprites[t].cellHeight,i=window.Character.characters[t].animation.step*window.Character.sprites[t].cellWidth,$("#character"+t).css("background-position","-"+i+"px -"+a+"px"),window.Character.characters[t].animation.step++},200),step:0,y:0}},t.stopAnimation=function(t){var e;return window.Character.characters[t].animation?(clearInterval(window.Character.characters[t].animation.timer),e=$("#character"+t).css("background-position").split(" "),e[0]="-"+this.sprites[t].cellWidth+"px",$("#character"+t).css("background-position",e.join(" "))):void 0},t}()}).call(this);